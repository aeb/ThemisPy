

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>vis.image &mdash; ThemisPy 0.1.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="ThemisPy 0.1.1 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../docs/src/index.html" class="icon icon-home"> ThemisPy
          

          
          </a>

          
            
            
              <div class="version">
                0.1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/userguide.html">User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/devel.html">Developer’s Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../docs/src/index.html">ThemisPy</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../docs/src/index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>vis.image</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for vis.image</h1><div class="highlight"><pre>
<span></span><span class="c1">###########################</span>
<span class="c1">#</span>
<span class="c1"># Package:</span>
<span class="c1">#   image</span>
<span class="c1">#</span>
<span class="c1"># Provides:</span>
<span class="c1">#   Provides model image classes and functions.</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">themispy.utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span> <span class="k">as</span> <span class="n">sint</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">fftconvolve</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>

<span class="c1"># Read in ehtim, if possible</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">ehtim</span> <span class="k">as</span> <span class="nn">eh</span>
    <span class="n">ehtim_found</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Package ehtim not found.  Some functionality will not be available.  If this is necessary, please ensure ehtim is installed.&quot;</span><span class="p">,</span> <span class="ne">Warning</span><span class="p">)</span>
    <span class="n">ehtim_found</span> <span class="o">=</span> <span class="kc">False</span>


<span class="c1"># Some constants</span>
<span class="n">rad2uas</span> <span class="o">=</span> <span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mf">1e6</span>
<span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mf">180.0</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>


<div class="viewcode-block" id="model_image"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image">[docs]</a><span class="k">class</span> <span class="nc">model_image</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for Themis image models.</span>
<span class="sd">    This base class is intended to mirror the :cpp:class:`Themis::model_image` base class, providing </span>
<span class="sd">    explicit visualizations of the output of :cpp:class:`Themis::model_image`-derived model analyses.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      parameters (list): Parameter list for a given model. Default: None.</span>
<span class="sd">      size (int): Number of parameters for a given model. Default: None.</span>
<span class="sd">      themis_fft_sign (bool): Themis FFT sign convention flag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">themis_fft_sign</span><span class="o">=</span><span class="n">themis_fft_sign</span>
        
<div class="viewcode-block" id="model_image.generate"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the model parameter list.  Mirrors :cpp:func:`Themis::model_image::generate_model`, </span>
<span class="sd">        a similar a similar function within the :cpp:class:`Themis::model_image` class.  Effectively </span>
<span class="sd">        simply copies the parameters into the local list with some additional run-time checking.</span>

<span class="sd">        Args:</span>
<span class="sd">          parameters (list): Parameter list.</span>

<span class="sd">        Returns:</span>
<span class="sd">          None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Parameter list is inconsistent with the number of parameters expected.&quot;</span><span class="p">)</span></div>
    

<div class="viewcode-block" id="model_image.intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image.intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        External access function to the intenesity map.  Child classes should not overwrite </span>
<span class="sd">        this function.  This implements some parameter assessment and checks the FFT sign</span>
<span class="sd">        convention.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          parameters (list): Parameter list. If none is provided, uses the current set of parameters. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y) in :math:`Jy/\\mu as^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># </span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">themis_fft_sign</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_intensity_map</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">themis_fft_sign</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span>
        
        <span class="k">return</span> <span class="n">I</span></div>

    
<div class="viewcode-block" id="model_image.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hook for the intensity map function in child classes.  Assumes that the parameters</span>
<span class="sd">        list has been set.  This should never be called externally.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y) in :math:`Jy/\\mu as^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;intensity_map must be defined in children classes of model_image.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="model_image.parameter_name_list"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image.parameter_name_list">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hook for returning a list of parameter names.  Currently just returns the list of p0-p(size-1).</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list) List of strings of variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span> <span class="s1">&#39;p</span><span class="si">%i</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">]</span></div></div>
    
    
<div class="viewcode-block" id="model_image_symmetric_gaussian"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_symmetric_gaussian">[docs]</a><span class="k">class</span> <span class="nc">model_image_symmetric_gaussian</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Symmetric gaussian image class that is a mirror of :cpp:class:`Themis::model_image_symmetric_gaussian`.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ... Total intensity :math:`I_0` (Jy)</span>
<span class="sd">    * parameters[1] ... Standard deviation :math:`\\sigma` (rad)</span>

<span class="sd">    and size=2.</span>

<span class="sd">    Args:</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">2</span>

        
<div class="viewcode-block" id="model_image_symmetric_gaussian.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_symmetric_gaussian.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y) in :math:`Jy/\\mu as^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">I0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Symmetric Gaussian:&quot;</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">I</span></div>

    
<div class="viewcode-block" id="model_image_symmetric_gaussian.parameter_name_list"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_symmetric_gaussian.parameter_name_list">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Producess a lists parameter names.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list) List of strings of variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span> <span class="sa">r</span><span class="s1">&#39;$I_0$ (Jy)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\sigma$ (rad)&#39;</span><span class="p">]</span></div></div>
    
    
<div class="viewcode-block" id="model_image_asymmetric_gaussian"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_asymmetric_gaussian">[docs]</a><span class="k">class</span> <span class="nc">model_image_asymmetric_gaussian</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Asymmetric gaussian image class that is a mirror of :cpp:class:`Themis::model_image_asymmetric_gaussian`.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ... Total intensity :math:`I_0` (Jy)</span>
<span class="sd">    * parameters[1] ... Symmetrized standard deviation :math:`\\sigma` (rad)</span>
<span class="sd">    * parameters[2] ... Asymmetry parameter :math:`A` in (0,1)</span>
<span class="sd">    * parameters[3] ... Position angle :math:`\\phi` (rad)</span>

<span class="sd">    and size=4.</span>

<span class="sd">    Args:</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">4</span>

        
<div class="viewcode-block" id="model_image_asymmetric_gaussian.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_asymmetric_gaussian.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y) in :math:`Jy/\\mu as^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">I0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Symmetric Gaussian:&quot;</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>


        <span class="n">s</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="n">A</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mf">0.99</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">A</span><span class="p">)</span>
        <span class="n">sM</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">A</span><span class="p">)</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sm</span><span class="o">*</span><span class="n">sM</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">dxm</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">s</span><span class="o">*</span><span class="n">y</span>
        <span class="n">dxM</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">y</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">I0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="n">dxm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sm</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dxM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sM</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asymmetric Gaussian:&quot;</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">sm</span><span class="p">,</span><span class="n">sM</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">I</span></div>

    
<div class="viewcode-block" id="model_image_asymmetric_gaussian.parameter_name_list"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_asymmetric_gaussian.parameter_name_list">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Producess a lists parameter names.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list) List of strings of variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span> <span class="sa">r</span><span class="s1">&#39;$I_0$ (Jy)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\sigma$ (rad)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$A$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\phi$ (rad)&#39;</span><span class="p">]</span></div></div>
    



<div class="viewcode-block" id="model_image_crescent"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_crescent">[docs]</a><span class="k">class</span> <span class="nc">model_image_crescent</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Symmetric gaussian image class that is a mirror of :cpp:class:`Themis::model_image_crescent`.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ... Total intensity :math:`I_0` (Jy)</span>
<span class="sd">    * parameters[1] ... Outer radius :math:`R` (rad)</span>
<span class="sd">    * parameters[2] ... Width paramter :math:`\\psi` in (0,1)</span>
<span class="sd">    * parameters[3] ... Asymmetry parmaeter :math:`\\tau` in (0,1)</span>
<span class="sd">    * parameters[4] ... Position angle :math:`\\phi` (rad)</span>

<span class="sd">    and size=5.</span>

<span class="sd">    Args:</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span>

        
<div class="viewcode-block" id="model_image_crescent.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_crescent.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y) in :math:`Jy/\\mu as^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Make sure that delta ring is resolvable</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dx</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rad2uas</span><span class="p">))</span>

        <span class="n">I0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">paramters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Rp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-20</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="n">Rn</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mf">0.9999</span> <span class="p">)</span> <span class="o">*</span> <span class="n">Rp</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">),</span><span class="mf">0.9999</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rp</span> <span class="o">-</span> <span class="n">Rn</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="n">I0</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">Rp</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">Rn</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">I0</span><span class="o">+</span><span class="mi">0</span><span class="o">*</span><span class="n">x</span>
        <span class="n">I</span> <span class="o">*=</span> <span class="p">((</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">Rp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">*=</span> <span class="p">(((</span><span class="n">x</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">Rn</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KD Crescent:&quot;</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">Rp</span><span class="p">,</span><span class="n">Rn</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">I</span>    </div>

    
<div class="viewcode-block" id="model_image_crescent.parameter_name_list"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_crescent.parameter_name_list">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Producess a lists parameter names.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list) List of strings of variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span> <span class="sa">r</span><span class="s1">&#39;$I_0$ (Jy)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$R_{\rm out}$ (rad)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\psi$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\epsilon$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\tau$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\phi$ (rad)&#39;</span><span class="p">]</span></div></div>

    
<div class="viewcode-block" id="model_image_xsring"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_xsring">[docs]</a><span class="k">class</span> <span class="nc">model_image_xsring</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Symmetric gaussian image class that is a mirror of :cpp:class:`Themis::model_image_xsring`.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ... Total intensity :math:`I_0` (Jy)</span>
<span class="sd">    * parameters[1] ... Outer radius :math:`R` (rad)</span>
<span class="sd">    * parameters[2] ... Width paramter :math:`\\psi` in (0,1)</span>
<span class="sd">    * parameters[3] ... Eccentricity parameter :math:`\\epsilon` in (0,1)</span>
<span class="sd">    * parameters[4] ... Linear fade parameter math:`f` in (0,1)</span>
<span class="sd">    * parameters[5] ... Position angle :math:`\\phi` (rad)</span>

<span class="sd">    and size=6.</span>

<span class="sd">    Args:</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">6</span>

        
<div class="viewcode-block" id="model_image_xsring.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_xsring.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y) in :math:`Jy/\\mu as^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">I0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Rp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-20</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="n">Rin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mf">0.9999</span> <span class="p">)</span> <span class="o">*</span> <span class="n">Rp</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">),</span><span class="mf">0.9999</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rp</span> <span class="o">-</span> <span class="n">Rin</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">),</span><span class="mf">0.9999</span><span class="p">);</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

        <span class="n">Iring0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">gq</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">I0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="p">((</span><span class="mf">1.0</span><span class="o">+</span><span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rp</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Rin</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">Rin</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Rp</span><span class="p">);</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">c</span> <span class="o">-</span> <span class="n">y</span><span class="o">*</span><span class="n">s</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">s</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">c</span>

        <span class="n">Iring</span> <span class="o">=</span> <span class="n">Iring0</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">dx</span><span class="o">/</span><span class="n">Rp</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">dx</span><span class="o">/</span><span class="n">Rp</span><span class="p">))</span> 
        <span class="n">Iring</span> <span class="o">*=</span> <span class="p">((</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">Rp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Iring</span> <span class="o">*=</span> <span class="p">(((</span><span class="n">dx</span><span class="o">-</span><span class="n">d</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">Rin</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;xsring:&quot;</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">Rp</span><span class="p">,</span><span class="n">Rn</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Iring</span></div>

    
<div class="viewcode-block" id="model_image_xsring.parameter_name_list"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_xsring.parameter_name_list">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Producess a lists parameter names.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list) List of strings of variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span> <span class="sa">r</span><span class="s1">&#39;$I_0$ (Jy)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$R_{\rm out}$ (rad)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\psi$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\epsilon$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$f$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\phi$ (rad)&#39;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="model_image_xsringauss"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_xsringauss">[docs]</a><span class="k">class</span> <span class="nc">model_image_xsringauss</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Symmetric gaussian image class that is a mirror of :cpp:class:`Themis::model_image_xsringauss`.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ... Total intensity :math:`I_0` (Jy)</span>
<span class="sd">    * parameters[1] ... Outer radius :math:`R` (rad)</span>
<span class="sd">    * parameters[2] ... Width parameter :math:`\\psi` in (0,1)</span>
<span class="sd">    * parameters[3] ... Eccentricity parameter :math:`\\epsilon` in (0,1)</span>
<span class="sd">    * parameters[4] ... Linear fade parameter math:`f` in (0,1)</span>
<span class="sd">    * parameters[5] ... FWHM of the main axis of the Gaussian in units of the ring outer radius math:`g_{ax}`</span>
<span class="sd">    * parameters[6] ... Gaussian axial ratio math:`a_q`</span>
<span class="sd">    * parameters[7] ... Ratio of Gaussian flux to ring flux math:`g_q`</span>
<span class="sd">    * parameters[8] ... Position angle :math:`\\phi` (rad)</span>

<span class="sd">    and size=9.</span>

<span class="sd">    Args:</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">9</span>

        
<div class="viewcode-block" id="model_image_xsringauss.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_xsringauss.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y) in :math:`Jy/\\mu as^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Make sure that delta ring is resolvable</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dx</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rad2uas</span><span class="p">))</span>

        <span class="n">I0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Rp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-20</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="n">Rin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mf">0.9999</span> <span class="p">)</span> <span class="o">*</span> <span class="n">Rp</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">),</span><span class="mf">0.9999</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rp</span> <span class="o">-</span> <span class="n">Rin</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">),</span><span class="mf">0.9999</span><span class="p">);</span>
        <span class="n">sig1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rp</span><span class="p">;</span>
        <span class="n">sig2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig1</span><span class="p">;</span>
        <span class="n">gq</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">),</span><span class="mf">0.9999</span><span class="p">);</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>


        <span class="n">Iring0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">gq</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">I0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="p">((</span><span class="mf">1.0</span><span class="o">+</span><span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rp</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Rin</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">Rin</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Rp</span><span class="p">);</span>
        <span class="n">Igauss0</span> <span class="o">=</span> <span class="n">gq</span><span class="o">*</span><span class="n">I0</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sig1</span><span class="o">*</span><span class="n">sig2</span><span class="p">);</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">c</span> <span class="o">-</span> <span class="n">y</span><span class="o">*</span><span class="n">s</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">s</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">c</span>

        <span class="n">Iring</span> <span class="o">=</span> <span class="n">Iring0</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">dx</span><span class="o">/</span><span class="n">Rp</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">dx</span><span class="o">/</span><span class="n">Rp</span><span class="p">))</span> 
        <span class="n">Igauss</span> <span class="o">=</span> <span class="n">Igauss0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">dx</span><span class="o">-</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">Rin</span><span class="p">))</span><span class="o">/</span><span class="n">sig1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">dy</span><span class="o">/</span><span class="n">sig2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> 

        <span class="n">Iring</span> <span class="o">*=</span> <span class="p">((</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">Rp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Iring</span> <span class="o">*=</span> <span class="p">(((</span><span class="n">dx</span><span class="o">-</span><span class="n">d</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">Rin</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;xsringauss:&#39;</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">Rin</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sig1</span><span class="p">,</span> <span class="n">sig2</span><span class="p">,</span> <span class="n">gq</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">Iring</span><span class="o">+</span><span class="n">Igauss</span><span class="p">)</span></div>


<div class="viewcode-block" id="model_image_xsringauss.parameter_name_list"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_xsringauss.parameter_name_list">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Producess a lists parameter names.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list) List of strings of variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span> <span class="sa">r</span><span class="s1">&#39;$I_0$ (Jy)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$R_{\rm out}$ (rad)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\psi$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\epsilon$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$f$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$g_</span><span class="si">{ax}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$a_q$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$g_q$&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\phi$ (rad)&#39;</span><span class="p">]</span></div></div>


<div class="viewcode-block" id="direct_cubic_spline_1d"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.direct_cubic_spline_1d">[docs]</a><span class="k">def</span> <span class="nf">direct_cubic_spline_1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Image-space approximate cubic spline convolution along 1D.  Useful for the splined raster image classes.  </span>
<span class="sd">    This is VERY slow and should be used for debugging only.</span>

<span class="sd">    Args: </span>
<span class="sd">      x (numpy.ndarray): 1D array of positions of the control points. Must have the same length as f.</span>
<span class="sd">      f (numpy.ndarray): 1D array of heights of the control points.  Must have the same length as x.</span>
<span class="sd">      xx (numpy.ndarray): 1D array of positions at which to compute inteperolated values of f.</span>
<span class="sd">      a (float): Cubic spline control parameter. Default: -0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.ndarray): 1D array with the values of f interpolated to positions xx.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ff</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">xx</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xx</span><span class="p">))</span> <span class="p">:</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">Dx</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">3</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">8</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&gt;=-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&gt;=-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">a</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span><span class="o">**</span><span class="mi">3</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">8</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ff</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ff</span></div>


<div class="viewcode-block" id="direct_cubic_spline_2d"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.direct_cubic_spline_2d">[docs]</a><span class="k">def</span> <span class="nf">direct_cubic_spline_2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">rotation_angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Image-space approximate cubic spline convolution in 2D.  This is accomplished by </span>
<span class="sd">    convolving along x and they y.  Expects the data to be stored in a rectalinear grid.  </span>
<span class="sd">    Useful for the splined raster image classes.  This is VERY slow and should be used </span>
<span class="sd">    for debugging only.</span>

<span class="sd">    Args:</span>
<span class="sd">      x (numpy.ndarray): 1D array of positions of the control points in the x direction. Must have the same length as f.shape[0].</span>
<span class="sd">      y (numpy.ndarray): 1D array of positions of the control points in the y direction. Must have the same length as f.shape[1].</span>
<span class="sd">      f (numpy.ndarray): 2D array of heights of the control points.  Must have f.shape=[x.size,y.size].</span>
<span class="sd">      xx (numpy.ndarray): 1D array of positions at which to compute inteperolated values of f.</span>
<span class="sd">      ff (numpy.ndarray): 1D array of positions at which to compute inteperolated values of f.</span>
<span class="sd">      rotation_angle (float): Rotation angle of the field counter-clockwise in radians. If None, no rotation is performed. Default: None.</span>
<span class="sd">      a (float): Cubic spline control parameter. Default: -0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.ndarray): 2D array with the values of ff interpolated to positions [xx,yy].</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># 1st pass in x direction to get up-sampled control points</span>
    <span class="n">ff1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xx</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
        <span class="n">ff1</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">direct_cubic_spline_1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span><span class="n">xx</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>

    <span class="c1"># 2nd pass in y direction to get full up-sampled data</span>
    <span class="n">ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xx</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">yy</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
        <span class="n">ff</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">direct_cubic_spline_1d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">ff1</span><span class="p">[</span><span class="n">j</span><span class="p">,:],</span><span class="n">yy</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>

    <span class="c1"># Rotate</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rotation_angle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">interp_obj</span> <span class="o">=</span> <span class="n">sint</span><span class="o">.</span><span class="n">RectBivariateSpline</span><span class="p">(</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span><span class="o">-</span><span class="n">yy</span><span class="p">,</span><span class="n">ff</span><span class="p">)</span>
        <span class="n">cpa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span>
        <span class="n">spa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
                <span class="n">xxr</span> <span class="o">=</span> <span class="n">cpa</span><span class="o">*</span><span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">spa</span><span class="o">*</span><span class="n">yy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">yyr</span> <span class="o">=</span> <span class="o">-</span><span class="n">spa</span><span class="o">*</span><span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">cpa</span><span class="o">*</span><span class="n">yy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp_obj</span><span class="p">(</span><span class="o">-</span><span class="n">xxr</span><span class="p">,</span><span class="o">-</span><span class="n">yyr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ff</span></div>


<div class="viewcode-block" id="W_cubic_spline_1d"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.W_cubic_spline_1d">[docs]</a><span class="k">def</span> <span class="nf">W_cubic_spline_1d</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fourier domain convolution function for the approximate 1D cubic spline.</span>
<span class="sd">    Useful for the splined raster image classes.</span>

<span class="sd">    Args:</span>
<span class="sd">      k (numpy.ndarray): Wavenumber.</span>
<span class="sd">      a (float): Cubic spline control parameter. Default: -0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.ndarray): 1D array of values of the cubic spline weight function evaluated at each value of k.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">abk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">ok4</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">abk</span><span class="o">**</span><span class="mi">4</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">)</span>
    <span class="n">ok3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">abk</span><span class="o">**</span><span class="mi">3</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-2</span><span class="p">,</span>
                     <span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">15.0</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">((</span><span class="mi">16</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">560.0</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span>
                     <span class="p">(</span> <span class="mf">12.0</span><span class="o">*</span><span class="n">ok4</span><span class="o">*</span><span class="p">(</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="p">)</span>
                       <span class="o">-</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">ok3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span></div>


<div class="viewcode-block" id="fft_cubic_spline_2d"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.fft_cubic_spline_2d">[docs]</a><span class="k">def</span> <span class="nf">fft_cubic_spline_2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">rotation_angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FFT cubic spline convolution in 2D. This is accomplished by directly evaluating the</span>
<span class="sd">    Fourier transform of f (as a sum of Fourier components), applying the cubic spline as</span>
<span class="sd">    a filter in the Fourier space, and then inverting the Fourier transfor with FFT. </span>
<span class="sd">    Expects the data to be stored in a rectalinear grid. Useful for the splined raster </span>
<span class="sd">    image classes.</span>

<span class="sd">    Args:</span>
<span class="sd">      x (numpy.ndarray): 1D array of positions of the control points in the x direction. Must have the same length as f.shape[0].</span>
<span class="sd">      y (numpy.ndarray): 1D array of positions of the control points in the y direction. Must have the same length as f.shape[1].</span>
<span class="sd">      f (numpy.ndarray): 2D array of heights of the control points.  Must have f.shape=[x.size,y.size].</span>
<span class="sd">      xx (numpy.ndarray): 1D array of positions at which to compute inteperolated values of f.</span>
<span class="sd">      yy (numpy.ndarray): 1D array of positions at which to compute inteperolated values of f.</span>
<span class="sd">      rotation_angle (float): Rotation angle of the field counter-clockwise in radians. If None, no rotation is performed. Default: None.</span>
<span class="sd">      a (float): Cubic spline control parameter. Default: -0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.ndarray): 2D array with the values of ff interpolated to positions [xx,yy].</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Generate Fourier grid of the rFFT of the desired image</span>
    <span class="n">uu1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">xx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">vv1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">yy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">uu1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">uu1d</span><span class="p">)</span>
    <span class="n">vv1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">vv1d</span><span class="p">)</span>

    <span class="n">uu</span><span class="p">,</span><span class="n">vv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">uu1d</span><span class="p">,</span><span class="n">vv1d</span><span class="p">)</span>
    <span class="n">uu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">uu</span><span class="p">)</span>
    <span class="n">vv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span>

    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rotation_angle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">uur</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span><span class="o">*</span><span class="n">uu</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span><span class="o">*</span><span class="n">vv</span>
        <span class="n">vvr</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span><span class="o">*</span><span class="n">uu</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span><span class="o">*</span><span class="n">vv</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">uur</span> <span class="o">=</span> <span class="n">uu</span>
        <span class="n">vvr</span> <span class="o">=</span> <span class="n">vv</span>

    <span class="n">tpi</span> <span class="o">=</span> <span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">FF</span> <span class="o">=</span> <span class="mf">0.0</span><span class="o">*</span><span class="n">uu</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
            <span class="n">FF</span> <span class="o">=</span> <span class="n">FF</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="n">tpi</span><span class="o">*</span><span class="p">(</span><span class="n">uur</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="n">vvr</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span> <span class="p">)</span> <span class="o">*</span> <span class="n">f</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span>
    <span class="n">FF</span> <span class="o">=</span> <span class="n">FF</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">tpi</span><span class="o">*</span><span class="p">(</span><span class="n">uu</span><span class="o">*</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">vv</span><span class="o">*</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">FF</span> <span class="o">=</span> <span class="n">FF</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">uur</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">vvr</span><span class="p">)</span>
    <span class="n">FF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifftshift</span><span class="p">(</span><span class="n">FF</span><span class="p">)</span>

    <span class="n">ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft2</span><span class="p">(</span><span class="n">FF</span><span class="p">)</span>

    <span class="n">norm_factor</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">xx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">yy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span><span class="o">*</span><span class="n">norm_factor</span></div>





<div class="viewcode-block" id="model_image_splined_raster"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_splined_raster">[docs]</a><span class="k">class</span> <span class="nc">model_image_splined_raster</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splined raster image class that is a mirror of :cpp:class:`Themis::model_image_splined_raster`.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ........ Logarithm of the brightness at control point 0,0 (Jy/sr)</span>
<span class="sd">    * parameters[1] ........ Logarithm of the brightness at control point 1,0 (Jy/sr)</span>

<span class="sd">    ...</span>

<span class="sd">    * parameters[Nx-1] ..... Logarithm of the brightness at control point Nx-1,0 (Jy/sr)</span>
<span class="sd">    * parameters[Nx] ....... Logarithm of the brightness at control point 0,1 (Jy/sr)</span>
<span class="sd">    * parameters[Nx+1] ..... Logarithm of the brightness at control point 1,1 (Jy/sr)</span>

<span class="sd">    ...</span>

<span class="sd">    * parameters[Nx*Ny-1] .. Logarithm of the brightness at control point Nx-1,Ny-1 (Jy/sr)</span>

<span class="sd">    and size=Nx*Ny.</span>

<span class="sd">    Args:</span>
<span class="sd">      Nx (int): Number of control points in the -RA direction.</span>
<span class="sd">      Ny (int): Number of control points in the Dec direction.</span>
<span class="sd">      fovx (float): Field of view in the -RA direction (rad).</span>
<span class="sd">      fovy (float): Field of view in the Dec direction (rad).</span>
<span class="sd">      a (float): Spline control factor. Default: -0.5.</span>
<span class="sd">      spline_method (str): Spline method. Accepted values are &#39;fft&#39; and &#39;direct&#39;.  Default: &#39;fft&#39;.</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      Nx (int): Number of control points in the -RA direction.</span>
<span class="sd">      Ny (int): Number of control points in the Dec direction.</span>
<span class="sd">      fovx (float): Field of view in the -RA direction (rad).</span>
<span class="sd">      fovy (float): Field of view in the Dec direction (rad).</span>
<span class="sd">      a (float): Spline control factor. Default: -0.5.</span>
<span class="sd">      spline_method (str): Spline method. Accepted values are &#39;fft&#39; and &#39;direct&#39;.  Default: &#39;fft&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">fovx</span><span class="p">,</span> <span class="n">fovy</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">spline_method</span><span class="o">=</span><span class="s1">&#39;fft&#39;</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="n">Nx</span><span class="o">*</span><span class="n">Ny</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="o">=</span> <span class="n">Nx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ny</span> <span class="o">=</span> <span class="n">Ny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fovx</span> <span class="o">=</span> <span class="n">fovx</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fovy</span> <span class="o">=</span> <span class="n">fovy</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spline_method</span> <span class="o">=</span> <span class="n">spline_method</span>

        
<div class="viewcode-block" id="model_image_splined_raster.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_splined_raster.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y) in :math:`Jy/\\mu as^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">])</span>

        <span class="n">xtmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fovx</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fovx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">)</span>
        <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fovy</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fovy</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">)</span>

        <span class="c1"># Determine the proper transposition based on if the reshaped x is fastest or slowest</span>
        <span class="n">xtest</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">xtest</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
            <span class="n">transpose</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">xx</span><span class="o">=</span><span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">yy</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">transpose</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">xx</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="n">yy</span><span class="o">=</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>

        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_method</span><span class="o">==</span><span class="s1">&#39;fft&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">fft_cubic_spline_2d</span><span class="p">(</span><span class="n">xtmp</span><span class="p">,</span><span class="n">ytmp</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_method</span><span class="o">==</span><span class="s1">&#39;direct&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">direct_cubic_spline_2d</span><span class="p">(</span><span class="n">xtmp</span><span class="p">,</span><span class="n">ytmp</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Only &#39;fft&#39; and &#39;direct&#39; methods are implemented for the spline.&quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="p">(</span><span class="n">transpose</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">I</span></div>


<div class="viewcode-block" id="model_image_splined_raster.parameter_name_list"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_splined_raster.parameter_name_list">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Producess a lists parameter names.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list) List of strings of variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\ln(I_{</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">})$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">names</span></div></div>

    
<div class="viewcode-block" id="model_image_adaptive_splined_raster"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_adaptive_splined_raster">[docs]</a><span class="k">class</span> <span class="nc">model_image_adaptive_splined_raster</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adaptive splined raster image class that is a mirror of :cpp:class:`Themis::model_image_adaptive_splined_raster`.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ........ Logarithm of the brightness at control point 0,0 (Jy/sr)</span>
<span class="sd">    * parameters[1] ........ Logarithm of the brightness at control point 1,0 (Jy/sr)</span>

<span class="sd">    ...</span>

<span class="sd">    * parameters[Nx-1] ..... Logarithm of the brightness at control point Nx-1,0 (Jy/sr)</span>
<span class="sd">    * parameters[Nx] ....... Logarithm of the brightness at control point 0,1 (Jy/sr)</span>
<span class="sd">    * parameters[Nx+1] ..... Logarithm of the brightness at control point 1,1 (Jy/sr)</span>

<span class="sd">    ...</span>

<span class="sd">    * parameters[Nx*Ny-1] .. Logarithm of the brightness at control point Nx-1,Ny-1 (Jy/sr)</span>
<span class="sd">    * parameters[Nx*Ny] .... Field of view in the x direction (rad)</span>
<span class="sd">    * parameters[Nx*Ny+1] .. Field of view in the y direction (rad)</span>
<span class="sd">    * parameters[Nx*Ny+2] .. Orientation of the x direction (rad)</span>

<span class="sd">    and size=Nx*Ny.</span>

<span class="sd">    Args:</span>
<span class="sd">      Nx (int): Number of control points in the -RA direction.</span>
<span class="sd">      Ny (int): Number of control points in the Dec direction.</span>
<span class="sd">      a (float): Spline control factor. Default: -0.5.</span>
<span class="sd">      spline_method (str): Spline method. Accepted values are &#39;fft&#39; and &#39;direct&#39;.  Default: &#39;fft&#39;.</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True</span>

<span class="sd">    Attributes:</span>
<span class="sd">      Nx (int): Number of control points in the -RA direction.</span>
<span class="sd">      Ny (int): Number of control points in the Dec direction.</span>
<span class="sd">      a (float): Spline control factor. Default: -0.5.</span>
<span class="sd">      spline_method (str): Spline method. Accepted values are &#39;fft&#39; and &#39;direct&#39;.  Default: &#39;fft&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">spline_method</span><span class="o">=</span><span class="s1">&#39;fft&#39;</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="n">Nx</span><span class="o">*</span><span class="n">Ny</span><span class="o">+</span><span class="mi">3</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="o">=</span> <span class="n">Nx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ny</span> <span class="o">=</span> <span class="n">Ny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spline_method</span> <span class="o">=</span> <span class="n">spline_method</span>
        

<div class="viewcode-block" id="model_image_adaptive_splined_raster.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_adaptive_splined_raster.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y) in :math:`Jy/\\mu as^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">])</span>

        <span class="n">fovx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">rad2uas</span>
        <span class="n">fovy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">rad2uas</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">xtmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fovx</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fovx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">)</span>
        <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fovy</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fovy</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">)</span>

        <span class="c1"># Determine the proper transposition based on if the reshaped x is fastest or slowest</span>
        <span class="n">xtest</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">xtest</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
            <span class="n">transpose</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">xx</span><span class="o">=</span><span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">yy</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">transpose</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">xx</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="n">yy</span><span class="o">=</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>

        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_method</span><span class="o">==</span><span class="s1">&#39;fft&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">fft_cubic_spline_2d</span><span class="p">(</span><span class="n">xtmp</span><span class="p">,</span><span class="n">ytmp</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">PA</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_method</span><span class="o">==</span><span class="s1">&#39;direct&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">direct_cubic_spline_2d</span><span class="p">(</span><span class="n">xtmp</span><span class="p">,</span><span class="n">ytmp</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">PA</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Only &#39;fft&#39; and &#39;direct&#39; methods are implemented for the spline.&quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="p">(</span><span class="n">transpose</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">I</span></div>

    
<div class="viewcode-block" id="model_image_adaptive_splined_raster.parameter_name_list"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_adaptive_splined_raster.parameter_name_list">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Producess a lists parameter names.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list) List of strings of variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\ln(I_{</span><span class="si">%i</span><span class="s1">,</span><span class="si">%i</span><span class="s1">})$&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">))</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;fovx (rad)&#39;</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;fovy (rad)&#39;</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\phi$ (rad)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names</span></div></div>



<div class="viewcode-block" id="model_image_smooth"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_smooth">[docs]</a><span class="k">class</span> <span class="nc">model_image_smooth</span><span class="p">(</span><span class="n">model_image</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Smoothed image class that is a mirror of :cpp:class:`Themis::model_image_smooth`. Generates a smoothed </span>
<span class="sd">    image from an existing image using an asymmetric Gaussian smoothing kernel.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ............. First parameter of underlying image</span>
<span class="sd">    </span>
<span class="sd">    ...</span>

<span class="sd">    * parameters[image.size-1] .. Last parameter of underlying image</span>
<span class="sd">    * parameters[image.size] .... Symmetrized standard deviation of smoothing kernel :math:`\\sigma` (rad)</span>
<span class="sd">    * parameters[image.size+1] .. Asymmetry parameter of smoothing kernel :math:`A` in (0,1)</span>
<span class="sd">    * parameters[image.size+2] .. Position angle of smoothing kernel :math:`\\phi` (rad)</span>

<span class="sd">    and size=image.size+3.</span>

<span class="sd">    Args:</span>
<span class="sd">      image (model_image): :class:`model_image` object that will be smoothed.</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      image (model_image): A preexisting :class:`model_image` object to be smoothed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>

        
<div class="viewcode-block" id="model_image_smooth.generate"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_smooth.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the model parameter list.  Mirrors :cpp:func:`Themis::model_image_smooth::generate_model`, </span>
<span class="sd">        a similar a similar function within the :cpp:class:`Themis::model_image_smooth` class.  Effectively </span>
<span class="sd">        simply copies the parameters into the local list with some additional run-time checking.</span>

<span class="sd">        Args:</span>
<span class="sd">          parameters (list): Parameter list.</span>

<span class="sd">        Returns:</span>
<span class="sd">          None        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Parameter list is inconsistent with the number of parameters expected.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span></div>

        
<div class="viewcode-block" id="model_image_smooth.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_smooth.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y) in :math:`Jy/\\mu as^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Doesn&#39;t to boundary checking here.  Probably not a major problem, but consider it in the future.</span>
        <span class="n">sr1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">rad2uas</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="p">)</span>
        <span class="n">sr2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">rad2uas</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="p">)</span>
        <span class="n">sphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Check to prevent convolving with zero</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sr1</span><span class="o">&lt;</span><span class="n">dx</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">sr1</span> <span class="o">=</span> <span class="n">dx</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sr2</span><span class="o">&lt;</span><span class="n">dx</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">sr2</span> <span class="o">=</span> <span class="n">dx</span>
        
        <span class="c1"># Re-orient the grind along major and minor axes of the smoothing kernel</span>
        <span class="n">xMajor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sphi</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sphi</span><span class="p">)</span><span class="o">*</span><span class="n">y</span>
        <span class="n">xMinor</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sphi</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sphi</span><span class="p">)</span><span class="o">*</span><span class="n">y</span>
        <span class="n">exponent</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">xMajor</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sr1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">xMinor</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sr2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sr1</span><span class="o">*</span><span class="n">sr2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">exponent</span><span class="p">)</span> 
    
        <span class="n">px</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">py</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">intensity_map</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="n">Ism</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fftconvolve</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">px</span><span class="o">*</span><span class="n">py</span><span class="p">,</span><span class="n">K</span><span class="o">*</span><span class="n">px</span><span class="o">*</span><span class="n">py</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Gaussian smoothed:&#39;</span><span class="p">,</span><span class="n">sr1</span><span class="p">,</span><span class="n">sr2</span><span class="p">,</span><span class="n">sphi</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">Ism</span><span class="o">/</span><span class="p">(</span><span class="n">px</span><span class="o">*</span><span class="n">py</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="model_image_smooth.parameter_name_list"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_smooth.parameter_name_list">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Producess a lists parameter names.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list) List of strings of variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">parameter_name_list</span><span class="p">()</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\sigma_s$ (rad)&#39;</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$A_s$&#39;</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\phi_s$ (rad)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names</span></div></div>

    
    
    
<div class="viewcode-block" id="model_image_sum"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_sum">[docs]</a><span class="k">class</span> <span class="nc">model_image_sum</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Summed image class that is a mirror of :cpp:class:`Themis::model_image_sum`. Generates images by summing </span>
<span class="sd">    other images supplemented with some offset. The parameters list is expanded by 2 for each </span>
<span class="sd">    image, corresponding to the absolute positions. These may be specified either in Cartesian </span>
<span class="sd">    or polar coordinates; this selection must be made at construction and applies uniformly to </span>
<span class="sd">    all components (i.e., all component positions must be specified in the same coordinates).</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">      image_list (list): List of :class:`model_image` objects. If None, must be set prior to calling :func:`intensity_map`. Default: None.</span>
<span class="sd">      offset_coordinates (str): Coordinates in which to specify component shifts.  Options are &#39;Cartesian&#39; and &#39;polar&#39;. Default: &#39;Cartesian&#39;.</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      image_list (list): List of :class:`model_image` objects that are to be summed.</span>
<span class="sd">      shift_list (list): List of shifts transformed to Cartesian coordinates.</span>
<span class="sd">      offset_coordinates (str): Coordinates in which to specify component shifts.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset_coordinates</span><span class="o">=</span><span class="s1">&#39;Cartesian&#39;</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">image_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image_list</span><span class="p">)</span> <span class="c1"># This is a SHALLOW copy</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">image_list</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">offset_coordinates</span> <span class="o">=</span> <span class="n">offset_coordinates</span>

            
<div class="viewcode-block" id="model_image_sum.add"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_sum.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds an model_image object or list of model_image objects to the sum.  The size is recomputed.</span>

<span class="sd">        Args:</span>
<span class="sd">          image (model_image, list): A single model_image object or list of model_image objects to be added.</span>

<span class="sd">        Returns:</span>
<span class="sd">          None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Can add lists and single istances</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_list</span> <span class="o">=</span> <span class="n">image_list</span> <span class="o">+</span> <span class="n">image</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="c1"># Get new size and shift list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">image_list</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span></div>

        
<div class="viewcode-block" id="model_image_sum.generate"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_sum.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the model parameter list.  Mirrors :cpp:func:`Themis::model_image_sum::generate_model`, </span>
<span class="sd">        a similar a similar function within the :cpp:class:`Themis::model_image_sum` class.  </span>
<span class="sd">        Effectively simply copies the parameters into the local list, transforms</span>
<span class="sd">        and copies the shift vector (x0,y0) for each model_image object, and performs some run-time checking.</span>

<span class="sd">        Args:</span>
<span class="sd">          parameters (list): Parameter list.</span>

<span class="sd">        Returns:</span>
<span class="sd">          None        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Parameter list is inconsistent with the number of parameters expected.&quot;</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_list</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">image</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_coordinates</span><span class="o">==</span><span class="s1">&#39;Cartesian&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">]</span> <span class="o">*</span> <span class="n">rad2uas</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">rad2uas</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_coordinates</span><span class="o">==</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">rad2uas</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">rad2uas</span>
                
            <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">[(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">2</span><span class="p">):]</span></div>

            
<div class="viewcode-block" id="model_image_sum.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_sum.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y) in :math:`Jy/\\mu as^2`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_list</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">+</span><span class="n">image</span><span class="o">.</span><span class="n">generate_intensity_map</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

            <span class="n">q</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">2</span><span class="p">):]</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   --&gt; Sum shift:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            
        <span class="k">return</span> <span class="n">I</span></div>


<div class="viewcode-block" id="model_image_sum.parameter_name_list"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_sum.parameter_name_list">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Producess a lists parameter names.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (list) List of strings of variable names.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_list</span> <span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">parameter_name_list</span><span class="p">())</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_coordinates</span><span class="o">==</span><span class="s1">&#39;Cartesian&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta x$ (rad)&#39;</span><span class="p">)</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta y$ (rad)&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_coordinates</span><span class="o">==</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta r$ (rad)&#39;</span><span class="p">)</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Delta \theta$ (rad)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">names</span></div></div>
    

<div class="viewcode-block" id="model_image_single_point_statistics"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_single_point_statistics">[docs]</a><span class="k">class</span> <span class="nc">model_image_single_point_statistics</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a :class:`model_image` object that is filed with a desired set of </span>
<span class="sd">    single-point statistics (mean, median, standard deviation, kurtosis, etc.) given</span>
<span class="sd">    a specified model_image object and appropriate chain data.</span>

<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image</span><span class="p">,</span> <span class="n">stats_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">median_store_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">stats_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;stddev&#39;</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span> <span class="o">=</span> <span class="n">stats_list</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">default_stat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_generated</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">median_store_size</span> <span class="o">=</span> <span class="n">median_store_size</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="kc">None</span>
        
            
<div class="viewcode-block" id="model_image_single_point_statistics.generate"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_single_point_statistics.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">chain</span><span class="p">)</span> <span class="p">:</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="o">==</span><span class="n">chain</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="n">chain</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_generated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="model_image_single_point_statistics.set_default_stat"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_single_point_statistics.set_default_stat">[docs]</a>    <span class="k">def</span> <span class="nf">set_default_stat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stat</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the statistic to be returned on the next call to :func:`intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          stat (str): A statistic in the stats_list.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span><span class="p">))</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">((</span><span class="s2">&quot;Requested statistic </span><span class="si">%s</span><span class="s2"> is not in currently computed statistic list:&quot;</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span><span class="p">)</span><span class="o">*</span><span class="s2">&quot; </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">%</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span><span class="p">)))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_stat</span> <span class="o">=</span> <span class="n">stat</span></div>


<div class="viewcode-block" id="model_image_single_point_statistics.set_median_store_size"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_single_point_statistics.set_median_store_size">[docs]</a>    <span class="k">def</span> <span class="nf">set_median_store_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">median_store_size</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the number of images to remember in the computation of the median.  If </span>
<span class="sd">        set to None, will store all images in the chain, possibly running afoul of </span>
<span class="sd">        system memory constraints.</span>

<span class="sd">        Args:</span>
<span class="sd">          median_store_size(int): Number of images to store.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">median_store_size</span> <span class="o">=</span> <span class="n">size</span></div>

        
<div class="viewcode-block" id="model_image_single_point_statistics.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_single_point_statistics.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>

        <span class="c1"># If new place, regenerate</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">!=</span><span class="n">x</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">!=</span><span class="n">y</span><span class="p">))</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="o">=</span><span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="o">=</span><span class="n">y</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stats_generated</span> <span class="o">=</span> <span class="kc">False</span>
            
        <span class="c1"># If not generated, generate the relevant bits</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stats_generated</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>

            <span class="k">for</span> <span class="n">stat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="n">stat</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
            
            <span class="n">nparams</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">flattened_chain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nparams</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Number of parameters is </span><span class="si">%i</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">nparams</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Size of chain / flattened chain :&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">chain</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">flattened_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            
            <span class="c1"># Generate room for keeping track of images for median computation.</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;median&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">median_store_size</span> <span class="ow">is</span> <span class="kc">None</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">nmedstore</span> <span class="o">=</span> <span class="n">flattened_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">nmedstore</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">median_store_size</span>
                <span class="n">I_median_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nmedstore</span><span class="o">+</span><span class="mi">1</span><span class="p">,)</span><span class="o">+</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                <span class="n">I_median_boundary_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,)</span><span class="o">+</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="c1"># Determine which things to computes</span>
            <span class="n">compute_median</span> <span class="o">=</span> <span class="p">(</span> <span class="s1">&#39;median&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span> <span class="p">)</span>
            <span class="n">compute_kurtosis</span> <span class="o">=</span> <span class="p">(</span> <span class="s1">&#39;kurtosis&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span> <span class="p">)</span>
            <span class="n">compute_skewness</span> <span class="o">=</span> <span class="p">(</span> <span class="s1">&#39;skewness&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span> <span class="p">)</span> <span class="ow">or</span> <span class="n">compute_kurtosis</span>
            <span class="n">compute_stddev</span> <span class="o">=</span> <span class="p">(</span> <span class="s1">&#39;stddev&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span> <span class="p">)</span> <span class="ow">or</span> <span class="n">compute_skewness</span>
            <span class="n">compute_mean</span> <span class="o">=</span> <span class="p">(</span> <span class="s1">&#39;mean&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_list</span> <span class="p">)</span> <span class="ow">or</span> <span class="n">compute_stddev</span>

            
            <span class="c1"># Loop over chain elmenets and accumulate quantities that will be turned into the desired statisics</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">pb</span> <span class="o">=</span> <span class="n">progress_bar</span><span class="p">(</span><span class="s1">&#39;Stats Computation:&#39;</span><span class="p">,</span><span class="n">length</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>
                <span class="n">pb</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">flattened_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  On frame k = </span><span class="si">%i</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="n">pb</span><span class="o">.</span><span class="n">increment</span><span class="p">(</span><span class="n">k</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">flattened_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                    
                    
                <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">intensity_map</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">flattened_chain</span><span class="p">[</span><span class="n">k</span><span class="p">,:],</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="p">(</span> <span class="n">compute_mean</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span>

                <span class="k">if</span> <span class="p">(</span> <span class="n">compute_stddev</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span><span class="o">**</span><span class="mi">2</span>

                <span class="k">if</span> <span class="p">(</span> <span class="n">compute_skewness</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;skewness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;skewness&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span><span class="o">**</span><span class="mi">3</span>

                <span class="k">if</span> <span class="p">(</span> <span class="n">compute_kurtosis</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;kurtosis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;kurtosis&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">I</span><span class="o">**</span><span class="mi">4</span>

                <span class="k">if</span> <span class="p">(</span> <span class="n">compute_median</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">&lt;</span><span class="n">nmedstore</span><span class="p">)</span> <span class="p">:</span>
                        <span class="c1"># Just store</span>
                        <span class="n">I_median_list</span><span class="p">[</span><span class="n">k</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">I</span>
                    <span class="k">else</span> <span class="p">:</span>
                        <span class="c1"># Store new image</span>
                        <span class="n">I_median_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">I</span>
                        <span class="c1"># Sort the new list</span>
                        <span class="n">I_median_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">I_median_list</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="c1"># Find the new median with the boundary shifts</span>
                        <span class="n">index_median</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_median_boundary_count</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:]</span><span class="o">-</span><span class="n">I_median_boundary_count</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span> <span class="o">+</span> <span class="n">nmedstore</span> <span class="p">)</span><span class="o">//</span><span class="mi">2</span>
                        <span class="c1"># Remove the side furthest from the median</span>
                        <span class="n">shift_median</span> <span class="o">=</span> <span class="p">(</span><span class="n">index_median</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="o">*</span><span class="n">nmedstore</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
                            <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
                                <span class="n">I_median_list</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nmedstore</span><span class="p">,</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span> <span class="o">=</span> <span class="n">I_median_list</span><span class="p">[(</span><span class="n">shift_median</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]):(</span><span class="n">nmedstore</span><span class="o">+</span><span class="n">shift_median</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]),</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span>
                        <span class="c1">#I_median_list[0:nmedstore,:,:] = I_median_list[(shift_median):(nmedstore+shift_median),:,:]</span>
                        <span class="c1"># Accumulate the lost side</span>
                        <span class="n">I_median_boundary_count</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">shift_median</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">I_median_boundary_count</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">shift_median</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>


            <span class="c1"># Finish the computation of the statistics</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">compute_mean</span> <span class="p">)</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">flattened_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="p">(</span> <span class="n">compute_stddev</span> <span class="p">)</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">flattened_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
                
            <span class="k">if</span> <span class="p">(</span> <span class="n">compute_skewness</span> <span class="p">)</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;skewness&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;skewness&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">flattened_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mf">3.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="p">(</span> <span class="n">compute_kurtosis</span> <span class="p">)</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;kurtosis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;kurtosis&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">flattened_chain</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mf">4.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;skewness&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">6.0</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">4</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span> <span class="n">compute_median</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">I_median_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">I_median_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">index_median</span> <span class="o">=</span> <span class="p">(</span><span class="n">I_median_boundary_count</span><span class="p">[</span><span class="mi">1</span><span class="p">,:,:]</span><span class="o">-</span><span class="n">I_median_boundary_count</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span> <span class="o">+</span> <span class="n">nmedstore</span> <span class="p">)</span><span class="o">//</span><span class="mi">2</span>
                <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">][</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span> <span class="o">=</span> <span class="n">I_median_list</span><span class="p">[</span><span class="n">index_median</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">],</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">pb</span><span class="o">.</span><span class="n">finish</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">stats_generated</span> <span class="o">=</span> <span class="kc">True</span>

            
        <span class="c1"># Return desired quantities</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">Idict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">default_stat</span><span class="p">]</span></div>
            
            
    
<div class="viewcode-block" id="model_image_single_point_statistics.parameter_name_list"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_single_point_statistics.parameter_name_list">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_name_list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">parameter_name_list</span><span class="p">()</span></div></div>
    
    
<div class="viewcode-block" id="expand_model_glob_ccm_mexico"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.expand_model_glob_ccm_mexico">[docs]</a><span class="k">def</span> <span class="nf">expand_model_glob_ccm_mexico</span><span class="p">(</span><span class="n">model_glob</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Expands an abbreviated model glob as produced by the ccm_mexico driver </span>
<span class="sd">    and generates a list of individual model specifiers. Model glob options </span>
<span class="sd">    are supplemented beyond that in the ccm_mexico driver in that they permit </span>
<span class="sd">    unlimited components of any type (i.e., the ccm_mexico+ standard).</span>

<span class="sd">    Current list of accepted model strings are:</span>

<span class="sd">    * &#39;g&#39; ....... :class:`model_image_symmetric_gaussian`</span>
<span class="sd">    * &#39;G&#39; ....... :class:`model_image_symmetric_gaussian`</span>
<span class="sd">    * &#39;a&#39; ....... :class:`model_image_asymmetric_gaussian`</span>
<span class="sd">    * &#39;A&#39; ....... :class:`model_image_asymmetric_gaussian`</span>
<span class="sd">    * &#39;c&#39; ....... :class:`model_image_crescent`</span>
<span class="sd">    * &#39;x&#39; ....... :class:`model_image_xsring`</span>
<span class="sd">    * &#39;X&#39; ....... :class:`model_image_xsringauss`</span>
<span class="sd">    * &#39;r&#39; ....... :class:`model_image_splined_raster`, hyperparameters must be provided for ths model.  Required: {&#39;splined_raster_Nx&#39;:Nx, &#39;splined_raster_Ny&#39;:Ny, &#39;splined_raster_fovx&#39;:fovx, &#39;splined_raster_fovy&#39;:fovy}.  Optional: {&#39;splined_raster_a&#39;:-0.5, &#39;splined_raster_fft&#39;:&#39;fft&#39;, &#39;splined_raster_themis_fft_sign&#39;:True}</span>
<span class="sd">    * &#39;R&#39; ....... :class:`model_image_adaptive_splined_raster`, hyperparameters must be provided for ths model.  Required: {&#39;splined_raster_Nx&#39;:Nx, &#39;splined_raster_Ny&#39;:Ny}.  Optional: {&#39;splined_raster_a&#39;:-0.5, &#39;splined_raster_fft&#39;:&#39;fft&#39;, &#39;splined_raster_themis_fft_sign&#39;:True}</span>
<span class="sd">    * &#39;s&#39; ....... The immediately following specification will be assumed to be part of a :class:`model_image_smooth` object.</span>
<span class="sd">    * &#39;&lt;#&gt;&#39; ..... The immediately preceding model will repeated the specified number of times (e.g., &#39;a3&#39; will be expanded to &#39;aaa&#39;, &#39;sX3&#39; will be expanded to &#39;sXsXsX&#39;).</span>

<span class="sd">    Args:</span>
<span class="sd">      model_glob (str): Model glob string.</span>
<span class="sd">      hyper_parameters (dict) : Optional set of hyperparameters for image models that require them.  Where they are not provided for required arguments a RuntimeError will be raised.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (list): List of individual model specifiers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Make sure that model_glob is a string</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">model_glob</span><span class="p">,</span><span class="nb">str</span><span class="p">))</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized model_glob </span><span class="si">%s</span><span class="s2">. model_glob must be string formatted as described in the documentation.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">model_glob</span><span class="p">))</span>

    <span class="c1"># Expand model_glob to take out numbers</span>
    <span class="n">expanded_model_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">intsplit_model_glob</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;(\d+)&#39;</span><span class="p">,</span><span class="n">model_glob</span><span class="p">)</span>
    
    <span class="n">ks</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="p">(</span> <span class="n">ks</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">intsplit_model_glob</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
        
        <span class="n">ms</span> <span class="o">=</span> <span class="n">intsplit_model_glob</span><span class="p">[</span><span class="n">ks</span><span class="p">]</span>

        <span class="c1"># Peak ahead for integers</span>
        <span class="n">repeat_number</span><span class="o">=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">intsplit_model_glob</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span> <span class="n">intsplit_model_glob</span><span class="p">[</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span> <span class="p">)</span> <span class="p">:</span>
                <span class="n">repeat_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">intsplit_model_glob</span><span class="p">[</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">ks</span> <span class="o">=</span> <span class="n">ks</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="n">k</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span> <span class="n">k</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span> <span class="p">)</span> <span class="p">:</span>

            <span class="n">m</span> <span class="o">=</span> <span class="n">ms</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="c1"># If smooth key-character passed, grab next specifier</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="o">==</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">model_glob</span><span class="p">[</span><span class="n">k</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repeat_number</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">expanded_model_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">expanded_model_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>

            <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span>

        <span class="n">ks</span> <span class="o">=</span> <span class="n">ks</span><span class="o">+</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">expanded_model_list</span></div>


    
<div class="viewcode-block" id="construct_model_image_from_ccm_mexico"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.construct_model_image_from_ccm_mexico">[docs]</a><span class="k">def</span> <span class="nf">construct_model_image_from_ccm_mexico</span><span class="p">(</span><span class="n">model_glob</span><span class="p">,</span><span class="n">hyperparameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a model glob as produced by the ccm_mexico driver and generates </span>
<span class="sd">    a corresponding :class:`model_image` object. If more than one model</span>
<span class="sd">    specifier is provided, an appropriate :class:`model_image_sum` object </span>
<span class="sd">    is returned. Model glob options are supplemented beyond that in the </span>
<span class="sd">    ccm_mexico driver in that they permit unlimited components of any type </span>
<span class="sd">    (i.e., the ccm_mexico+ standard).</span>

<span class="sd">    Current list of accepted model strings are listed in :func:`expand_model_glob_ccm_mexico`.  </span>
<span class="sd">    In addition, for the following model specifiers the associated hyperparameters</span>
<span class="sd">    must be provided as a dictionary:</span>

<span class="sd">    * &#39;r&#39; ....... :class:`model_image_splined_raster`, hyperparameters must be provided for ths model.  Required: {&#39;splined_raster_Nx&#39;:Nx, &#39;splined_raster_Ny&#39;:Ny, &#39;splined_raster_fovx&#39;:fovx, &#39;splined_raster_fovy&#39;:fovy}.  Optional: {&#39;splined_raster_a&#39;:-0.5, &#39;splined_raster_fft&#39;:&#39;fft&#39;, &#39;splined_raster_themis_fft_sign&#39;:True}</span>
<span class="sd">    * &#39;R&#39; ....... :class:`model_image_adaptive_splined_raster`, hyperparameters must be provided for ths model.  Required: {&#39;splined_raster_Nx&#39;:Nx, &#39;splined_raster_Ny&#39;:Ny}.  Optional: {&#39;splined_raster_a&#39;:-0.5, &#39;splined_raster_fft&#39;:&#39;fft&#39;, &#39;splined_raster_themis_fft_sign&#39;:True}</span>

<span class="sd">    Args:</span>
<span class="sd">      model_glob (str): Model glob string.</span>
<span class="sd">      hyper_parameters (dict) : Optional set of hyperparameters for image models that require them. This optionally includes {&#39;offset_coordinates&#39;:&#39;Cartesian&#39;/&#39;polar&#39;} to set the coordinate type for the construction of a :class:`model_image_sum` object when more than one element is implied by the model_glob. Where they are not provided for required arguments a RuntimeError will be raised.</span>
<span class="sd">      verbosity (int): Verbosity level. 0 prints nothing. 1 prints model_glob information.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (model_image): A corresponding model image object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating model_image object for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">model_glob</span><span class="p">))</span>

    <span class="n">expanded_model_list</span> <span class="o">=</span> <span class="n">expand_model_glob_ccm_mexico</span><span class="p">(</span><span class="n">model_glob</span><span class="p">)</span>
            
    <span class="c1"># A list of the constructed image objects</span>
    <span class="n">image_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">expanded_model_list</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;g&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_image_symmetric_gaussian</span><span class="p">())</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;G&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_image_symmetric_gaussian</span><span class="p">())</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_image_asymmetric_gaussian</span><span class="p">())</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_image_asymmetric_gaussian</span><span class="p">())</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;c&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_image_crescent</span><span class="p">())</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_image_xsring</span><span class="p">())</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;X&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_image_xsringauss</span><span class="p">())</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">hpreq</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;splined_raster_Nx&#39;</span><span class="p">,</span><span class="s1">&#39;splined_raster_Ny&#39;</span><span class="p">,</span><span class="s1">&#39;splined_raster_fovx&#39;</span><span class="p">,</span><span class="s1">&#39;splined_raster_fovy&#39;</span><span class="p">]</span>
            <span class="n">hpopt</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;splined_raster_a&#39;</span><span class="p">,</span><span class="s1">&#39;splined_raster_fft&#39;</span><span class="p">,</span><span class="s1">&#39;splined_raster_themis_fft_sign&#39;</span><span class="p">]</span>
            <span class="n">hpvals</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="s1">&#39;fft&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">hyperparameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;hyperparameters must be provided to generate a model_image_splined_raster object.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hpreq</span><span class="p">))</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">hpreq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">hpvals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">hyperparameters</span><span class="p">[</span><span class="n">hpreq</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> must be provided in the hyperparameters passed to generate a model_image_splined_raster object.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">hpreq</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hpopt</span><span class="p">))</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">hpopt</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">hpvals</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">hpreq</span><span class="p">)]</span> <span class="o">=</span> <span class="n">hyperparameters</span><span class="p">[</span><span class="n">hpopt</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
            <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_image_splined_raster</span><span class="p">(</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">a</span><span class="o">=</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">spline_method</span><span class="o">=</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">themis_fft_sign</span><span class="o">=</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;R&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">hpreq</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;adaptive_splined_raster_Nx&#39;</span><span class="p">,</span><span class="s1">&#39;adaptive_splined_raster_Ny&#39;</span><span class="p">]</span>
            <span class="n">hpopt</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;adaptive_splined_raster_a&#39;</span><span class="p">,</span><span class="s1">&#39;adaptive_splined_raster_fft&#39;</span><span class="p">,</span><span class="s1">&#39;adaptive_splined_raster_themis_fft_sign&#39;</span><span class="p">]</span>
            <span class="n">hpvals</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="s1">&#39;fft&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">hyperparameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;hyperparameters must be provided to generate a model_image_splined_raster object.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hpreq</span><span class="p">))</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">hpreq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">hpvals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">hyperparameters</span><span class="p">[</span><span class="n">hpreq</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> must be provided in the hyperparameters passed to generate a model_image_splined_raster object.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">hpreq</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hpopt</span><span class="p">))</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">hpopt</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">hpvals</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">hpreq</span><span class="p">)]</span> <span class="o">=</span> <span class="n">hyperparameters</span><span class="p">[</span><span class="n">hpopt</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
            <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_image_adaptive_splined_raster</span><span class="p">(</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="o">=</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">spline_method</span><span class="o">=</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">themis_fft_sign</span><span class="o">=</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not a valid model specifier in the ccm_mexico+ tag version set.&quot;</span><span class="o">%</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">image_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_image_smooth</span><span class="p">(</span><span class="n">image_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_list</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">image_list</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="n">image_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">hyperparameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span> <span class="s1">&#39;offset_coordinates&#39;</span> <span class="ow">in</span> <span class="n">hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span> <span class="n">model_image_sum</span><span class="p">(</span><span class="n">image_list</span><span class="p">,</span><span class="n">offset_coordinates</span><span class="o">=</span><span class="n">hyperparameters</span><span class="p">[</span><span class="s1">&#39;offset_coordinates&#39;</span><span class="p">])</span> <span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span> <span class="n">model_image_sum</span><span class="p">(</span><span class="n">image_list</span><span class="p">)</span> <span class="p">)</span></div>
            

<div class="viewcode-block" id="write_model_tag_file_from_ccm_mexico"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.write_model_tag_file_from_ccm_mexico">[docs]</a><span class="k">def</span> <span class="nf">write_model_tag_file_from_ccm_mexico</span><span class="p">(</span><span class="n">model_glob</span><span class="p">,</span><span class="n">hyperparameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">tag_file_name</span><span class="o">=</span><span class="s1">&#39;model_image.tag&#39;</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads a model glob as produced by the ccm_mexico driver and writes a</span>
<span class="sd">    corresponding tagvers-1.0 model_image.tag file. Model glob options are </span>
<span class="sd">    supplemented beyond that in the ccm_mexico driver in that they permit </span>
<span class="sd">    unlimited components of any type (i.e., the ccm_mexico+ standard).</span>

<span class="sd">    Current list of accepted model strings are listed in :func:`expand_model_glob_ccm_mexico`.  </span>
<span class="sd">    In addition, for the following model specifiers the associated hyperparameters</span>
<span class="sd">    must be provided as a dictionary:</span>

<span class="sd">    * &#39;r&#39; ....... :class:`model_image_splined_raster`, hyperparameters must be provided for ths model.  Required: {&#39;splined_raster_Nx&#39;:Nx, &#39;splined_raster_Ny&#39;:Ny, &#39;splined_raster_fovx&#39;:fovx, &#39;splined_raster_fovy&#39;:fovy}.  Optional: {&#39;splined_raster_a&#39;:-0.5, &#39;splined_raster_fft&#39;:&#39;fft&#39;, &#39;splined_raster_themis_fft_sign&#39;:True}</span>
<span class="sd">    * &#39;R&#39; ....... :class:`model_image_adaptive_splined_raster`, hyperparameters must be provided for ths model.  Required: {&#39;splined_raster_Nx&#39;:Nx, &#39;splined_raster_Ny&#39;:Ny}.  Optional: {&#39;splined_raster_a&#39;:-0.5, &#39;splined_raster_fft&#39;:&#39;fft&#39;, &#39;splined_raster_themis_fft_sign&#39;:True}</span>

<span class="sd">    Args:</span>
<span class="sd">      model_glob (str): Model glob string.</span>
<span class="sd">      hyper_parameters (dict) : Optional set of hyperparameters for image models that require them.  Where they are not provided for required arguments a RuntimeError will be raised.</span>
<span class="sd">      tag_file_name (str): Name of tag file to be written. Default: &#39;model_image.tag&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating tag file for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">model_glob</span><span class="p">))</span>
    
    <span class="c1"># Generate</span>
    <span class="n">expanded_model_list</span> <span class="o">=</span> <span class="n">expand_model_glob_ccm_mexico</span><span class="p">(</span><span class="n">model_glob</span><span class="p">)</span>

    <span class="c1"># Open tag file</span>
    <span class="n">tagout</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">tag_file_name</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;tagvers-1.0</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># If a model_image_sum object:</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expanded_model_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">offset_coordinates</span> <span class="o">=</span> <span class="s1">&#39;Cartesian&#39;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="ow">not</span> <span class="p">(</span><span class="n">hyperparameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;offset_coordinates&#39;</span> <span class="ow">in</span> <span class="n">hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span>
                <span class="n">offset_coordinates</span> <span class="o">=</span> <span class="n">hyperparameters</span><span class="p">[</span><span class="s1">&#39;offset_coordinates&#39;</span><span class="p">]</span>
        <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;model_image_sum </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">offset_coordinates</span><span class="p">))</span>
        <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SUBTAG START</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">expanded_model_list</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;model_image_smooth</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SUBTAG START</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;g&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;model_image_symmetric_gaussian</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;G&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;model_image_symmetric_gaussian</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;model_image_asymmetric_gaussian</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;A&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;model_image_asymmetric_gaussian</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;c&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;model_image_crescent</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;x&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;model_image_xsring</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;X&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;model_image_xsringauss</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">hpreq</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;splined_raster_Nx&#39;</span><span class="p">,</span><span class="s1">&#39;splined_raster_Ny&#39;</span><span class="p">,</span><span class="s1">&#39;splined_raster_fovx&#39;</span><span class="p">,</span><span class="s1">&#39;splined_raster_fovy&#39;</span><span class="p">]</span>
            <span class="n">hpopt</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;splined_raster_a&#39;</span><span class="p">]</span>
            <span class="n">hpvals</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">hyperparameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;hyperparameters must be provided to generate a model_image_splined_raster object.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hpreq</span><span class="p">))</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">hpreq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">hpvals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">hyperparameters</span><span class="p">[</span><span class="n">hpreq</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> must be provided in the hyperparameters passed to generate a model_image_splined_raster object.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">hpreq</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hpopt</span><span class="p">))</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">hpopt</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">hpvals</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">hpreq</span><span class="p">)]</span> <span class="o">=</span> <span class="n">hyperparameters</span><span class="p">[</span><span class="n">hpopt</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
            <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;model_image_splined_raster </span><span class="si">%i</span><span class="s2"> </span><span class="si">%i</span><span class="s2"> </span><span class="si">%g</span><span class="s2"> </span><span class="si">%g</span><span class="s2"> </span><span class="si">%g</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;R&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">hpreq</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;adaptive_splined_raster_Nx&#39;</span><span class="p">,</span><span class="s1">&#39;adaptive_splined_raster_Ny&#39;</span><span class="p">]</span>
            <span class="n">hpopt</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;adaptive_splined_raster_a&#39;</span><span class="p">]</span>
            <span class="n">hpvals</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">hyperparameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;hyperparameters must be provided to generate a model_image_splined_raster object.&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hpreq</span><span class="p">))</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">hpreq</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">hpvals</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">hyperparameters</span><span class="p">[</span><span class="n">hpreq</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> must be provided in the hyperparameters passed to generate a model_image_splined_raster object.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">hpreq</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hpopt</span><span class="p">))</span> <span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span> <span class="n">hpopt</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">in</span> <span class="n">hyperparameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">)</span> <span class="p">:</span>
                    <span class="n">hpvals</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">hpreq</span><span class="p">)]</span> <span class="o">=</span> <span class="n">hyperparameters</span><span class="p">[</span><span class="n">hpopt</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>
            <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;model_image_adaptive_splined_raster </span><span class="si">%i</span><span class="s2"> </span><span class="si">%i</span><span class="s2"> </span><span class="si">%g</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">hpvals</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> is not a valid model specifier in the ccm_mexico+ tag version set.&quot;</span><span class="o">%</span><span class="n">m</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;s&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SUBTAG FINISH</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># If a model_image_sum object:</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">expanded_model_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">tagout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;SUBTAG FINISH</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Finish tag file</span>
    <span class="n">tagout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
    


<div class="viewcode-block" id="tagv1_find_subtag"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.tagv1_find_subtag">[docs]</a><span class="k">def</span> <span class="nf">tagv1_find_subtag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given a tag that begins with SUBTAG START, find the subtag within the matching</span>
<span class="sd">    SUBTAG FINISH.</span>

<span class="sd">    Args:</span>
<span class="sd">      tag (list): List of tag lines.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (list): List of tag lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Make sure that the first line is indeed SUBTAG START</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;SUBTAG START&quot;</span><span class="p">)</span> <span class="p">:</span>
        <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Invalid subtag!  Expected SUBTAG START.  Found </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    
    <span class="c1"># Find index of matching SUBTAG FINISH</span>
    <span class="n">subtag_level</span><span class="o">=</span><span class="mi">1</span>
    <span class="n">k</span><span class="o">=</span><span class="mi">1</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">subtag_level</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;SUBTAG START&quot;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">subtag_level</span> <span class="o">=</span> <span class="n">subtag_level</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;SUBTAG FINISH&quot;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">subtag_level</span> <span class="o">=</span> <span class="n">subtag_level</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:(</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span></div>
    
    
<div class="viewcode-block" id="construct_model_image_from_tagv1"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.construct_model_image_from_tagv1">[docs]</a><span class="k">def</span> <span class="nf">construct_model_image_from_tagv1</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses a tagvers-1.0 Themis tag and recursively constructs a model image.</span>

<span class="sd">    Args:</span>
<span class="sd">      tag (list) : List of tags, arranged as str on separate lines.</span>
<span class="sd">      verbosity (int): Verbosity level. 0 prints nothing. 1 prints tag information.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (model_image, list) : The first :class:`model_image` object fully described within the tag; the remaining tag lines.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%i</span><span class="s2"> : </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">tag</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------------------------------&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;model_image_symmetric_gaussian&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="n">model_image_symmetric_gaussian</span><span class="p">(),</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;model_image_asymmetric_gaussian&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="n">model_image_asymmetric_gaussian</span><span class="p">(),</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;model_image_crescent&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="n">model_image_crescent</span><span class="p">(),</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;model_image_xsring&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="n">model_image_xsring</span><span class="p">(),</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;model_image_xsringauss&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="n">model_image_xsringauss</span><span class="p">(),</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;model_image_splined_raster&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">toks</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">model_image_splined_raster</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">7</span><span class="p">])),</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;model_image_adaptive_splined_raster&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">toks</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">model_image_adaptive_splined_raster</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">toks</span><span class="p">[</span><span class="mi">3</span><span class="p">])),</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;model_image_smooth&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">subtag</span> <span class="o">=</span> <span class="n">tagv1_find_subtag</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">subimage</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">construct_model_image_from_tagv1</span><span class="p">(</span><span class="n">subtag</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model_image_smooth</span><span class="p">(</span><span class="n">subimage</span><span class="p">),</span><span class="n">tag</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">subtag</span><span class="p">)</span><span class="o">+</span><span class="mi">3</span><span class="p">):]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;model_image_sum&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">offset_coordinates</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">subtag</span> <span class="o">=</span> <span class="n">tagv1_find_subtag</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="n">len_subtag</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subtag</span><span class="p">)</span>
        <span class="n">image_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">subtag</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">subimage</span><span class="p">,</span><span class="n">subtag</span> <span class="o">=</span> <span class="n">construct_model_image_from_tagv1</span><span class="p">(</span><span class="n">subtag</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
            <span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subimage</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model_image_sum</span><span class="p">(</span><span class="n">image_list</span><span class="p">,</span><span class="n">offset_coordinates</span><span class="o">=</span><span class="n">offset_coordinates</span><span class="p">),</span><span class="n">tag</span><span class="p">[</span><span class="n">len_subtag</span><span class="o">+</span><span class="mi">3</span><span class="p">:]</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized model tag </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span></div>

    
<div class="viewcode-block" id="construct_model_image_from_tag_file"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.construct_model_image_from_tag_file">[docs]</a><span class="k">def</span> <span class="nf">construct_model_image_from_tag_file</span><span class="p">(</span><span class="n">tag_file_name</span><span class="o">=</span><span class="s1">&#39;model_image.tag&#39;</span><span class="p">,</span> <span class="n">tagversion</span><span class="o">=</span><span class="s1">&#39;tagvers-1.0&#39;</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads tag file produced by the :cpp:func:`Themis::model_image::write_model_tag_file` function </span>
<span class="sd">    and returns an appropriate model image. Model tag files can be generated from ccm_mexico+ model </span>
<span class="sd">    specification strings using :func:`write_model_tag_file_from_ccm_mexico`. For details about</span>
<span class="sd">    the available model tag syntax, see :cpp:func:`Themis::model_image::write_model_tag_file`.</span>

<span class="sd">    Args:</span>
<span class="sd">      tag_file_name (str): Name of the tag_file. Default: &#39;model_image.tag&#39;</span>
<span class="sd">      tagversion (str): Version of tag system. Currently only tagvers-1.0 is implemented. Default &#39;tagvers-1.0&#39;.</span>
<span class="sd">      verbosity (int): Verbosity level. 0 prints nothing. 1 prints tag information.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (model_image): :class:`model_image` object of the corresponding model.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="n">tagin</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tag_file_name</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tagin</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">tagin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    <span class="n">tag</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\r</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">tag</span><span class="p">]</span>
    <span class="n">tagversion_file</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">tagversion_file</span><span class="o">==</span><span class="n">tagversion</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">image</span><span class="p">,</span><span class="n">tag</span> <span class="o">=</span> <span class="n">construct_model_image_from_tagv1</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">((</span><span class="s2">&quot;Remaining tag lines:&quot;</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="s2">&quot;   </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span><span class="o">%</span><span class="nb">tuple</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">image</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Tag versions other than tagvers-1.0 are not supported at this time.&quot;</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="construct_model_image_from_glob"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.construct_model_image_from_glob">[docs]</a><span class="k">def</span> <span class="nf">construct_model_image_from_glob</span><span class="p">(</span><span class="n">model_glob</span><span class="p">,</span> <span class="n">glob_version</span><span class="p">,</span> <span class="n">hyperparameters</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Constructs a :class:`model_image` object given an appropriate model specification glob.  </span>
<span class="sd">    Currently accepted globs include:</span>

<span class="sd">    * ccm_mexico+ model specification string. These are an extended set of the strings used by the ccm_m87_mexico drivers.  For example, sXaagG.  For raster model types, hyperparameters must be supplied.  See :func:`expand_model_glob_ccm_mexico` for details regarding the required form.</span>
<span class="sd">    * model tag file name. These can be output by Themis directly and encompass a wider set of possible models.</span>

<span class="sd">    The appropriate associated glob version must be specified. For some specifications an additional set of hyperparameters may need to be supplied.</span>

<span class="sd">    Args:</span>
<span class="sd">      model_glob (str): Glob defining model image. Examples are &#39;sXaagG&#39; or &#39;model_image.tag&#39;</span>
<span class="sd">      tagversion (str): Version of tag system. Currently only tagvers-1.0 is implemented. Default &#39;tagvers-1.0&#39;.</span>
<span class="sd">      hyperparameters (dict): Dictionary of hyperparameters if needed by the specification.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (model_image): :class:`model_image` object of the corresponding model.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">glob_version</span><span class="o">==</span><span class="s1">&#39;ccm_mexico&#39;</span> <span class="ow">or</span> <span class="n">glob_version</span><span class="o">==</span><span class="s1">&#39;ccm_mexico+&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="n">construct_model_image_from_ccm_mexico</span><span class="p">(</span><span class="n">model_glob</span><span class="p">,</span><span class="n">hyperparameters</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">glob_version</span><span class="o">==</span><span class="s1">&#39;tagvers-1.0&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="n">construct_model_image_from_tag_file</span><span class="p">(</span><span class="n">model_glob</span><span class="p">,</span><span class="n">glob_version</span><span class="p">)</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized model_glob version: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">version</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="plot_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.plot_intensity_map">[docs]</a><span class="k">def</span> <span class="nf">plot_intensity_map</span><span class="p">(</span><span class="n">model_image</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;afmhot&#39;</span><span class="p">,</span> <span class="n">Imin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">Imax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">in_radec</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_intensity_map</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transfer_function</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots an intensity map associated with a given :class:`model_image` object evaluated at a </span>
<span class="sd">    specified set of parameters. A number of additional practical options may be passed. Access</span>
<span class="sd">    to a matplotlib pcolor object, the figure handle and axes hanldes are returned. Optionally,</span>
<span class="sd">    the intensity map is returned.</span>

<span class="sd">    Args:</span>
<span class="sd">      model_image (model_image): :class:`model_image` object to plot.</span>
<span class="sd">      parameters (list): List of parameters that define model_image intensity map.</span>
<span class="sd">      limits (float,list): Limits in uas on image size. If a single float is given, the limits are uniformly set. If a list is given, it must be in the form [xmin,xmax,ymin,ymax]. Default: 75</span>
<span class="sd">      shape (int,list): Number of pixels. If a single int is given, the number of pixels are uniformly set in both directions.  If a list is given, it must be in the form [Nx,Ny]. Default: 256</span>
<span class="sd">      colormap (matplotlib.colors.Colormap): A colormap name as specified in :mod:`matplotlib.cm`. Default: &#39;afmhot&#39;.</span>
<span class="sd">      Imin (float): Minimum intensity for colormap. Default: 0 (though see transfer_function).</span>
<span class="sd">      Imax (float): Maximum intensity for colormap. Default: maximum intensity.</span>
<span class="sd">      in_radec (bool): If True, plots in :math:`\\Delta RA` and :math:`\\Delta Dec`.  If False, plots in sky-right Cartesian coordinates. Default: True</span>
<span class="sd">      xlabel (str): Label for xaxis. Default: &#39;:math:`\\Delta RA (\\mu as)` if in_radec is True, :math:`\\Delta x (\\mu as)` if in_radec is False</span>
<span class="sd">      ylabel (str): Label for yaxis. Default: &#39;:math:`\\Delta Dec (\\mu as)` if in_radec is True, :math:`\\Delta y (\\mu as)` if in_radec is False</span>
<span class="sd">      return_intensity_map (bool): If True returns the intensity map in addition to standard return items.</span>
<span class="sd">      transfer_function (str): Transfer function to plot.  Options are &#39;linear&#39;,&#39;sqrt&#39;,&#39;log&#39;.  If &#39;log&#39;, if Imin=0 it will be set to Imax/1000.0 by default, else if Imin&lt;0 it will be assumed to be a dynamic range and Imin = Imax * 10**(Imin).</span>
<span class="sd">      verbosity (int): Verbosity level. 0 prints nothing. 1 prints various elements of the plotting process. Passed to :func:`model_image.generate_intensity_map`. Default: 0.</span>

<span class="sd">    Returns :</span>
<span class="sd">      (matplotlib.pyplot.image,matplotlib.pyplot.axes,matplotlib.pyplot.fig,[numpy.ndarray,numpy.ndarray,numpy.ndarray]): Image handle; Figure object; Axes object; Optionally intensity map (x,y,I).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Shape limits</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">75</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="o">-</span><span class="mi">75</span><span class="p">,</span> <span class="mi">75</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">limits</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">limits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">limits</span><span class="p">,</span> <span class="n">limits</span><span class="p">,</span> <span class="o">-</span><span class="n">limits</span><span class="p">,</span> <span class="n">limits</span><span class="p">]</span>

    <span class="c1"># Set shape</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span> <span class="mi">256</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">shape</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">]</span>

    <span class="c1"># Set labels</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">in_radec</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\Delta$RA ($\mu$as)&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\Delta$x ($\mu$as)&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">in_radec</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\Delta$Dec ($\mu$as)&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\Delta$y ($\mu$as)&#39;</span>
        

    <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;limits:&quot;</span><span class="p">,</span><span class="n">limits</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;shape:&quot;</span><span class="p">,</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="c1"># Generate a set of pixels</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span><span class="n">limits</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span><span class="n">limits</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>
    <span class="c1"># Generate a set of intensities (Jy/uas^2)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">model_image</span><span class="o">.</span><span class="n">intensity_map</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">parameters</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
    
    <span class="c1"># Flip x to flip x axis so that RA decreases right to left</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">in_radec</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">limits</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    
    <span class="c1"># Determine scale</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">Imax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">Imax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Minimum/Maximum I: </span><span class="si">%g</span><span class="s2"> / </span><span class="si">%g</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">Imin</span><span class="p">,</span><span class="n">Imax</span><span class="p">))</span>
        
    <span class="c1"># Transfered I for plotting</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">transfer_function</span><span class="o">==</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">tI</span> <span class="o">=</span> <span class="n">I</span><span class="o">/</span><span class="n">Imax</span>
        <span class="n">Imin</span> <span class="o">=</span> <span class="n">Imin</span><span class="o">/</span><span class="n">Imax</span>
        <span class="n">Imax</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">transfer_function</span><span class="o">==</span><span class="s1">&#39;sqrt&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">tI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">I</span><span class="o">/</span><span class="n">Imax</span><span class="p">)</span>
        <span class="n">Imin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Imin</span><span class="o">/</span><span class="n">Imax</span><span class="p">)</span>
        <span class="n">Imax</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">transfer_function</span><span class="o">==</span><span class="s1">&#39;log&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">tI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">I</span><span class="o">/</span><span class="n">Imax</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">Imin</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">Imin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.0e-3</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">Imin</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">Imin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Imin</span><span class="o">/</span><span class="n">Imax</span><span class="p">)</span>
        <span class="n">Imax</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># Set background color in Axes</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>    
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">cmap</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>

    <span class="c1"># Make plot</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">tI</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">Imin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">Imax</span><span class="p">)</span>
    
    <span class="c1"># Add labels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    
    <span class="c1"># Fix aspect ratio</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;square&#39;</span><span class="p">)</span>

    <span class="c1"># Fix x-axis to run in sky</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">in_radec</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">invert_xaxis</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">return_intensity_map</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="n">h</span><span class="p">,</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">I</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">h</span><span class="p">,</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">(),</span><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span></div>
    


<div class="viewcode-block" id="write_fits"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.write_fits">[docs]</a><span class="k">def</span> <span class="nf">write_fits</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">fits_filename</span><span class="p">,</span><span class="n">uvfits_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Writes a FITS format image file given 2D image data.  </span>

<span class="sd">    Warning: </span>

<span class="sd">      * This makes extensive use of ehtim and will not be available if ehtim is not installed.  Raises a NotImplementedError if ehtim is unavailable.</span>
<span class="sd">      * Due to ehtim, only *square* images are supported at this time.</span>

<span class="sd">    Args:</span>
<span class="sd">      x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">      y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">      I (numpy.ndarray): Array of intensity values in (Jy/uas^2)</span>
<span class="sd">      fits_filename (str): Name of output FITS file.</span>
<span class="sd">      uvfits_filename (str): Optional name of uvfits file with relevant header data.  Failing to provide this may result in unusable FITS files.</span>
<span class="sd">      time (float): Time in hr on the relevant observation day (set by uvfits file) represented by image data.</span>
<span class="sd">      verbosity (int): Verbosity parameter. If 0, no information is printed.  If &gt;=1, prints information about sizes and values.  If &gt;=2, generates debugging plots.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ehtim_found</span><span class="o">==</span><span class="kc">False</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;ERROR: write_fits requires ehtim to be installed.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shapes&quot;</span><span class="p">,</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">I</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">I</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span><span class="n">I</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;ERROR: ehtim cannot handle non-square images. Your image had shape&quot;</span><span class="p">,</span><span class="n">I</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pcolor</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">I</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;afmhot&#39;</span><span class="p">)</span>
    
    <span class="n">uas2rad</span> <span class="o">=</span> <span class="mf">1e-6</span> <span class="o">/</span> <span class="mf">3600.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span>
    <span class="n">pixel_size</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">uas2rad</span>
    <span class="n">Ippx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">I</span><span class="p">)</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">Ippx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">Ippx</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">uvfits_filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;No uvfits file has been specified. This will probably result in an nonfunctional FITS header.&quot;</span><span class="p">,</span> <span class="ne">Warning</span><span class="p">)</span>
        <span class="n">ra</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">dec</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="n">rf</span><span class="o">=</span><span class="mf">230e9</span>
        <span class="n">src</span><span class="o">=</span><span class="s1">&#39;NA&#39;</span>
        <span class="n">mjd</span><span class="o">=</span><span class="mi">58583</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">obs</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">obsdata</span><span class="o">.</span><span class="n">load_uvfits</span><span class="p">(</span><span class="n">uvfits_filename</span><span class="p">)</span>
        <span class="n">ra</span><span class="o">=</span><span class="n">obs</span><span class="o">.</span><span class="n">ra</span>
        <span class="n">dec</span><span class="o">=</span><span class="n">obs</span><span class="o">.</span><span class="n">dec</span>
        <span class="n">rf</span><span class="o">=</span><span class="n">obs</span><span class="o">.</span><span class="n">rf</span>
        <span class="n">src</span><span class="o">=</span><span class="n">obs</span><span class="o">.</span><span class="n">source</span>
        <span class="n">mjd</span><span class="o">=</span><span class="n">obs</span><span class="o">.</span><span class="n">mjd</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pixel size:&#39;</span><span class="p">,</span><span class="n">pixel_size</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ra:&#39;</span><span class="p">,</span><span class="n">ra</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;dec:&#39;</span><span class="p">,</span><span class="n">ra</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;rf:&#39;</span><span class="p">,</span><span class="n">ra</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;src:&#39;</span><span class="p">,</span><span class="n">ra</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mjd:&#39;</span><span class="p">,</span><span class="n">ra</span><span class="p">)</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">eh</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="n">Ippx</span><span class="p">,</span><span class="n">pixel_size</span><span class="p">,</span><span class="n">ra</span><span class="p">,</span><span class="n">dec</span><span class="p">,</span><span class="n">rf</span><span class="o">=</span><span class="n">rf</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">src</span><span class="p">,</span><span class="n">mjd</span><span class="o">=</span><span class="n">mjd</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span><span class="n">pulse</span><span class="o">=</span><span class="n">eh</span><span class="o">.</span><span class="n">observing</span><span class="o">.</span><span class="n">pulses</span><span class="o">.</span><span class="n">deltaPulse2D</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">image</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">image</span><span class="o">.</span><span class="n">save_fits</span><span class="p">(</span><span class="n">fits_filename</span><span class="p">)</span></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Themis Development Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.1.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            LINK_SUFFIX:'.html', 
            HAS_SOURCE: 'true'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>