

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>vis.image &mdash; ThemisPy 0+untagged.132.g01cffb0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="ThemisPy 0+untagged.132.g01cffb0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../docs/src/index.html" class="icon icon-home"> ThemisPy
          

          
          </a>

          
            
            
              <div class="version">
                0+untagged.132.g01cffb0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/userguide.html">User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/devel.html">Developer’s Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../docs/src/index.html">ThemisPy</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../docs/src/index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>vis.image</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for vis.image</h1><div class="highlight"><pre>
<span></span><span class="c1">###########################</span>
<span class="c1">#</span>
<span class="c1"># Package:</span>
<span class="c1">#   image</span>
<span class="c1">#</span>
<span class="c1"># Provides:</span>
<span class="c1">#   Provides model image classes and functions.</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span> <span class="k">as</span> <span class="n">sint</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">fftconvolve</span>


<span class="n">rad2uas</span> <span class="o">=</span> <span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mf">1e6</span>
<span class="n">uas2rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mf">180.0</span> <span class="o">*</span> <span class="mi">3600</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">)</span>



<div class="viewcode-block" id="model_image"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image">[docs]</a><span class="k">class</span> <span class="nc">model_image</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for Themis image models.</span>
<span class="sd">    This base class is intended to mirror the Themis::model_image base class, providing </span>
<span class="sd">    explicit visualizations of the output of Themis::model_image-derived model analyses.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      parameters (list): Parameter list for a given model. Default: None.</span>
<span class="sd">      size (int): Number of parameters for a given model. Default: None.</span>
<span class="sd">      themis_fft_sign (bool): Themis FFT sign convention flag.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">themis_fft_sign</span><span class="o">=</span><span class="n">themis_fft_sign</span>
        
<div class="viewcode-block" id="model_image.generate"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the model parameter list.  Mirrors similar a similar function within the </span>
<span class="sd">        Themis::model_image class.  Effectively simply copies the parameters into the </span>
<span class="sd">        local list with some additional run-time checking.</span>

<span class="sd">        Args:</span>
<span class="sd">          parameters (list): Parameter list.</span>

<span class="sd">        Returns:</span>
<span class="sd">          None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Parameter list is inconsistent with the number of parameters expected.&quot;</span><span class="p">)</span></div>
    

<div class="viewcode-block" id="model_image.intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image.intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        External access function to the intenesity map.  Child classes should not overwrite </span>
<span class="sd">        this function.  This implements some parameter assessment and checks the FFT sign</span>
<span class="sd">        convention.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          parameters (list): Parameter list. If none is provided, uses the current set of parameters. Default: None.</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># </span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">themis_fft_sign</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span>

        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">parameters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>

        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_intensity_map</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">themis_fft_sign</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span>
            <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span>
        
        <span class="k">return</span> <span class="n">I</span></div>

    
<div class="viewcode-block" id="model_image.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hook for the intensity map function in child classes.  Assumes that the parameters</span>
<span class="sd">        list has been set.  This should never be called externally.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;intensity_map must be defined in children classes of model_image.&quot;</span><span class="p">)</span></div></div>

    
    
<div class="viewcode-block" id="model_image_symmetric_gaussian"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_symmetric_gaussian">[docs]</a><span class="k">class</span> <span class="nc">model_image_symmetric_gaussian</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Symmetric gaussian image class that is a mirror of Themis::model_image_symmetric_gaussian.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ... Total intensity :math:`I_0` (Jy)</span>
<span class="sd">    * parameters[1] ... Standard deviation :math:`\\sigma` (rad)</span>

<span class="sd">    and size=2.</span>

<span class="sd">    Args:</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">2</span>

        
<div class="viewcode-block" id="model_image_symmetric_gaussian.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_symmetric_gaussian.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">I0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Symmetric Gaussian:&quot;</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">I</span></div></div>

    
<div class="viewcode-block" id="model_image_asymmetric_gaussian"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_asymmetric_gaussian">[docs]</a><span class="k">class</span> <span class="nc">model_image_asymmetric_gaussian</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Asymmetric gaussian image class that is a mirror of Themis::model_image_asymmetric_gaussian.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ... Total intensity :math:`I_0` (Jy)</span>
<span class="sd">    * parameters[1] ... Symmetrized standard deviation :math:`\\sigma` (rad)</span>
<span class="sd">    * parameters[2] ... Asymmetry parameter :math:`A` in (0,1)</span>
<span class="sd">    * parameters[3] ... Position angle :math:`\\phi` (rad)</span>

<span class="sd">    and size=4.</span>

<span class="sd">    Args:</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">4</span>

        
<div class="viewcode-block" id="model_image_asymmetric_gaussian.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_asymmetric_gaussian.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">I0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">/</span><span class="n">s</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Symmetric Gaussian:&quot;</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">s</span><span class="p">)</span>


        <span class="n">s</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="n">A</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mf">0.99</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">sm</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">A</span><span class="p">)</span>
        <span class="n">sM</span> <span class="o">=</span> <span class="n">s</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">A</span><span class="p">)</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sm</span><span class="o">*</span><span class="n">sM</span><span class="p">)</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">dxm</span> <span class="o">=</span> <span class="n">c</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">s</span><span class="o">*</span><span class="n">y</span>
        <span class="n">dxM</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">c</span><span class="o">*</span><span class="n">y</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">I0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span> <span class="n">dxm</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sm</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dxM</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sM</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Asymmetric Gaussian:&quot;</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">sm</span><span class="p">,</span><span class="n">sM</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">I</span></div></div>




<div class="viewcode-block" id="model_image_crescent"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_crescent">[docs]</a><span class="k">class</span> <span class="nc">model_image_crescent</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Symmetric gaussian image class that is a mirror of Themis::model_image_crescent.  </span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ... Total intensity :math:`I_0` (Jy)</span>
<span class="sd">    * parameters[1] ... Outer radius :math:`R` (rad)</span>
<span class="sd">    * parameters[2] ... Width paramter :math:`\\psi` in (0,1)</span>
<span class="sd">    * parameters[3] ... Eccentricity parameter :math:`\\epsilon` in (0,1)</span>
<span class="sd">    * parameters[3] ... Asymmetry parmaeter math:`\\tau` in (0,1)</span>
<span class="sd">    * parameters[4] ... Position angle :math:`\\phi` (rad)</span>

<span class="sd">    and size=5.</span>

<span class="sd">    Args:</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span>

        
<div class="viewcode-block" id="model_image_crescent.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_crescent.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Make sure that delta ring is resolvable</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dx</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rad2uas</span><span class="p">))</span>

        <span class="n">I0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">paramters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Rp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-20</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="n">Rn</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mf">0.9999</span> <span class="p">)</span> <span class="o">*</span> <span class="n">Rp</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">),</span><span class="mf">0.9999</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rp</span> <span class="o">-</span> <span class="n">Rn</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="n">I0</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">Rp</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">Rn</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">I0</span><span class="o">+</span><span class="mi">0</span><span class="o">*</span><span class="n">x</span>
        <span class="n">I</span> <span class="o">*=</span> <span class="p">((</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">Rp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">*=</span> <span class="p">(((</span><span class="n">x</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">Rn</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KD Crescent:&quot;</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">Rp</span><span class="p">,</span><span class="n">Rn</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">I</span>    </div></div>


<div class="viewcode-block" id="model_image_xsring"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_xsring">[docs]</a><span class="k">class</span> <span class="nc">model_image_xsring</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Symmetric gaussian image class that is a mirror of Themis::model_image_xsring.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ... Total intensity :math:`I_0` (Jy)</span>
<span class="sd">    * parameters[1] ... Outer radius :math:`R` (rad)</span>
<span class="sd">    * parameters[2] ... Width paramter :math:`\\psi` in (0,1)</span>
<span class="sd">    * parameters[3] ... Eccentricity parameter :math:`\\epsilon` in (0,1)</span>
<span class="sd">    * parameters[4] ... Linear fade parameter math:`f` in (0,1)</span>
<span class="sd">    * parameters[5] ... Position angle :math:`\\phi` (rad)</span>

<span class="sd">    and size=6.</span>

<span class="sd">    Args:</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">6</span>

        
<div class="viewcode-block" id="model_image_xsring.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_xsring.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Make sure that delta ring is resolvable</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dx</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">rad2uas</span><span class="p">))</span>

        <span class="n">I0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Rp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-20</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="n">Rin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mf">0.9999</span> <span class="p">)</span> <span class="o">*</span> <span class="n">Rp</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">),</span><span class="mf">0.9999</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rp</span> <span class="o">-</span> <span class="n">Rin</span><span class="p">)</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">),</span><span class="mf">0.9999</span><span class="p">);</span>
        <span class="n">sig1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rp</span><span class="p">;</span>
        <span class="n">sig2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig1</span><span class="p">;</span>
        <span class="n">gq</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">),</span><span class="mf">0.9999</span><span class="p">);</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>


        <span class="n">Iring0</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">gq</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">I0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span><span class="mf">1.0</span><span class="o">/</span><span class="p">((</span><span class="mf">1.0</span><span class="o">+</span><span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Rp</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">Rin</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="o">*</span><span class="n">Rin</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Rp</span><span class="p">);</span>
        <span class="n">Igauss0</span> <span class="o">=</span> <span class="n">gq</span><span class="o">*</span><span class="n">I0</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sig1</span><span class="o">*</span><span class="n">sig2</span><span class="p">);</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">c</span> <span class="o">-</span> <span class="n">y</span><span class="o">*</span><span class="n">s</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">x</span><span class="o">*</span><span class="n">s</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">c</span>

        <span class="n">Iring</span> <span class="o">=</span> <span class="n">Iring0</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">dx</span><span class="o">/</span><span class="n">Rp</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="n">dx</span><span class="o">/</span><span class="n">Rp</span><span class="p">))</span> 
        <span class="n">Igauss</span> <span class="o">=</span> <span class="n">Igauss0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">dx</span><span class="o">-</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">Rin</span><span class="p">))</span><span class="o">/</span><span class="n">sig1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="p">((</span><span class="n">dy</span><span class="o">/</span><span class="n">sig2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> 

        <span class="n">Iring</span> <span class="o">*=</span> <span class="p">((</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">Rp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Iring</span> <span class="o">*=</span> <span class="p">(((</span><span class="n">dx</span><span class="o">-</span><span class="n">d</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">dy</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;</span><span class="n">Rin</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;xsringauss:&#39;</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span> <span class="n">Rp</span><span class="p">,</span> <span class="n">Rin</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">sig1</span><span class="p">,</span> <span class="n">sig2</span><span class="p">,</span> <span class="n">gq</span><span class="p">,</span> <span class="n">phi</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">Iring</span><span class="o">+</span><span class="n">Igauss</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="model_image_xsringauss"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_xsringauss">[docs]</a><span class="k">class</span> <span class="nc">model_image_xsringauss</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Symmetric gaussian image class that is a mirror of Themis::model_image_xsring.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ... Total intensity :math:`I_0` (Jy)</span>
<span class="sd">    * parameters[1] ... Outer radius :math:`R` (rad)</span>
<span class="sd">    * parameters[2] ... Width parameter :math:`\\psi` in (0,1)</span>
<span class="sd">    * parameters[3] ... Eccentricity parameter :math:`\\epsilon` in (0,1)</span>
<span class="sd">    * parameters[4] ... Linear fade parameter math:`f` in (0,1)</span>
<span class="sd">    * parameters[5] ... FWHM of the main axis of the Gaussian in units of the ring outer radius math:`g_{ax}`</span>
<span class="sd">    * parameters[6] ... Gaussian axial ratio math:`a_q`</span>
<span class="sd">    * parameters[7] ... Ratio of Gaussian flux to ring flux math:`g_q`</span>
<span class="sd">    * parameters[8] ... Position angle :math:`\\phi` (rad)</span>

<span class="sd">    and size=9.</span>

<span class="sd">    Args:</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">6</span>

        
<div class="viewcode-block" id="model_image_xsringauss.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_xsringauss.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">I0</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-8</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">paramters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Rp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-20</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="n">Rn</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="mf">0.9999</span> <span class="p">)</span> <span class="o">*</span> <span class="n">Rp</span>
        <span class="n">d</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="mf">1e-4</span><span class="p">),</span><span class="mf">0.9999</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rp</span> <span class="o">-</span> <span class="n">Rn</span><span class="p">)</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="n">I0</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">Rp</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">Rn</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">I0</span><span class="o">+</span><span class="mi">0</span><span class="o">*</span><span class="n">x</span>
        <span class="n">I</span> <span class="o">*=</span> <span class="p">((</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">Rp</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">I</span> <span class="o">*=</span> <span class="p">(((</span><span class="n">x</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">Rn</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KD Crescent:&quot;</span><span class="p">,</span><span class="n">I0</span><span class="p">,</span><span class="n">Rp</span><span class="p">,</span><span class="n">Rn</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">I</span></div></div>




<div class="viewcode-block" id="direct_cubic_spline_1d"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.direct_cubic_spline_1d">[docs]</a><span class="k">def</span> <span class="nf">direct_cubic_spline_1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Image-space approximate cubic spline convolution along 1D.  Useful for the splined raster image classes.  </span>
<span class="sd">    This is VERY slow and should be used for debugging only.</span>

<span class="sd">    Args: </span>
<span class="sd">      x (numpy.ndarray): 1D array of positions of the control points. Must have the same length as f.</span>
<span class="sd">      f (numpy.ndarray): 1D array of heights of the control points.  Must have the same length as x.</span>
<span class="sd">      xx (numpy.ndarray): 1D array of positions at which to compute inteperolated values of f.</span>
<span class="sd">      a (float): Cubic spline control parameter. Default: -0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.ndarray): 1D array with the values of f interpolated to positions xx.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Dx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ff</span> <span class="o">=</span> <span class="mi">0</span><span class="o">*</span><span class="n">xx</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xx</span><span class="p">))</span> <span class="p">:</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">xx</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">/</span><span class="n">Dx</span>
        <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">3</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">8</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&gt;=-</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&gt;=-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">a</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">3</span><span class="o">-</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&lt;=</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span><span class="o">**</span><span class="mi">3</span><span class="o">+</span><span class="mi">5</span><span class="o">*</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mi">8</span><span class="o">*</span><span class="n">dx</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">&lt;=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">ff</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="o">*</span><span class="n">f</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ff</span></div>


<div class="viewcode-block" id="direct_cubic_spline_2d"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.direct_cubic_spline_2d">[docs]</a><span class="k">def</span> <span class="nf">direct_cubic_spline_2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">rotation_angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Image-space approximate cubic spline convolution in 2D.  This is accomplished by </span>
<span class="sd">    convolving along x and they y.  Expects the data to be stored in a rectalinear grid.  </span>
<span class="sd">    Useful for the splined raster image classes.  This is VERY slow and should be used </span>
<span class="sd">    for debugging only.</span>

<span class="sd">    Args:</span>
<span class="sd">      x (numpy.ndarray): 1D array of positions of the control points in the x direction. Must have the same length as f.shape[0].</span>
<span class="sd">      y (numpy.ndarray): 1D array of positions of the control points in the y direction. Must have the same length as f.shape[1].</span>
<span class="sd">      f (numpy.ndarray): 2D array of heights of the control points.  Must have f.shape=[x.size,y.size].</span>
<span class="sd">      xx (numpy.ndarray): 1D array of positions at which to compute inteperolated values of f.</span>
<span class="sd">      ff (numpy.ndarray): 1D array of positions at which to compute inteperolated values of f.</span>
<span class="sd">      rotation_angle (float): Rotation angle of the field counter-clockwise in radians. If None, no rotation is performed. Default: None.</span>
<span class="sd">      a (float): Cubic spline control parameter. Default: -0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.ndarray): 2D array with the values of ff interpolated to positions [xx,yy].</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># 1st pass in x direction to get up-sampled control points</span>
    <span class="n">ff1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xx</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
        <span class="n">ff1</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">direct_cubic_spline_1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span><span class="n">xx</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>

    <span class="c1"># 2nd pass in y direction to get full up-sampled data</span>
    <span class="n">ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xx</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">yy</span><span class="o">.</span><span class="n">size</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ff</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
        <span class="n">ff</span><span class="p">[</span><span class="n">j</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">direct_cubic_spline_1d</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">ff1</span><span class="p">[</span><span class="n">j</span><span class="p">,:],</span><span class="n">yy</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>

    <span class="c1"># Rotate</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rotation_angle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">interp_obj</span> <span class="o">=</span> <span class="n">sint</span><span class="o">.</span><span class="n">RectBivariateSpline</span><span class="p">(</span><span class="o">-</span><span class="n">xx</span><span class="p">,</span><span class="o">-</span><span class="n">yy</span><span class="p">,</span><span class="n">ff</span><span class="p">)</span>
        <span class="n">cpa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span>
        <span class="n">spa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
                <span class="n">xxr</span> <span class="o">=</span> <span class="n">cpa</span><span class="o">*</span><span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">spa</span><span class="o">*</span><span class="n">yy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">yyr</span> <span class="o">=</span> <span class="o">-</span><span class="n">spa</span><span class="o">*</span><span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">cpa</span><span class="o">*</span><span class="n">yy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                <span class="n">ff</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">interp_obj</span><span class="p">(</span><span class="o">-</span><span class="n">xxr</span><span class="p">,</span><span class="o">-</span><span class="n">yyr</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ff</span></div>


<div class="viewcode-block" id="W_cubic_spline_1d"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.W_cubic_spline_1d">[docs]</a><span class="k">def</span> <span class="nf">W_cubic_spline_1d</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fourier domain convolution function for the approximate 1D cubic spline.</span>
<span class="sd">    Useful for the splined raster image classes.</span>

<span class="sd">    Args:</span>
<span class="sd">      k (numpy.ndarray): Wavenumber.</span>
<span class="sd">      a (float): Cubic spline control parameter. Default: -0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.ndarray): 1D array of values of the cubic spline weight function evaluated at each value of k.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">abk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
    <span class="n">ok4</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">abk</span><span class="o">**</span><span class="mi">4</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">)</span>
    <span class="n">ok3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">abk</span><span class="o">**</span><span class="mi">3</span><span class="o">+</span><span class="mf">1e-10</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-2</span><span class="p">,</span>
                     <span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">15.0</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">((</span><span class="mi">16</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">560.0</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">**</span><span class="mi">4</span><span class="p">,</span>
                     <span class="p">(</span> <span class="mf">12.0</span><span class="o">*</span><span class="n">ok4</span><span class="o">*</span><span class="p">(</span> <span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">k</span><span class="p">))</span> <span class="o">+</span> <span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k</span><span class="p">))</span> <span class="p">)</span>
                       <span class="o">-</span> <span class="mf">4.0</span><span class="o">*</span><span class="n">ok3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">*</span><span class="p">(</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span></div>


<div class="viewcode-block" id="fft_cubic_spline_2d"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.fft_cubic_spline_2d">[docs]</a><span class="k">def</span> <span class="nf">fft_cubic_spline_2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">rotation_angle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    FFT cubic spline convolution in 2D. This is accomplished by directly evaluating the</span>
<span class="sd">    Fourier transform of f (as a sum of Fourier components), applying the cubic spline as</span>
<span class="sd">    a filter in the Fourier space, and then inverting the Fourier transfor with FFT. </span>
<span class="sd">    Expects the data to be stored in a rectalinear grid. Useful for the splined raster </span>
<span class="sd">    image classes.</span>

<span class="sd">    Args:</span>
<span class="sd">      x (numpy.ndarray): 1D array of positions of the control points in the x direction. Must have the same length as f.shape[0].</span>
<span class="sd">      y (numpy.ndarray): 1D array of positions of the control points in the y direction. Must have the same length as f.shape[1].</span>
<span class="sd">      f (numpy.ndarray): 2D array of heights of the control points.  Must have f.shape=[x.size,y.size].</span>
<span class="sd">      xx (numpy.ndarray): 1D array of positions at which to compute inteperolated values of f.</span>
<span class="sd">      yy (numpy.ndarray): 1D array of positions at which to compute inteperolated values of f.</span>
<span class="sd">      rotation_angle (float): Rotation angle of the field counter-clockwise in radians. If None, no rotation is performed. Default: None.</span>
<span class="sd">      a (float): Cubic spline control parameter. Default: -0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.ndarray): 2D array with the values of ff interpolated to positions [xx,yy].</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Generate Fourier grid of the rFFT of the desired image</span>
    <span class="n">uu1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">xx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">vv1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">yy</span><span class="o">.</span><span class="n">size</span><span class="p">,</span><span class="n">yy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="n">uu1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">uu1d</span><span class="p">)</span>
    <span class="n">vv1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftshift</span><span class="p">(</span><span class="n">vv1d</span><span class="p">)</span>

    <span class="n">uu</span><span class="p">,</span><span class="n">vv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">uu1d</span><span class="p">,</span><span class="n">vv1d</span><span class="p">)</span>
    <span class="n">uu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">uu</span><span class="p">)</span>
    <span class="n">vv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span>

    <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rotation_angle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">uur</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span><span class="o">*</span><span class="n">uu</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span><span class="o">*</span><span class="n">vv</span>
        <span class="n">vvr</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span><span class="o">*</span><span class="n">uu</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">rotation_angle</span><span class="p">)</span><span class="o">*</span><span class="n">vv</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">uur</span> <span class="o">=</span> <span class="n">uu</span>
        <span class="n">vvr</span> <span class="o">=</span> <span class="n">vv</span>

    <span class="n">tpi</span> <span class="o">=</span> <span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">FF</span> <span class="o">=</span> <span class="mf">0.0</span><span class="o">*</span><span class="n">uu</span>
    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
            <span class="n">FF</span> <span class="o">=</span> <span class="n">FF</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="n">tpi</span><span class="o">*</span><span class="p">(</span><span class="n">uur</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="n">vvr</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span> <span class="p">)</span> <span class="o">*</span> <span class="n">f</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span>
    <span class="n">FF</span> <span class="o">=</span> <span class="n">FF</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">tpi</span><span class="o">*</span><span class="p">(</span><span class="n">uu</span><span class="o">*</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">vv</span><span class="o">*</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">FF</span> <span class="o">=</span> <span class="n">FF</span> <span class="o">*</span> <span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">uur</span><span class="p">)</span><span class="o">*</span><span class="n">W_cubic_spline_1d</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">dy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">vvr</span><span class="p">)</span>
    <span class="n">FF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifftshift</span><span class="p">(</span><span class="n">FF</span><span class="p">)</span>

    <span class="n">ff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft2</span><span class="p">(</span><span class="n">FF</span><span class="p">)</span>

    <span class="n">norm_factor</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span><span class="o">/</span><span class="p">((</span><span class="n">xx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">yy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yy</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span><span class="o">*</span><span class="n">norm_factor</span></div>





<div class="viewcode-block" id="model_image_splined_raster"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_splined_raster">[docs]</a><span class="k">class</span> <span class="nc">model_image_splined_raster</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Splined raster image class that is a mirror of Themis::model_image_splined_raster.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ........ Logarithm of the brightness at control point 0,0 (Jy/sr)</span>
<span class="sd">    * parameters[1] ........ Logarithm of the brightness at control point 1,0 (Jy/sr)</span>

<span class="sd">    ...</span>

<span class="sd">    * parameters[Nx-1] ..... Logarithm of the brightness at control point Nx-1,0 (Jy/sr)</span>
<span class="sd">    * parameters[Nx] ....... Logarithm of the brightness at control point 0,1 (Jy/sr)</span>
<span class="sd">    * parameters[Nx+1] ..... Logarithm of the brightness at control point 1,1 (Jy/sr)</span>

<span class="sd">    ...</span>

<span class="sd">    * parameters[Nx*Ny-1] .. Logarithm of the brightness at control point Nx-1,Ny-1 (Jy/sr)</span>

<span class="sd">    and size=Nx*Ny.</span>

<span class="sd">    Args:</span>
<span class="sd">      Nx (int): Number of control points in the -RA direction.</span>
<span class="sd">      Ny (int): Number of control points in the Dec direction.</span>
<span class="sd">      fovx (float): Field of view in the -RA direction (rad).</span>
<span class="sd">      fovy (float): Field of view in the Dec direction (rad).</span>
<span class="sd">      a (float): Spline control factor. Default: -0.5.</span>
<span class="sd">      spline_method (str): Spline method. Accepted values are &#39;fft&#39; and &#39;direct&#39;.  Default: &#39;fft&#39;.</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      Nx (int): Number of control points in the -RA direction.</span>
<span class="sd">      Ny (int): Number of control points in the Dec direction.</span>
<span class="sd">      fovx (float): Field of view in the -RA direction (rad).</span>
<span class="sd">      fovy (float): Field of view in the Dec direction (rad).</span>
<span class="sd">      a (float): Spline control factor. Default: -0.5.</span>
<span class="sd">      spline_method (str): Spline method. Accepted values are &#39;fft&#39; and &#39;direct&#39;.  Default: &#39;fft&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">fovx</span><span class="p">,</span> <span class="n">fovy</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">spline_method</span><span class="o">=</span><span class="s1">&#39;fft&#39;</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">6</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="o">=</span> <span class="n">Nx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ny</span> <span class="o">=</span> <span class="n">Ny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fovx</span> <span class="o">=</span> <span class="n">fovx</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fovy</span> <span class="o">=</span> <span class="n">fovy</span> <span class="o">*</span> <span class="n">rad2uas</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spline_method</span> <span class="o">=</span> <span class="n">spline_method</span>

        
<div class="viewcode-block" id="model_image_splined_raster.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_splined_raster.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">])</span>

        <span class="n">xtmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fovx</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fovx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">)</span>
        <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fovy</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">fovy</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">)</span>

        <span class="c1"># Determine the proper transposition based on if the reshaped x is fastest or slowest</span>
        <span class="n">xtest</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">xtest</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
            <span class="n">transpose</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">xx</span><span class="o">=</span><span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">yy</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">transpose</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">xx</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="n">yy</span><span class="o">=</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>

        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_method</span><span class="o">==</span><span class="s1">&#39;fft&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">fft_cubic_spline_2d</span><span class="p">(</span><span class="n">xtmp</span><span class="p">,</span><span class="n">ytmp</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_method</span><span class="o">==</span><span class="s1">&#39;direct&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">direct_cubic_spline_2d</span><span class="p">(</span><span class="n">xtmp</span><span class="p">,</span><span class="n">ytmp</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Only &#39;fft&#39; and &#39;direct&#39; methods are implemented for the spline.&quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="p">(</span><span class="n">transpose</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">I</span></div></div>

    
<div class="viewcode-block" id="model_image_adaptive_splined_raster"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_adaptive_splined_raster">[docs]</a><span class="k">class</span> <span class="nc">model_image_adaptive_splined_raster</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adaptive splined raster image class that is a mirror of Themis::model_image_adaptive_splined_raster.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ........ Logarithm of the brightness at control point 0,0 (Jy/sr)</span>
<span class="sd">    * parameters[1] ........ Logarithm of the brightness at control point 1,0 (Jy/sr)</span>

<span class="sd">    ...</span>

<span class="sd">    * parameters[Nx-1] ..... Logarithm of the brightness at control point Nx-1,0 (Jy/sr)</span>
<span class="sd">    * parameters[Nx] ....... Logarithm of the brightness at control point 0,1 (Jy/sr)</span>
<span class="sd">    * parameters[Nx+1] ..... Logarithm of the brightness at control point 1,1 (Jy/sr)</span>

<span class="sd">    ...</span>

<span class="sd">    * parameters[Nx*Ny-1] .. Logarithm of the brightness at control point Nx-1,Ny-1 (Jy/sr)</span>
<span class="sd">    * parameters[Nx*Ny] .... Field of view in the x direction (rad)</span>
<span class="sd">    * parameters[Nx*Ny+1] .. Field of view in the y direction (rad)</span>
<span class="sd">    * parameters[Nx*Ny+2] .. Orientation of the x direction (rad)</span>

<span class="sd">    and size=Nx*Ny.</span>

<span class="sd">    Args:</span>
<span class="sd">      Nx (int): Number of control points in the -RA direction.</span>
<span class="sd">      Ny (int): Number of control points in the Dec direction.</span>
<span class="sd">      a (float): Spline control factor. Default: -0.5.</span>
<span class="sd">      spline_method (str): Spline method. Accepted values are &#39;fft&#39; and &#39;direct&#39;.  Default: &#39;fft&#39;.</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True</span>

<span class="sd">    Attributes:</span>
<span class="sd">      Nx (int): Number of control points in the -RA direction.</span>
<span class="sd">      Ny (int): Number of control points in the Dec direction.</span>
<span class="sd">      a (float): Spline control factor. Default: -0.5.</span>
<span class="sd">      spline_method (str): Spline method. Accepted values are &#39;fft&#39; and &#39;direct&#39;.  Default: &#39;fft&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Nx</span><span class="p">,</span> <span class="n">Ny</span><span class="p">,</span> <span class="n">a</span><span class="o">=-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">spline_method</span><span class="o">=</span><span class="s1">&#39;fft&#39;</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">6</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Nx</span> <span class="o">=</span> <span class="n">Nx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Ny</span> <span class="o">=</span> <span class="n">Ny</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spline_method</span> <span class="o">=</span> <span class="n">spline_method</span>
        

<div class="viewcode-block" id="model_image_adaptive_splined_raster.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_adaptive_splined_raster.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">])</span>

        <span class="n">fovx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">rad2uas</span>
        <span class="n">fovy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">rad2uas</span>
        <span class="n">PA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">xtmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fovx</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fovx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Nx</span><span class="p">)</span>
        <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fovy</span><span class="p">,</span><span class="mf">0.5</span><span class="o">*</span><span class="n">fovy</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Ny</span><span class="p">)</span>

        <span class="c1"># Determine the proper transposition based on if the reshaped x is fastest or slowest</span>
        <span class="n">xtest</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">reshape</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">xtest</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">xtest</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">:</span>
            <span class="n">transpose</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">xx</span><span class="o">=</span><span class="n">x</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">yy</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">transpose</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">xx</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>
            <span class="n">yy</span><span class="o">=</span><span class="n">y</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>

        
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_method</span><span class="o">==</span><span class="s1">&#39;fft&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">fft_cubic_spline_2d</span><span class="p">(</span><span class="n">xtmp</span><span class="p">,</span><span class="n">ytmp</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">PA</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spline_method</span><span class="o">==</span><span class="s1">&#39;direct&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">direct_cubic_spline_2d</span><span class="p">(</span><span class="n">xtmp</span><span class="p">,</span><span class="n">ytmp</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">xx</span><span class="p">,</span><span class="n">yy</span><span class="p">,</span><span class="n">PA</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Only &#39;fft&#39; and &#39;direct&#39; methods are implemented for the spline.&quot;</span><span class="p">)</span>


        <span class="k">if</span> <span class="p">(</span><span class="n">transpose</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">I</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">I</span></div></div>



<div class="viewcode-block" id="model_image_smoothed"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_smoothed">[docs]</a><span class="k">class</span> <span class="nc">model_image_smoothed</span><span class="p">(</span><span class="n">model_image</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Smoothed image class that is a mirror of Themis::model_image_smooth. Generates a smoothed </span>
<span class="sd">    image from an existing image using an asymmetric Gaussian smoothing kernel.</span>
<span class="sd">    Has parameters:</span>

<span class="sd">    * parameters[0] ............. First parameter of underlying image</span>
<span class="sd">    </span>
<span class="sd">    ...</span>

<span class="sd">    * parameters[image.size-1] .. Last parameter of underlying image</span>
<span class="sd">    * parameters[image.size] .... Symmetrized standard deviation of smoothing kernel :math:`\\sigma` (rad)</span>
<span class="sd">    * parameters[image.size+1] .. Asymmetry parameter of smoothing kernel :math:`A` in (0,1)</span>
<span class="sd">    * parameters[image.size+2] .. Position angle of smoothing kernel :math:`\\phi` (rad)</span>

<span class="sd">    and size=image.size+3.</span>

<span class="sd">    Args:</span>
<span class="sd">      image (model_image): :class:`model_image` object that will be smoothed.</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      image (model_image): A preexisting :class:`model_image` object to be smoothed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">3</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span>

        
<div class="viewcode-block" id="model_image_smoothed.generate"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_smoothed.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the model parameter list.  Mirrors similar a similar function within the Themis</span>
<span class="sd">        model_image_smooth class.</span>

<span class="sd">        Args:</span>
<span class="sd">          parameters (list): Parameter list.</span>

<span class="sd">        Returns:</span>
<span class="sd">          None        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Parameter list is inconsistent with the number of parameters expected.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">parameters</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span></div>

        
<div class="viewcode-block" id="model_image_smoothed.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_smoothed.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Doesn&#39;t to boundary checking here.  Probably not a major problem, but consider it in the future.</span>
        <span class="n">sr1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">rad2uas</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
        <span class="n">sr2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">rad2uas</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
        <span class="n">sphi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># Check to prevent convolving with zero</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]))</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sr1</span><span class="o">&lt;</span><span class="n">dx</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">sr1</span> <span class="o">=</span> <span class="n">dx</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sr2</span><span class="o">&lt;</span><span class="n">dx</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">sr2</span> <span class="o">=</span> <span class="n">dx</span>
        
        <span class="c1"># Re-orient the grind along major and minor axes of the smoothing kernel</span>
        <span class="n">xMajor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sphi</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sphi</span><span class="p">)</span><span class="o">*</span><span class="n">y</span>
        <span class="n">xMinor</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">sphi</span><span class="p">)</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">sphi</span><span class="p">)</span><span class="o">*</span><span class="n">y</span>
        <span class="n">exponent</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">xMajor</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sr1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">xMinor</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">sr2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">K</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sr1</span><span class="o">*</span><span class="n">sr2</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">exponent</span><span class="p">)</span> 
    
        <span class="n">px</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">py</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">I</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">intensity_map</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">parameters</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>
        <span class="n">Ism</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fftconvolve</span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">px</span><span class="o">*</span><span class="n">py</span><span class="p">,</span><span class="n">K</span><span class="o">*</span><span class="n">px</span><span class="o">*</span><span class="n">py</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;same&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Gaussian smoothed:&#39;</span><span class="p">,</span><span class="n">sr1</span><span class="p">,</span><span class="n">sr2</span><span class="p">,</span><span class="n">sphi</span><span class="p">)</span>
    
        <span class="k">return</span> <span class="n">Ism</span><span class="o">/</span><span class="p">(</span><span class="n">px</span><span class="o">*</span><span class="n">py</span><span class="p">)</span></div></div>

    
    
    
<div class="viewcode-block" id="model_image_sum"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_sum">[docs]</a><span class="k">class</span> <span class="nc">model_image_sum</span><span class="p">(</span><span class="n">model_image</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Summed image class that is a mirror of Themis::model_image_sum. Generates images by summing </span>
<span class="sd">    other images supplemented with some offset. The parameters list is expanded by 2 for each </span>
<span class="sd">    image, corresponding to the absolute positions. These may be specified either in Cartesian </span>
<span class="sd">    or polar coordinates; this selection must be made at construction and applies uniformly to </span>
<span class="sd">    all components (i.e., all component positions must be specified in the same coordinates).</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">      image_list (list): List of :class:`model_image` objects. If None, must be set prior to calling :func:`intensity_map`. Default: None.</span>
<span class="sd">      offset_coordinates (str): Coordinates in which to specify component shifts.  Options are &#39;Cartesian&#39; and &#39;polar&#39;. Default: &#39;Cartesian&#39;.</span>
<span class="sd">      themis_fft_sign (bool): If True will assume the Themis-default FFT sign convention, which reflects the reconstructed image through the origin. Default: True.</span>

<span class="sd">    Attributes:</span>
<span class="sd">      image_list (list): List of :class:`model_image` objects that are to be summed.</span>
<span class="sd">      shift_list (list): List of shifts transformed to Cartesian coordinates.</span>
<span class="sd">      offset_coordinates (str): Coordinates in which to specify component shifts.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">offset_coordinates</span><span class="o">=</span><span class="s1">&#39;Cartesian&#39;</span><span class="p">,</span> <span class="n">themis_fft_sign</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">themis_fft_sign</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">image_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="o">=</span><span class="p">[]</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">image_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_list</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">image_list</span><span class="p">)</span> <span class="c1"># This is a SHALLOW copy</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">0</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">image_list</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">offset_coordinates</span> <span class="o">=</span> <span class="n">offset_coordinates</span>

            
<div class="viewcode-block" id="model_image_sum.add"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_sum.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Adds an model_image object or list of model_image objects to the sum.  The size is recomputed.</span>

<span class="sd">        Args:</span>
<span class="sd">          image (model_image, list): A single model_image object or list of model_image objects to be added.</span>

<span class="sd">        Returns:</span>
<span class="sd">          None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Can add lists and single istances</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_list</span> <span class="o">=</span> <span class="n">image_list</span> <span class="o">+</span> <span class="n">image</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="c1"># Get new size and shift list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">image</span> <span class="ow">in</span> <span class="n">image_list</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">size</span> <span class="o">+=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span></div>

        
<div class="viewcode-block" id="model_image_sum.generate"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_sum.generate">[docs]</a>    <span class="k">def</span> <span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parameters</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sets the combined model parameter list.  Mirrors similar a similar function within the Themis</span>
<span class="sd">        model_image_sum class.  Effectively simply copies the parameters into the local list, transforms</span>
<span class="sd">        and copies the shift vector (x0,y0) for each model_image object, and performs some run-time checking.</span>

<span class="sd">        Args:</span>
<span class="sd">          parameters (list): Parameter list.</span>

<span class="sd">        Returns:</span>
<span class="sd">          None        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Parameter list is inconsistent with the number of parameters expected.&quot;</span><span class="p">)</span>

        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_list</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">image</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_coordinates</span><span class="o">==</span><span class="s1">&#39;Cartesian&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">]</span> <span class="o">*</span> <span class="n">rad2uas</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">rad2uas</span>
            <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_coordinates</span><span class="o">==</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">rad2uas</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">rad2uas</span>
                
            <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="p">[(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">2</span><span class="p">):]</span></div>

            
<div class="viewcode-block" id="model_image_sum.generate_intensity_map"><a class="viewcode-back" href="../../docs/src/vis.html#vis.image.model_image_sum.generate_intensity_map">[docs]</a>    <span class="k">def</span> <span class="nf">generate_intensity_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Internal generation of the intensity map. In practice you almost certainly want to call :func:`model_image.intensity_map`.</span>

<span class="sd">        Args:</span>
<span class="sd">          x (numpy.ndarray): Array of -RA offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          y (numpy.ndarray): Array of Dec offsets in microarcseconds (usually plaid 2D).</span>
<span class="sd">          verbosity (int): Verbosity parameter. If nonzero, prints information about model properties. Default: 0.</span>

<span class="sd">        Returns:</span>
<span class="sd">          (numpy.ndarray) Array of intensity values at positions (x,y).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">image</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">image_list</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">x0_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">y0_list</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

            <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">+</span><span class="n">image</span><span class="o">.</span><span class="n">generate_intensity_map</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">verbosity</span><span class="o">=</span><span class="n">verbosity</span><span class="p">)</span>

            <span class="n">q</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">[(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="o">+</span><span class="mi">2</span><span class="p">):]</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   --&gt; Sum shift:&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">shift_list</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
            
        <span class="k">return</span> <span class="n">I</span></div></div>
    



    
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Themis Development Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0+untagged.132.g01cffb0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            LINK_SUFFIX:'.html', 
            HAS_SOURCE: 'true'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>