

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>vis.typlot &mdash; ThemisPy 0.3.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="ThemisPy 0.3.0 documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../docs/src/index.html" class="icon icon-home"> ThemisPy
          

          
          </a>

          
            
            
              <div class="version">
                0.3.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/userguide.html">User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/devel.html">Developer’s Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../docs/src/index.html">ThemisPy</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../docs/src/index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>vis.typlot</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for vis.typlot</h1><div class="highlight"><pre>
<span></span><span class="c1">###########################</span>
<span class="c1">#</span>
<span class="c1"># Package:</span>
<span class="c1">#   typlot</span>
<span class="c1">#</span>
<span class="c1"># Provides:</span>
<span class="c1">#   Provides general utility functions plotting.  Ambitiously named.</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">themispy.utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="k">as</span> <span class="nn">gs</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rc</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>

<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span> <span class="k">as</span> <span class="n">scint</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">bisect</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span> <span class="k">as</span> <span class="n">KDEsci</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">percentileofscore</span>


<div class="viewcode-block" id="generate_streamline_colormap"><a class="viewcode-back" href="../../docs/src/vis.html#vis.typlot.generate_streamline_colormap">[docs]</a><span class="k">def</span> <span class="nf">generate_streamline_colormap</span><span class="p">(</span><span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;plasma&#39;</span><span class="p">,</span> <span class="n">number_of_streams</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">oversample_factor</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fluctuation_factor</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a new colormap that is generated by randomly subsampling a given colormap.</span>
<span class="sd">    Useful for making plots that indicate flow, e.g., :func:`plot_deo_tempering_level_evolution`.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">      colormap (matplotlib.colors.Colormap): A colormap name as specified in :mod:`matplotlib.cm`. Default: &#39;plasma&#39;.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">      (matplotlib.colors.Colormap): A new colormap that has random rearrangements.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Obtain colormap object</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">colormap</span><span class="p">)</span>

    <span class="c1"># Generate some value levels randomly bewteen 0 and 1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">number_of_streams</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">number_of_streams</span> <span class="o">=</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span>
    <span class="n">vsub</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">number_of_streams</span><span class="p">)</span> <span class="o">+</span> <span class="n">fluctuation_factor</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">number_of_streams</span><span class="p">)</span>
    <span class="n">vsub</span> <span class="o">=</span> <span class="p">(</span><span class="n">vsub</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vsub</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vsub</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vsub</span><span class="p">))</span>

    <span class="c1"># Generate an over-sampled smooth interpolated set of values</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">scint</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">number_of_streams</span><span class="p">),</span><span class="n">vsub</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">oversample_factor</span><span class="o">*</span><span class="n">number_of_streams</span><span class="p">))</span>
    <span class="n">cvals</span> <span class="o">=</span> <span class="n">cmap</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">cvals</span><span class="p">)</span> <span class="p">)</span></div>


<div class="viewcode-block" id="axes_adjust"><a class="viewcode-back" href="../../docs/src/vis.html#vis.typlot.axes_adjust">[docs]</a><span class="k">def</span> <span class="nf">axes_adjust</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shift_x0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shift_y0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shift_width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">shift_height</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjusts the axes by some shifts provided in the specified units.</span>

<span class="sd">    Args:</span>
<span class="sd">      fig (matplotlib.figure.Figure): Handle of figure to modify. If None, use the current figure object. Default: None.</span>
<span class="sd">      axes (matplotlib.axes.Axes): Handle of axes to modify. If None, use the current axes object. Default: None.</span>
<span class="sd">      shift_x0 (float): Number of inches to shift the axes to the right. Default: 0.</span>
<span class="sd">      shift_y0 (float): Number of inches to shift the axes up. Default: 0.</span>
<span class="sd">      shift_width (float): Number of inches to increase the axes width. Default: 0.</span>
<span class="sd">      shift_height (float): Number of inches to increase the axes height. Default: 0.</span>

<span class="sd">    Returns:</span>
<span class="sd">      None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">axes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

    <span class="n">figsize</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>
    <span class="n">current_location</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
    <span class="n">axes</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span> <span class="n">current_location</span><span class="o">.</span><span class="n">x0</span><span class="o">+</span><span class="n">shift_x0</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">current_location</span><span class="o">.</span><span class="n">y0</span><span class="o">+</span><span class="n">shift_y0</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">current_location</span><span class="o">.</span><span class="n">width</span><span class="o">+</span><span class="n">shift_width</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">current_location</span><span class="o">.</span><span class="n">height</span><span class="o">+</span><span class="n">shift_height</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">])</span></div>
    

<span class="k">def</span> <span class="nf">_cdf</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">,</span><span class="n">target</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function for the CDF in terms of the probability density, for computing the fixed CDF probability levels.</span>

<span class="sd">    Args:</span>
<span class="sd">      limit (numpy.ndarray): Array of limit value at which the CDF is desired.</span>
<span class="sd">      H (nump.ndarray): 2D array of probability data</span>
<span class="sd">      dx (float): Differential in 1st axis</span>
<span class="sd">      dy (float): Differential in 2nd axis</span>
<span class="sd">      target</span>

<span class="sd">    Returns:</span>
<span class="sd">      (float): CDF above the limit minus the target value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">w</span> <span class="o">=</span> <span class="p">(</span><span class="n">H</span><span class="o">&gt;</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">count</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="n">dx</span><span class="o">*</span><span class="n">dy</span><span class="o">-</span><span class="n">target</span>


<div class="viewcode-block" id="kde_plot_1d"><a class="viewcode-back" href="../../docs/src/vis.html#vis.typlot.kde_plot_1d">[docs]</a><span class="k">def</span> <span class="nf">kde_plot_1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="s1">&#39;scott&#39;</span><span class="p">,</span> <span class="n">scott_factor</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a 1d joint posterior plot using :func:`scipy.stats.gaussian_kde` function.</span>

<span class="sd">    Args:</span>
<span class="sd">      x (numpy.ndarray): List of data positions.</span>
<span class="sd">      limits (list): Limits in the form [xmin,xmax].  If set to None, will use the minimum and maximum values of x, expanded by 10% on each side.  Default: None.</span>
<span class="sd">      color (str,list): Any acceptable color type as specified in :mod:`matplotlib.colors`.</span>
<span class="sd">      alpha (float): Value of alpha for the individual likelihood traces. Default: 1.0.</span>
<span class="sd">      linewidth (float): Linewidth to be passed to :func:`matplotlib.pyplot.plot`. Default: 1.</span>
<span class="sd">      linestype (str): Linestyle to be passed to :func:`matplotlib.pyplot.plot`. Default: &#39;-&#39;.</span>
<span class="sd">      nbin (int): Number of bins on which to construct KDE result. Default: 128.</span>
<span class="sd">      bw (str): Bandwidth method for :func:`scipy.stats.gaussian_kde`. Overidden by nonzero scott_factor. Default: &#39;scott&#39;.</span>
<span class="sd">      scott_factor (float): Factor by which to expand the standard `scott` bandwidth factor.  Overrides bw if nonzero.  Default: 0.</span>
<span class="sd">      filled (bool): If true, the histogram is plotted filled. Default: False.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (matplotlib.lines.Line2D): A list of Line2D objects representing the plotted data, i.e., the handles returned by :func:`matplotlib.pyplot.plot`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">x</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">scott_factor</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">bw</span> <span class="o">=</span> <span class="n">scott_factor</span><span class="o">*</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">6.0</span><span class="p">)</span>

    <span class="n">kde</span> <span class="o">=</span> <span class="n">KDEsci</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">bw</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="p">(</span><span class="n">limits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)):</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">dx</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">dx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">nbin</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">kde</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">filled</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="o">*</span><span class="n">alpha</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">)</span>
    <span class="n">h</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">h</span></div>


<div class="viewcode-block" id="kde_plot_2d"><a class="viewcode-back" href="../../docs/src/vis.html#vis.typlot.kde_plot_2d">[docs]</a><span class="k">def</span> <span class="nf">kde_plot_2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">plevels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;Purples&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">bw</span><span class="o">=</span><span class="s1">&#39;scott&#39;</span><span class="p">,</span> <span class="n">scott_factor</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a 2d joint posterior plot using :func:`scipy.stats.gaussian_kde` function and :func:`matplotlib.pyplot.contourf`.</span>

<span class="sd">    Args:</span>
<span class="sd">      x (numpy.ndarray): List of data positions in the 1st axis (horizontal).</span>
<span class="sd">      y (numpy.ndarray): List of data positions in the 2nd axis (vertical).</span>
<span class="sd">      plevels (list): List of cummulative probability levels at which to draw contours. If set to None, will set to :math:`1\\sigma, 2\\sigma, 3\\sigma`. Default: None.</span>
<span class="sd">      limits (list): Limits in the form [[xmin,xmax],[ymin,ymax]].  If set to None, will use the minimum and maximum values of, expanded by 10% on each side.  Default: None.</span>
<span class="sd">      colormap (matplotlib.colors.Colormap): A colormap name as specified in :mod:`matplotlib.cm`. Default: &#39;Purples&#39;.</span>
<span class="sd">      alpha (float): Value of alpha for the individual likelihood traces. Default: 1.0.</span>
<span class="sd">      nbin (int): Number of bins on which to construct KDE result in each dimension. Default: 128.</span>
<span class="sd">      bw (str): Bandwidth method for :func:`scipy.stats.gaussian_kde`. Overidden by nonzero scott_factor. Default: &#39;scott&#39;.</span>
<span class="sd">      scott_factor (float): Factor by which to expand the standard `scott` bandwidth factor.  Overrides bw if nonzero.  Default: 0.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (matplotlib.contour.QuadContourSet): The handles returned by :func:`matplotlib.pyplot.contourf`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR! kde_plot_2d requires that x and y have the same shape.&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">])</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">plevels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">plevels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="p">),</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">scott_factor</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">bw</span> <span class="o">=</span> <span class="n">scott_factor</span><span class="o">*</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">))</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">/</span><span class="mf">6.0</span><span class="p">)</span>

    <span class="n">kde</span> <span class="o">=</span> <span class="n">KDEsci</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">bw</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">limits</span><span class="p">:</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">dx</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">dx</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin</span><span class="o">-</span><span class="mf">0.1</span><span class="o">*</span><span class="n">dy</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span><span class="o">+</span><span class="mf">0.1</span><span class="o">*</span><span class="n">dy</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">xmin</span><span class="p">:</span><span class="n">xmax</span><span class="p">:</span><span class="n">nbin</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">,</span> <span class="n">ymin</span><span class="p">:</span><span class="n">ymax</span><span class="p">:</span><span class="n">nbin</span><span class="o">*</span><span class="mi">1</span><span class="n">j</span><span class="p">]</span>
    <span class="n">positions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">X</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>

    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">kde</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dX</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dY</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">points</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">*</span><span class="n">dX</span><span class="o">*</span><span class="n">dY</span>
    
    <span class="n">levels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">plevels</span><span class="p">:</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">norm</span>
        <span class="n">levels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bisect</span><span class="p">(</span><span class="n">_cdf</span><span class="p">,</span><span class="n">points</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">points</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">dX</span><span class="p">,</span><span class="n">dY</span><span class="p">,</span><span class="n">target</span><span class="p">),</span> <span class="n">xtol</span><span class="o">=</span><span class="n">points</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1e-10</span><span class="p">))</span>
        
    <span class="n">h</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Z</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span><span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">4.0</span><span class="p">),</span><span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span> 

    <span class="k">return</span> <span class="n">h</span></div>


<span class="k">def</span> <span class="nf">_find_limits</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">quantile</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">factor</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility function to find limits given some quantile.</span>

<span class="sd">    Args:</span>
<span class="sd">      data (numpy.ndarray): Array of data values.</span>
<span class="sd">      quantile (float): Quantile to use for typical value. Default: 0.25.</span>
<span class="sd">      factor (float): Factor by which to expand the limit on both sides. Default: 1.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (numpy.ndarray): 1D array of [min,max] limits.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">dl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">dh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">lim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span> <span class="n">dm</span><span class="o">+</span><span class="n">factor</span><span class="o">*</span><span class="p">(</span><span class="n">dl</span><span class="o">-</span><span class="n">dm</span><span class="p">),</span> <span class="n">dm</span><span class="o">+</span><span class="n">factor</span><span class="o">*</span><span class="p">(</span><span class="n">dh</span><span class="o">-</span><span class="n">dm</span><span class="p">)</span> <span class="p">])</span>

    <span class="k">return</span> <span class="n">lim</span>


<div class="viewcode-block" id="kde_triangle_plot"><a class="viewcode-back" href="../../docs/src/vis.html#vis.typlot.kde_triangle_plot">[docs]</a><span class="k">def</span> <span class="nf">kde_triangle_plot</span><span class="p">(</span><span class="n">lower_data_array</span><span class="p">,</span> <span class="n">upper_data_array</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">upper_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">truths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">upper_colormap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">upper_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">truths_color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">axis_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">quantiles</span><span class="o">=</span><span class="p">[</span><span class="mf">0.99</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">0.5</span><span class="p">],</span> <span class="n">nbin</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">truths_alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">truths_linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">truths_linestype</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">scott_factor</span><span class="o">=</span><span class="mf">1.41421</span><span class="p">,</span> <span class="n">filled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produces a triangle plot with contours set by CDF.  Data may be plotted in both lower (required) and upper (optional) triangles.</span>

<span class="sd">    Args:</span>
<span class="sd">      lower_data_array (numpy.ndarray): Array of multidimensional data from which to generate triangle plot.</span>
<span class="sd">      upper_data_array (numpy.ndarray): Optional array of multidimensional data from which to generate triangle plot. If provided, must match the dimensions of the lower_data_array.  Default: None.</span>
<span class="sd">      labels (list): Optional list of str labels for the passed values to place on lower-triangle-plot axes. If provided, must match the dimensions of the lower_data_array. Default: None.</span>
<span class="sd">      upper_labels (list): Optional list of str labels for the passed values to place on upper-triangle-plot axes. If provided, must match the dimensions of the lower_data_array. Default: None.</span>
<span class="sd">      truths (list): Optional list of truth values. If provided, must match the dimensions of the lower_data_array. Default: None.</span>
<span class="sd">      colormap (matplotlib.colors.Colormap): Colormap name as specified in :mod:`matplotlib.cm`. Default: &#39;Blues&#39;.</span>
<span class="sd">      upper_colormap (matplotlib.colors.Colormap): Colormap name as specified in :mod:`matplotlib.cm`. If set to None, uses the same colormap as the lower triangle. Default: None.</span>
<span class="sd">      color (str,list): Any acceptable color type as specified in :mod:`matplotlib.colors` to be used in the 1d histograms along the diagonal for the lower data. Default: &#39;blue&#39;.</span>
<span class="sd">      upper_color (str,list): Any acceptable color type as specified in :mod:`matplotlib.colors` to be used in the 1d histograms along the diagonal for the upper data. If set to None, uses the same color as the lower triangle Default: None.</span>
<span class="sd">      truths_color (str,list): Any acceptable color type as specified in :mod:`matplotlib.colors` to be used in the 1d histograms along the diagonal for the upper data. If set to None, uses the same color as the lower triangle Default: &#39;red&#39;.</span>
<span class="sd">      axis_location (list): List of axis location in which to place bounding box of the entire plot. If set to None, a default size will be set. Default: None.</span>
<span class="sd">      alpha (float): Value of alpha for the individual likelihood traces. Default: 1.0.</span>
<span class="sd">      quantiles (list): List of quantiles at which to draw contours. Default: 0.99, 0.9, 0.5. Note that the defaults will change if set!</span>
<span class="sd">      nbin (int): Number of bins on which to construct KDE result in each dimension. Default: 128.</span>
<span class="sd">      linewidth (float): Linewidth to be passed to :func:`matplotlib.pyplot.plot` for diagonal 1d histograms. Default: 1.</span>
<span class="sd">      linestype (str): Linestyle to be passed to :func:`matplotlib.pyplot.plot` for diagonal 1d histograms. Default: &#39;-&#39;.</span>
<span class="sd">      truths_alpha (float): Value of alpha for the individual likelihood traces. Default: 1.0.</span>
<span class="sd">      truths_linewidth (float): Linewidth to be passed to :func:`matplotlib.pyplot.plot` for diagonal 1d histograms of lower data. Default: 1.</span>
<span class="sd">      truths_linestype (str): Linestyle to be passed to :func:`matplotlib.pyplot.plot` for diagonal 1d histograms of lower data. Default: &#39;-&#39;.</span>
<span class="sd">      scott_factor (float): Factor by which to expand the standard `scott` bandwidth factor.  Overrides bw if nonzero.  Default: 1.41421.</span>
<span class="sd">      filled (bool): If True, the 1d histograms along the diagonal are plotted filled. Default: False.</span>
<span class="sd">      grid (bool): If True, adds gridlines to plots. Default: True.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (matplotlib.axes.Axes, list, list, list): Handles to the array of axes objects in the plot, list of handels to the 2d kde plot objects in the lower triangle, 2d kde plot objects in the upper triangle, and 1d plot objects in along the diagonal (see :func:`kde_plot_2d` and :func:`kde_plot_1d` for more information).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">figsize</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span><span class="o">.</span><span class="n">get_size_inches</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">lower_data_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">axis_location</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">lmarg</span> <span class="o">=</span> <span class="mf">0.625</span> <span class="c1"># Margin in inches</span>
        <span class="n">rmarg</span> <span class="o">=</span> <span class="mf">0.625</span> <span class="c1"># Margin in inches</span>
        <span class="n">tmarg</span> <span class="o">=</span> <span class="mf">0.625</span> <span class="c1"># Margin in inches</span>
        <span class="n">bmarg</span> <span class="o">=</span> <span class="mf">0.625</span> <span class="c1"># Margin in inches</span>
        <span class="n">ax0</span> <span class="o">=</span> <span class="n">lmarg</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ay0</span> <span class="o">=</span> <span class="n">bmarg</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">axw</span> <span class="o">=</span> <span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">lmarg</span><span class="o">-</span><span class="n">rmarg</span><span class="p">)</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ayw</span> <span class="o">=</span> <span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tmarg</span><span class="o">-</span><span class="n">bmarg</span><span class="p">)</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">axis_location</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax0</span><span class="p">,</span> <span class="n">ay0</span><span class="p">,</span> <span class="n">axw</span><span class="p">,</span> <span class="n">ayw</span><span class="p">]</span>

    <span class="c1"># Number of rows/columns</span>
    <span class="n">nrow</span> <span class="o">=</span> <span class="n">lower_data_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Get window size details</span>
    <span class="n">gutter_size</span> <span class="o">=</span> <span class="mf">0.0625</span> <span class="c1"># Gutter in inches</span>
    <span class="n">x_gutter</span> <span class="o">=</span> <span class="n">gutter_size</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y_gutter</span> <span class="o">=</span> <span class="n">gutter_size</span><span class="o">/</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">x_window_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis_location</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">x_gutter</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span>
    <span class="n">y_window_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">axis_location</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">y_gutter</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span>

    <span class="c1"># Plot handles</span>
    <span class="n">lower_triangle_plot_handles</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">upper_triangle_plot_handles</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">diagonal_plot_handles</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">axes_handles</span> <span class="o">=</span> <span class="p">{}</span>


    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">!=</span><span class="n">lower_data_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR! kde_triangle_plot : Number of labels is inconsistent with the number of arrays of data passed.&quot;</span><span class="p">)</span>
        <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">truths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">truths</span><span class="p">)</span><span class="o">!=</span><span class="n">lower_data_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR! kde_triangle_plot : Number of truths is inconsistent with the number of arrays of data passed.&quot;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="p">(</span><span class="n">upper_data_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">upper_data_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span><span class="n">lower_data_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR! kde_triangle_plot : Number of arrays of data on upper and lower triangles must be the same.&quot;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            

    <span class="c1">########</span>
    <span class="c1"># Lower triangle</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="p">:</span>
            <span class="c1"># Find axis location with various gutters, etc.</span>
            <span class="n">x_window_start</span> <span class="o">=</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">x_gutter</span><span class="o">+</span><span class="n">x_window_size</span><span class="p">)</span>
            <span class="n">y_window_start</span> <span class="o">=</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_window_size</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">y_gutter</span><span class="o">+</span><span class="n">y_window_size</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="n">x_window_start</span><span class="p">,</span> <span class="n">y_window_start</span><span class="p">,</span> <span class="n">x_window_size</span><span class="p">,</span> <span class="n">y_window_size</span><span class="p">])</span>
        
            <span class="c1"># Find limits in x/y</span>
            <span class="n">limx</span><span class="o">=</span><span class="n">_find_limits</span><span class="p">(</span><span class="n">lower_data_array</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span><span class="n">quantile</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">limy</span><span class="o">=</span><span class="n">_find_limits</span><span class="p">(</span><span class="n">lower_data_array</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span><span class="n">quantile</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">upper_data_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">upper_limx</span> <span class="o">=</span> <span class="n">_find_limits</span><span class="p">(</span><span class="n">upper_data_array</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span><span class="n">quantile</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">upper_limy</span> <span class="o">=</span> <span class="n">_find_limits</span><span class="p">(</span><span class="n">upper_data_array</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span><span class="n">quantile</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">limx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">limx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">upper_limx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">limx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">limx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">upper_limx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">limy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">limy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">upper_limy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">limy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">limy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">upper_limy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


            <span class="c1"># Make 2d joint distribution plot</span>
            <span class="n">lower_triangle_plot_handles</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kde_plot_2d</span><span class="p">(</span><span class="n">lower_data_array</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span><span class="n">lower_data_array</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span><span class="n">colormap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">plevels</span><span class="o">=</span><span class="n">quantiles</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="p">[</span><span class="n">limx</span><span class="p">,</span><span class="n">limy</span><span class="p">],</span><span class="n">nbin</span><span class="o">=</span><span class="n">nbin</span><span class="p">,</span><span class="n">scott_factor</span><span class="o">=</span><span class="n">scott_factor</span><span class="p">)</span>
            <span class="n">axes_handles</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

            <span class="c1"># Fix up tickmarks</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelright</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>

            <span class="c1"># Add labels if appropriate</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelleft</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;</span><span class="n">k</span><span class="p">)</span> <span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

            <span class="c1"># Add truths if requested</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">truths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">xlim</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()</span>
                <span class="n">ylim</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">truths</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">truths_color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">truths_linewidth</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">truths_alpha</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&lt;</span><span class="n">k</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">truths</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">truths_color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">truths_linewidth</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">truths_alpha</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">truths</span><span class="p">[</span><span class="n">j</span><span class="p">]],[</span><span class="n">truths</span><span class="p">[</span><span class="n">k</span><span class="p">]],</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">truths_color</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

            <span class="c1"># Add grid if requested</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>


    <span class="c1">########</span>
    <span class="c1"># Upper triangle</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">upper_data_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">upper_colormap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">upper_colormap</span> <span class="o">=</span> <span class="n">colormap</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">upper_labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">upper_labels</span> <span class="o">=</span> <span class="n">labels</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
                <span class="c1"># Find axis location with various gutters, etc.</span>
                <span class="n">x_window_start</span> <span class="o">=</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x_gutter</span><span class="o">+</span><span class="n">x_window_size</span><span class="p">)</span>
                <span class="n">y_window_start</span> <span class="o">=</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_window_size</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">y_gutter</span><span class="o">+</span><span class="n">y_window_size</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="n">x_window_start</span><span class="p">,</span> <span class="n">y_window_start</span><span class="p">,</span> <span class="n">x_window_size</span><span class="p">,</span> <span class="n">y_window_size</span><span class="p">])</span>
        
                <span class="c1"># Find limits in x/y</span>
                <span class="n">limx</span><span class="o">=</span><span class="n">_find_limits</span><span class="p">(</span><span class="n">lower_data_array</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span><span class="n">quantile</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">limy</span><span class="o">=</span><span class="n">_find_limits</span><span class="p">(</span><span class="n">lower_data_array</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span><span class="n">quantile</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">upper_limx</span> <span class="o">=</span> <span class="n">_find_limits</span><span class="p">(</span><span class="n">upper_data_array</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span><span class="n">quantile</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">upper_limy</span> <span class="o">=</span> <span class="n">_find_limits</span><span class="p">(</span><span class="n">upper_data_array</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span><span class="n">quantile</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">limx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">limx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">upper_limx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">limx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">limx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">upper_limx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">limy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">limy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">upper_limy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">limy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">limy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">upper_limy</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


                <span class="c1"># Make 2d joint distribution plot</span>
                <span class="n">upper_triangle_plot_handles</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kde_plot_2d</span><span class="p">(</span><span class="n">upper_data_array</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span><span class="n">upper_data_array</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span><span class="n">colormap</span><span class="o">=</span><span class="n">upper_colormap</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">plevels</span><span class="o">=</span><span class="n">quantiles</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="p">[</span><span class="n">limx</span><span class="p">,</span><span class="n">limy</span><span class="p">],</span><span class="n">nbin</span><span class="o">=</span><span class="n">nbin</span><span class="p">,</span><span class="n">scott_factor</span><span class="o">=</span><span class="n">scott_factor</span><span class="p">)</span>
                <span class="n">axes_handles</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

                <span class="c1"># Fix up tickmarks</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelright</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>

                <span class="c1"># Add labels if appropriate</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labeltop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">upper_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">upper_labels</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span> 
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">==</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelright</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">upper_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&gt;</span><span class="n">k</span><span class="p">)</span> <span class="p">:</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">upper_labels</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>

                <span class="c1"># Add truths if requested</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">truths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">xlim</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()</span>
                    <span class="n">ylim</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">truths</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">truths_color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">truths_linewidth</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">truths_alpha</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="o">&gt;</span><span class="n">k</span><span class="p">)</span> <span class="p">:</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">truths</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">truths_color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">truths_linewidth</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">truths_alpha</span><span class="p">)</span>
                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">truths</span><span class="p">[</span><span class="n">j</span><span class="p">]],[</span><span class="n">truths</span><span class="p">[</span><span class="n">k</span><span class="p">]],</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">truths_color</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>

                <span class="c1"># Add grid if requested</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1">########</span>
    <span class="c1"># Diagonal</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrow</span><span class="p">)</span> <span class="p">:</span>
        <span class="c1"># Find axis location with various gutters, etc.</span>
        <span class="n">x_window_start</span> <span class="o">=</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">x_gutter</span><span class="o">+</span><span class="n">x_window_size</span><span class="p">)</span>
        <span class="n">y_window_start</span> <span class="o">=</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">axis_location</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">y_window_size</span> <span class="o">-</span> <span class="n">k</span><span class="o">*</span><span class="p">(</span><span class="n">y_gutter</span><span class="o">+</span><span class="n">y_window_size</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="n">x_window_start</span><span class="p">,</span> <span class="n">y_window_start</span><span class="p">,</span> <span class="n">x_window_size</span><span class="p">,</span> <span class="n">y_window_size</span><span class="p">])</span>

        <span class="c1"># Find limits in x/y</span>
        <span class="n">limx</span><span class="o">=</span><span class="n">_find_limits</span><span class="p">(</span><span class="n">lower_data_array</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span><span class="n">quantile</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">upper_data_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">upper_limx</span> <span class="o">=</span> <span class="n">_find_limits</span><span class="p">(</span><span class="n">upper_data_array</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span><span class="n">quantile</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">limx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">limx</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">upper_limx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">limx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">limx</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">upper_limx</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">diagonal_plot_handles</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">kde_plot_1d</span><span class="p">(</span><span class="n">lower_data_array</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="n">limx</span><span class="p">,</span><span class="n">nbin</span><span class="o">=</span><span class="n">nbin</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span><span class="n">filled</span><span class="o">=</span><span class="n">filled</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">upper_data_array</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">diagonal_plot_handles</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kde_plot_1d</span><span class="p">(</span><span class="n">upper_data_array</span><span class="p">[:,</span><span class="n">k</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">upper_color</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="n">limx</span><span class="p">,</span><span class="n">nbin</span><span class="o">=</span><span class="n">nbin</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span><span class="n">filled</span><span class="o">=</span><span class="n">filled</span><span class="p">)</span>

        <span class="n">axes_handles</span><span class="p">[</span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

                
        <span class="n">ylims</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="n">ylims</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">limx</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelright</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labeltop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;in&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="n">nrow</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelbottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        

        <span class="k">if</span> <span class="p">(</span><span class="n">truths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>

            <span class="n">xlim</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()</span>
            <span class="n">ylim</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">truths</span><span class="p">[</span><span class="n">k</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">truths_color</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">truths_linewidth</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">truths_alpha</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">xlim</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>


        <span class="c1"># Add grid if requested</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">grid</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

            
    <span class="k">return</span> <span class="p">(</span><span class="n">axes_handles</span><span class="p">,</span><span class="n">lower_triangle_plot_handles</span><span class="p">,</span><span class="n">upper_triangle_plot_handles</span><span class="p">,</span><span class="n">diagonal_plot_handles</span><span class="p">)</span></div>



</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Themis Development Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.3.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            LINK_SUFFIX:'.html', 
            HAS_SOURCE: 'true'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>