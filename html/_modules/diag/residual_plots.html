

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>diag.residual_plots &mdash; ThemisPy 0.3.0+122.gd356c33.dirty documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="ThemisPy 0.3.0+122.gd356c33.dirty documentation" href="../../index.html"/>
        <link rel="up" title="Module code" href="../index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../docs/src/index.html" class="icon icon-home"> ThemisPy
          

          
          </a>

          
            
            
              <div class="version">
                0.3.0+122.gd356c33.dirty
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/installation.html">Installation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/userguide.html">User’s Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docs/src/devel.html">Developer’s Guide</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../docs/src/index.html">ThemisPy</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          













<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    
      <li><a href="../../docs/src/index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>diag.residual_plots</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for diag.residual_plots</h1><div class="highlight"><pre>
<span></span><span class="c1">###########################</span>
<span class="c1">#</span>
<span class="c1"># Package:</span>
<span class="c1">#   residual_plots</span>
<span class="c1">#</span>
<span class="c1"># Provides:</span>
<span class="c1">#   Functions for residual plots from residual files produced by Themis.</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">themispy.utils</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1">#from matplotlib import cm</span>
<span class="c1">#from matplotlib.colors import is_color_like, to_rgba</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">cmath</span>

<span class="kn">from</span> <span class="nn">themispy</span> <span class="kn">import</span> <span class="n">data</span> <span class="k">as</span> <span class="n">tydata</span>


<div class="viewcode-block" id="read_residuals"><a class="viewcode-back" href="../../docs/src/diag.html#diag.residual_plots.read_residuals">[docs]</a><span class="k">def</span> <span class="nf">read_residuals</span><span class="p">(</span><span class="n">resfile_name</span><span class="p">,</span> <span class="n">datafile_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datafile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reads in a Themis residual file and returns a dictionary object with </span>
<span class="sd">    the assiciated information.  If a datafile_list or datafile is provided, </span>
<span class="sd">    will associate line-by-line time, baseline, source.  If provided, the </span>
<span class="sd">    number of combined lines must match the number of data points in the </span>
<span class="sd">    residual file.</span>

<span class="sd">    Args:</span>
<span class="sd">      resfile_file (str): Residual output file.</span>
<span class="sd">      datafile_list (str,list): Either the name of a file containing a list of Themis-formatted data files (e.g., v_file_list), or a list of data files.  Default: None.</span>
<span class="sd">      datafile (str): Name of file containing Themis-formatted data.  Default: None.</span>
<span class="sd">      verbosity (int): Verbosity level.  Default: 0.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">      (dict): Dictionary of residual information, with specific structure dependent on the type of residuals.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    
    <span class="c1"># Check datafile_list vs datafile.</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">datafile_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datafile_list</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">datafile_list_name</span><span class="o">=</span><span class="n">datafile_list</span>
            <span class="n">datafile_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">datafile_list_name</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">datafile_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
    <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">datafile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">datafile_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">datafile</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">datafile_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading data files:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">datafile</span> <span class="ow">in</span> <span class="n">datafile_list</span> <span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">datafile</span><span class="p">)</span>

    <span class="c1"># Find residual file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">resfile_name</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span> <span class="p">:</span>
        <span class="n">restype</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">verbosity</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Reading residual file of type </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">restype</span><span class="p">)</span>

    <span class="c1"># Dictionary</span>
    <span class="n">resdata</span><span class="o">=</span><span class="p">{}</span>

    <span class="c1"># Run through kinds of residual files</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">restype</span><span class="o">==</span><span class="s1">&#39;likelihood_visibility&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">resfile_name</span><span class="p">)</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;visibility&#39;</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">9</span><span class="p">]</span>

        <span class="c1"># Read in data files</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">datafile_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">datafile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datafile_list</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">datasub</span> <span class="o">=</span> <span class="n">tydata</span><span class="o">.</span><span class="n">read_visibilities</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">datasub</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">datasub</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                        
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">])</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]))</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Number of points in data file does not match number of points in residual file.  Expected </span><span class="si">%i</span><span class="s2">, found </span><span class="si">%i</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">])))</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;baseline&#39;</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">resdata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1">#for key in resdata.keys() :</span>
        <span class="c1">#    resdata[key] = np.array(resdata[key])    </span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">restype</span><span class="o">==</span><span class="s1">&#39;likelihood_crosshand_visibilities&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">resfile_name</span><span class="p">)</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;crosshand&#39;</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;field rotation 1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;field rotation 2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;RR&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">8</span><span class="p">],</span> <span class="s1">&#39;LL&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">12</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">16</span><span class="p">],</span> <span class="s1">&#39;RL&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">20</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">24</span><span class="p">],</span> <span class="s1">&#39;LR&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">28</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">32</span><span class="p">]}</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;RR&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">9</span><span class="p">],</span> <span class="s1">&#39;LL&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">13</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">17</span><span class="p">],</span> <span class="s1">&#39;RL&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">21</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">25</span><span class="p">],</span> <span class="s1">&#39;LR&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">29</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">33</span><span class="p">]}</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;RR&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">10</span><span class="p">],</span> <span class="s1">&#39;LL&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">14</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">18</span><span class="p">],</span> <span class="s1">&#39;RL&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">22</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">26</span><span class="p">],</span> <span class="s1">&#39;LR&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">30</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">34</span><span class="p">]}</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;RR&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">11</span><span class="p">],</span> <span class="s1">&#39;LL&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">15</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">19</span><span class="p">],</span> <span class="s1">&#39;RL&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">23</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">27</span><span class="p">],</span> <span class="s1">&#39;LR&#39;</span><span class="p">:</span><span class="n">d</span><span class="p">[:,</span><span class="mi">31</span><span class="p">]</span><span class="o">+</span><span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">d</span><span class="p">[:,</span><span class="mi">35</span><span class="p">]}</span>

        <span class="c1"># Read in data files</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">datafile_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">datafile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datafile_list</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">datasub</span> <span class="o">=</span> <span class="n">tydata</span><span class="o">.</span><span class="n">read_crosshand_visibilities</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">datasub</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">datasub</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                        
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">][</span><span class="s1">&#39;RR&#39;</span><span class="p">])</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]))</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Number of points in data file does not match number of points in residual file.  Expected </span><span class="si">%i</span><span class="s2">, found </span><span class="si">%i</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">])))</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;baseline&#39;</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">resdata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        
                    
    <span class="k">elif</span> <span class="p">(</span><span class="n">restype</span><span class="o">==</span><span class="s1">&#39;likelihood_visibility_amplitude&#39;</span> \
    <span class="ow">or</span> <span class="n">restype</span><span class="o">==</span><span class="s1">&#39;likelihood_marginalized_visibility_amplitude&#39;</span> \
    <span class="ow">or</span> <span class="n">restype</span><span class="o">==</span><span class="s1">&#39;likelihood_optimal_gain_correction_visibility_amplitude&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">resfile_name</span><span class="p">)</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;amplitude&#39;</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span>

        <span class="c1"># Read in data files</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">datafile_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">datafile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datafile_list</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">datasub</span> <span class="o">=</span> <span class="n">tydata</span><span class="o">.</span><span class="n">read_amplitudes</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">datasub</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">datasub</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                        
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">])</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]))</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Number of points in data file does not match number of points in residual file.  Expected </span><span class="si">%i</span><span class="s2">, found </span><span class="si">%i</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">])))</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;baseline&#39;</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">resdata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1">#for key in resdata.keys() :</span>
        <span class="c1">#    resdata[key] = np.array(resdata[key])    </span>
                
    <span class="k">elif</span> <span class="p">(</span><span class="n">restype</span><span class="o">==</span><span class="s1">&#39;likelihood_closure_phase&#39;</span> \
    <span class="ow">or</span> <span class="n">restype</span><span class="o">==</span><span class="s1">&#39;likelihood_marginalized_closure_phase&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">resfile_name</span><span class="p">)</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;closure phase&#39;</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">9</span><span class="p">]</span>

        <span class="c1"># Read in data files</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">datafile_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">datafile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datafile_list</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">datasub</span> <span class="o">=</span> <span class="n">tydata</span><span class="o">.</span><span class="n">read_closure_phases</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">datasub</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">datasub</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                        
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">])</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]))</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Number of points in data file does not match number of points in residual file.  Expected </span><span class="si">%i</span><span class="s2">, found </span><span class="si">%i</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">])))</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;triangle&#39;</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">resdata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">restype</span><span class="o">==</span><span class="s1">&#39;likelihood_closure_amplitude&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">resfile_name</span><span class="p">)</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;closure amplitude&#39;</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u4&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v4&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">10</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">11</span><span class="p">]</span>

        <span class="c1"># Read in data files</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">datafile_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Reading closure amplitude data has not been implemented.&quot;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">datafile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datafile_list</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">datasub</span> <span class="o">=</span> <span class="n">tydata</span><span class="o">.</span><span class="n">read_closure_amplitudes</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">datasub</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">datasub</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                        
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">])</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]))</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Number of points in data file does not match number of points in residual file.  Expected </span><span class="si">%i</span><span class="s2">, found </span><span class="si">%i</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">])))</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;baseline&#39;</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">resdata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1">#for key in resdata.keys() :</span>
        <span class="c1">#    resdata[key] = np.array(resdata[key])    </span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">restype</span><span class="o">==</span><span class="s1">&#39;likelihood_log_closure_amplitude&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">resfile_name</span><span class="p">)</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;log closure amplitude&#39;</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;u4&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;v4&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">10</span><span class="p">]</span>
        <span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span><span class="p">[:,</span><span class="mi">11</span><span class="p">]</span>

        <span class="c1"># Read in data files</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">datafile_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Reading log closure amplitude data has not been implemented.&quot;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">datafile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datafile_list</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">datasub</span> <span class="o">=</span> <span class="n">tydata</span><span class="o">.</span><span class="n">read_log_closure_amplitudes</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">datasub</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
                        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">datasub</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
                        
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">])</span><span class="o">!=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">]))</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Number of points in data file does not match number of points in residual file.  Expected </span><span class="si">%i</span><span class="s2">, found </span><span class="si">%i</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">])))</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;baseline&#39;</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">resdata</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="c1">#for key in resdata.keys() :</span>
        <span class="c1">#    resdata[key] = np.array(resdata[key])    </span>
        
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized residual file type </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">restype</span><span class="p">))</span>


    <span class="k">return</span> <span class="n">resdata</span></div>

<span class="k">def</span> <span class="nf">_station_codes_from_baseline</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns station names from baseline glob.</span>

<span class="sd">    Args:</span>
<span class="sd">      baseline (str): Name of baseline (e.g., &#39;AAAP&#39;)</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">      (str,str): </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">snl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">baseline</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">baseline</span><span class="p">[:</span><span class="n">snl</span><span class="p">],</span><span class="n">baseline</span><span class="p">[</span><span class="n">snl</span><span class="p">:]</span>


<span class="k">def</span> <span class="nf">_station_codes_from_triangle</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns station names from triangle glob.</span>

<span class="sd">    Args:</span>
<span class="sd">      baseline (str): Name of baseline (e.g., &#39;AAAP&#39;)</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">      (str,str): </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">snl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span><span class="o">//</span><span class="mi">3</span>
    <span class="k">return</span> <span class="n">triangle</span><span class="p">[:</span><span class="n">snl</span><span class="p">],</span><span class="n">triangle</span><span class="p">[</span><span class="n">snl</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">snl</span><span class="p">],</span><span class="n">triangle</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">snl</span><span class="p">:]</span>


<span class="k">def</span> <span class="nf">_station_codes_from_quadangle</span><span class="p">(</span><span class="n">quadangle</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns station names from triangle glob.</span>

<span class="sd">    Args:</span>
<span class="sd">      baseline (str): Name of baseline (e.g., &#39;AAAP&#39;)</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">      (str,str): </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">snl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">triangle</span><span class="p">)</span><span class="o">//</span><span class="mi">4</span>
    <span class="k">return</span> <span class="n">quadangle</span><span class="p">[:</span><span class="n">snl</span><span class="p">],</span><span class="n">quadangle</span><span class="p">[</span><span class="n">snl</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">snl</span><span class="p">],</span><span class="n">quadangle</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">snl</span><span class="p">:</span><span class="mi">3</span><span class="o">*</span><span class="n">snl</span><span class="p">],</span><span class="n">quadangle</span><span class="p">[</span><span class="mi">3</span><span class="o">*</span><span class="n">snl</span><span class="p">:]</span>


<div class="viewcode-block" id="plot_amplitude_residuals"><a class="viewcode-back" href="../../docs/src/diag.html#diag.residual_plots.plot_amplitude_residuals">[docs]</a><span class="k">def</span> <span class="nf">plot_amplitude_residuals</span><span class="p">(</span><span class="n">resdata</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;uvamp&#39;</span><span class="p">,</span> <span class="n">gain_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">station_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resdist</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">datafmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">datacolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">modelfmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">modelcolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots comparison between the visibility amplitudes from the data and model in a variety of possible formats.</span>

<span class="sd">    Args:</span>
<span class="sd">      resdata (dict): Dictionary object containing the residual data as generated, e.g., by :func:`read_residuals`.</span>
<span class="sd">      plot_type (str): Type of residual plot to generate. Options are &#39;uvamp&#39;, &#39;u&#39;, &#39;v&#39;, &#39;time&#39;, &#39;amplitude&#39;, &#39;snr&#39;. Default: &#39;uvamp&#39;.</span>
<span class="sd">      gain_data (dict): Gain data object as generated, e.g., by :func:`read_gain_file`. If provided, data will be calibrated prior to residuals being plotted. Default: None.</span>
<span class="sd">      station_list (list,str): Station or list of stations to either exclude or restrict the residual plot to. Requires resdata to contain a key &#39;baselines&#39;.  Station names prepended with &#39;!&#39; will be excluded.  If any station names without &#39;!&#39; are given, will show *only* those stations. Default: None.</span>
<span class="sd">      residuals (bool): If True produces a sub-panel with the error-weighted residuals plotted underneath the comparison plot. Default: True.</span>
<span class="sd">      resdist (int): If not None, produces a sub-panel with the distribution of residuals compared to a unit-variance Gaussian. If an int value is passed, it will set the number of bins per unit standard deviation. Default: 2.</span>
<span class="sd">      datafmt (str): Format specifier for the data points. Default: &#39;o&#39;.</span>
<span class="sd">      datacolor (str,list): Color of the data points in acceptable color type as specified in :mod:`matplotlib.colors`. Default: &#39;b&#39;.</span>
<span class="sd">      modelfmt (str): Format specifier for the model points. Default: &#39;.&#39;.</span>
<span class="sd">      modelcolor (str,list): Color of the model points in acceptable color type as specified in :mod:`matplotlib.colors`. Default: &#39;r&#39;.</span>
<span class="sd">      grid (bool): Flag that determines whether or not to plot a background grid. Default: True.    </span>
<span class="sd">      xscale (str): The x-axis scaling. May be specified via any value accepted by :func:`matplotlib.axes.Axes.set_xscale`.  Default: &#39;linear&#39;.</span>
<span class="sd">      yscale (str): The y-axis scaling. May be specified via any value accepted by :func:`matplotlib.axes.Axes.set_xscale`.  Default: &#39;linear&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (matplotlib.figure.Figure, list): Figure and list of axes handles.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create local copy so that we can modify it</span>
    <span class="n">resdata_local</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">resdata</span><span class="p">)</span>
    
    
    <span class="c1"># Apply gains</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">gain_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">resdata_local</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Residual data does not include time&quot;</span><span class="p">)</span>

        <span class="n">tstart</span> <span class="o">=</span> <span class="n">gain_data</span><span class="p">[</span><span class="s1">&#39;tstart&#39;</span><span class="p">]</span>
        <span class="n">tend</span> <span class="o">=</span> <span class="n">gain_data</span><span class="p">[</span><span class="s1">&#39;tend&#39;</span><span class="p">]</span>
        <span class="n">toffset</span> <span class="o">=</span> <span class="p">((</span><span class="n">gain_data</span><span class="p">[</span><span class="s1">&#39;toffset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mjd</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">24</span>
        
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">]))</span> <span class="p">:</span>
            <span class="n">station1</span><span class="p">,</span><span class="n">station2</span> <span class="o">=</span> <span class="n">_station_codes_from_baseline</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

            <span class="n">current_epoch</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain_data</span><span class="p">[</span><span class="s1">&#39;tstart&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">toffset</span><span class="p">))</span><span class="o">*</span><span class="p">((</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">toffset</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">gain_data</span><span class="p">[</span><span class="s1">&#39;tend&#39;</span><span class="p">])</span>
            <span class="n">GA</span> <span class="o">=</span> <span class="n">gain_data</span><span class="p">[</span><span class="n">station1</span><span class="p">][</span><span class="n">current_epoch</span><span class="p">]</span>
            <span class="n">GB</span> <span class="o">=</span> <span class="n">gain_data</span><span class="p">[</span><span class="n">station2</span><span class="p">][</span><span class="n">current_epoch</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;model&#39;</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">GA</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">GB</span><span class="p">))</span> <span class="p">)</span> <span class="o">*</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            

    <span class="c1"># Apply station list flagging</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">station_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s1">&#39;baseline&#39;</span> <span class="ow">in</span> <span class="n">resdata_local</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Residual data does not include baselines&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">station_list</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">station_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">station_list</span><span class="p">]</span>

        <span class="n">station_include_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">station_exclude_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">station_list</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">station_exclude_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">station_include_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="p">)</span>


        <span class="n">keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">]))</span> <span class="p">:</span>
            <span class="n">station1</span><span class="p">,</span><span class="n">station2</span> <span class="o">=</span> <span class="n">_station_codes_from_baseline</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">station_include_list</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">station1</span> <span class="ow">in</span> <span class="n">station_include_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station2</span> <span class="ow">in</span> <span class="n">station_include_list</span><span class="p">))</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">station_exclude_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">((</span><span class="n">station1</span> <span class="ow">in</span> <span class="n">station_exclude_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station2</span> <span class="ow">in</span> <span class="n">station_exclude_list</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;model&#39;</span><span class="p">,</span><span class="s1">&#39;residual&#39;</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="p">:</span>
            <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span>

    <span class="c1"># Select coordinate</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;uvamp&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$|u|$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$u$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;v&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$v$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">resdata_local</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Residual data does not include time&quot;</span><span class="p">)</span>
        <span class="n">x</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$t$ (UTC)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$V$ (Jy)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$S/N$&#39;</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized plot type </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">plot_type</span><span class="p">))</span>

    <span class="c1"># Check if a residual distribution is desired and set defaults</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">resdist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">resdist_numbins</span><span class="o">=</span><span class="mi">2</span>
        <span class="n">resdist</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">resdist_numbins</span><span class="o">=</span><span class="n">resdist</span>
        <span class="n">resdist</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1"># Create figure and axes objects</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">resdist</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">6.</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
            <span class="n">axs_res</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.83</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
            <span class="n">axs_comp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.38</span><span class="p">,</span><span class="mf">0.83</span><span class="p">,</span><span class="mf">0.57</span><span class="p">])</span>
            <span class="n">axs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs_comp</span><span class="p">,</span><span class="n">axs_res</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
            <span class="n">axs_res</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1385</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.7662</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
            <span class="n">axs_comp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1385</span><span class="p">,</span><span class="mf">0.38</span><span class="p">,</span><span class="mf">0.7662</span><span class="p">,</span><span class="mf">0.57</span><span class="p">])</span>
            <span class="n">axs_resdist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.915</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
            <span class="n">axs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs_comp</span><span class="p">,</span><span class="n">axs_res</span><span class="p">,</span><span class="n">axs_resdist</span><span class="p">]</span>
            
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">6.</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
        <span class="n">axs_comp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">])</span>
        <span class="n">axs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs_comp</span><span class="p">]</span>

    <span class="c1"># Plot the data comparision</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_comp</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span><span class="n">yerr</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">],</span><span class="n">fmt</span><span class="o">=</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span><span class="n">modelfmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">modelcolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$|V|$ (Jy)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
    <span class="n">axs_comp</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>
    <span class="n">axs_comp</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">yscale</span><span class="p">)</span>

    <span class="c1"># Plot the residuals if desired</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">axs_comp</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_res</span><span class="p">)</span>
        <span class="c1"># Sigma guides</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="c1"># plot the markers</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">],</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Res.&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">axs_res</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">resdist</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="n">axs_res</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_resdist</span><span class="p">)</span>
            <span class="n">xtmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">256</span><span class="p">)</span>
            <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xtmp</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ytmp</span><span class="p">,</span><span class="n">xtmp</span><span class="p">,</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
            <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">xtmp</span><span class="o">-</span><span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">var</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">var</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ytmp</span><span class="p">,</span><span class="n">xtmp</span><span class="p">,</span><span class="s1">&#39;:g&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">resdist_numbins</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">resdist_numbins</span><span class="p">)))</span><span class="o">/</span><span class="n">resdist_numbins</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>            
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_res</span><span class="p">)</span>
        
    <span class="c1"># Add the xlabels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlbl</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">axs_list</span></div>


<div class="viewcode-block" id="plot_closure_phase_residuals"><a class="viewcode-back" href="../../docs/src/diag.html#diag.residual_plots.plot_closure_phase_residuals">[docs]</a><span class="k">def</span> <span class="nf">plot_closure_phase_residuals</span><span class="p">(</span><span class="n">resdata</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;perimeter&#39;</span><span class="p">,</span> <span class="n">gain_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">station_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resdist</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">resdist_numbins</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">datafmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">datacolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">modelfmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">modelcolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots comparison between the closure phases from the data and model in a variety of possible formats.</span>

<span class="sd">    Args:</span>
<span class="sd">      resdata (dict): Dictionary object containing the residual data as generated, e.g., by :func:`read_residuals`.</span>
<span class="sd">      plot_type (str): Type of residual plot to generate. Options are &#39;perimeter&#39;, &#39;arear&#39;, &#39;uvmax&#39;, &#39;uvmin&#39;, &#39;umax&#39;, &#39;umin&#39;, &#39;vmax&#39;, &#39;vmin&#39;, &#39;time&#39;, &#39;snr&#39;. Default: &#39;perimeter&#39;.</span>
<span class="sd">      station_list (list,str): Station or list of stations to either exclude or restrict the residual plot to. Requires resdata to contain a key &#39;baselines&#39;.  Station names prepended with &#39;!&#39; will be excluded.  If any station names without &#39;!&#39; are given, will show *only* those stations. Default: None.</span>
<span class="sd">      residuals (bool): If True produces a sub-panel with the error-weighted residuals plotted underneath the comparison plot. Default: True.</span>
<span class="sd">      resdist (int): If not None, produces a sub-panel with the distribution of residuals compared to a unit-variance Gaussian. If an int value is passed, it will set the number of bins per unit standard deviation. Default: 2.</span>
<span class="sd">      datafmt (str): Format specifier for the data points. Default: &#39;o&#39;.</span>
<span class="sd">      datacolor (str,list): Color of the data points in acceptable color type as specified in :mod:`matplotlib.colors`. Default: &#39;b&#39;.</span>
<span class="sd">      modelfmt (str): Format specifier for the model points. Default: &#39;.&#39;.</span>
<span class="sd">      modelcolor (str,list): Color of the model points in acceptable color type as specified in :mod:`matplotlib.colors`. Default: &#39;r&#39;.</span>
<span class="sd">      grid (bool): Flag that determines whether or not to plot a background grid. Default: True.    </span>
<span class="sd">      xscale (str): The x-axis scaling. May be specified via any value accepted by :func:`matplotlib.axes.Axes.set_xscale`.  Default: &#39;linear&#39;.</span>
<span class="sd">      yscale (str): The y-axis scaling. May be specified via any value accepted by :func:`matplotlib.axes.Axes.set_xscale`.  Default: &#39;linear&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (matplotlib.figure.Figure, list): Figure and list of axes handles.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create local copy so that we can modify it</span>
    <span class="n">resdata_local</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">resdata</span><span class="p">)</span>
    
    
    <span class="c1"># Apply station list flagging</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">station_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s1">&#39;triangle&#39;</span> <span class="ow">in</span> <span class="n">resdata_local</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Residual data does not include triangles&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">station_list</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">station_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">station_list</span><span class="p">]</span>

        <span class="n">station_include_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">station_exclude_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">station_list</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">station_exclude_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">station_include_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="p">)</span>


        <span class="n">keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;triangle&#39;</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;triangle&#39;</span><span class="p">]))</span> <span class="p">:</span>
            <span class="n">station1</span><span class="p">,</span><span class="n">station2</span><span class="p">,</span><span class="n">station3</span> <span class="o">=</span> <span class="n">_station_codes_from_triangle</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;triangle&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">station_include_list</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">station1</span> <span class="ow">in</span> <span class="n">station_include_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station2</span> <span class="ow">in</span> <span class="n">station_include_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station3</span> <span class="ow">in</span> <span class="n">station_include_list</span><span class="p">))</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">station_exclude_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">((</span><span class="n">station1</span> <span class="ow">in</span> <span class="n">station_exclude_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station2</span> <span class="ow">in</span> <span class="n">station_exclude_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station3</span> <span class="ow">in</span> <span class="n">station_exclude_list</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;u1&#39;</span><span class="p">,</span><span class="s1">&#39;v1&#39;</span><span class="p">,</span><span class="s1">&#39;u2&#39;</span><span class="p">,</span><span class="s1">&#39;v2&#39;</span><span class="p">,</span><span class="s1">&#39;u3&#39;</span><span class="p">,</span><span class="s1">&#39;v3&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;model&#39;</span><span class="p">,</span><span class="s1">&#39;residual&#39;</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="p">:</span>
            <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span>

    <span class="c1"># Select coordinate</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;perimeter&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Perimeter (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;area&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="c1"># u1amp = np.sqrt(resdata_local[&#39;u1&#39;]**2+resdata_local[&#39;v1&#39;]**2)</span>
        <span class="c1"># u2amp = np.sqrt(resdata_local[&#39;u2&#39;]**2+resdata_local[&#39;v2&#39;]**2)</span>
        <span class="c1"># u1du2 = resdata_local[&#39;u1&#39;]*resdata_local[&#39;u2&#39;]+resdata_local[&#39;v1&#39;]*resdata_local[&#39;v2&#39;]</span>
        <span class="c1"># x = 0.5*np.sqrt( (u1amp*u2amp)**2 - u1du2**2 )</span>
        <span class="c1"># xlbl=r&#39;Area (G$\lambda^2$)&#39;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">])</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Area (G$\lambda^2$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;uvmax&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">u1amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u2amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u3amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">u1amp</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">u2amp</span><span class="p">,</span><span class="n">u3amp</span><span class="p">))</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$|u|_</span><span class="si">{max}</span><span class="s1">$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;uvmin&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">u1amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u2amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u3amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">u1amp</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">u2amp</span><span class="p">,</span><span class="n">u3amp</span><span class="p">))</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$|u|_</span><span class="si">{min}</span><span class="s1">$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;umax&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">],</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">]))</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$u_</span><span class="si">{max}</span><span class="s1">$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;umin&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">],</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">]))</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$u_</span><span class="si">{min}</span><span class="s1">$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;vmax&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">],</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">]))</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$v_</span><span class="si">{max}</span><span class="s1">$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;vmin&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">],</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">]))</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$v_</span><span class="si">{min}</span><span class="s1">$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">resdata_local</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Residual data does not include time&quot;</span><span class="p">)</span>
        <span class="n">x</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$t$ (UTC)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$S/N$&#39;</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized plot type </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">plot_type</span><span class="p">))</span>

    <span class="c1"># Check if a residual distribution is desired and set defaults</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">resdist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">resdist_numbins</span><span class="o">=</span><span class="mi">2</span>
        <span class="n">resdist</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">resdist_numbins</span><span class="o">=</span><span class="n">resdist</span>
        <span class="n">resdist</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1"># Create figure and axes objects</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">resdist</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">6.</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
            <span class="n">axs_res</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.83</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
            <span class="n">axs_comp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.38</span><span class="p">,</span><span class="mf">0.83</span><span class="p">,</span><span class="mf">0.57</span><span class="p">])</span>
            <span class="n">axs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs_comp</span><span class="p">,</span><span class="n">axs_res</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
            <span class="n">axs_res</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1385</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.7662</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
            <span class="n">axs_comp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1385</span><span class="p">,</span><span class="mf">0.38</span><span class="p">,</span><span class="mf">0.7662</span><span class="p">,</span><span class="mf">0.57</span><span class="p">])</span>
            <span class="n">axs_resdist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.915</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
            <span class="n">axs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs_comp</span><span class="p">,</span><span class="n">axs_res</span><span class="p">,</span><span class="n">axs_resdist</span><span class="p">]</span>
            
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">6.</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
        <span class="n">axs_comp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">])</span>
        <span class="n">axs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs_comp</span><span class="p">]</span>

    <span class="c1"># Plot the data comparision</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_comp</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span><span class="n">yerr</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">],</span><span class="n">fmt</span><span class="o">=</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span><span class="n">modelfmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">modelcolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Closure Phase (deg)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
    <span class="n">axs_comp</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>
    <span class="n">axs_comp</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">yscale</span><span class="p">)</span>

    <span class="c1"># Plot the residuals if desired</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">axs_comp</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_res</span><span class="p">)</span>
        <span class="c1"># Sigma guides</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="c1"># plot the markers</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">],</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Res.&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">axs_res</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">resdist</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="n">axs_res</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_resdist</span><span class="p">)</span>
            <span class="n">xtmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">256</span><span class="p">)</span>
            <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xtmp</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ytmp</span><span class="p">,</span><span class="n">xtmp</span><span class="p">,</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
            <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">xtmp</span><span class="o">-</span><span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">var</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">var</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ytmp</span><span class="p">,</span><span class="n">xtmp</span><span class="p">,</span><span class="s1">&#39;:g&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">resdist_numbins</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">resdist_numbins</span><span class="p">)))</span><span class="o">/</span><span class="n">resdist_numbins</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>            
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_res</span><span class="p">)</span>
            
    <span class="c1"># Add the xlabels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlbl</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">axs_list</span></div>



<div class="viewcode-block" id="plot_log_closure_amplitude_residuals"><a class="viewcode-back" href="../../docs/src/diag.html#diag.residual_plots.plot_log_closure_amplitude_residuals">[docs]</a><span class="k">def</span> <span class="nf">plot_log_closure_amplitude_residuals</span><span class="p">(</span><span class="n">resdata</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;perimeter&#39;</span><span class="p">,</span> <span class="n">gain_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">station_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resdist</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">resdist_numbins</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">datafmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">datacolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">modelfmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">modelcolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots comparison between the log closure amplitudes from the data and model in a variety of possible formats.</span>

<span class="sd">    Args:</span>
<span class="sd">      resdata (dict): Dictionary object containing the residual data as generated, e.g., by :func:`read_residuals`.</span>
<span class="sd">      plot_type (str): Type of residual plot to generate. Options are &#39;perimeter&#39;, &#39;arear&#39;, &#39;uvmax&#39;, &#39;uvmin&#39;, &#39;umax&#39;, &#39;umin&#39;, &#39;vmax&#39;, &#39;vmin&#39;, &#39;time&#39;, &#39;snr&#39;. Default: &#39;perimeter&#39;.</span>
<span class="sd">      station_list (list,str): Station or list of stations to either exclude or restrict the residual plot to. Requires resdata to contain a key &#39;baselines&#39;.  Station names prepended with &#39;!&#39; will be excluded.  If any station names without &#39;!&#39; are given, will show *only* those stations. Default: None.</span>
<span class="sd">      residuals (bool): If True produces a sub-panel with the error-weighted residuals plotted underneath the comparison plot. Default: True.</span>
<span class="sd">      resdist (int): If not None, produces a sub-panel with the distribution of residuals compared to a unit-variance Gaussian. If an int value is passed, it will set the number of bins per unit standard deviation. Default: 2.</span>
<span class="sd">      datafmt (str): Format specifier for the data points. Default: &#39;o&#39;.</span>
<span class="sd">      datacolor (str,list): Color of the data points in acceptable color type as specified in :mod:`matplotlib.colors`. Default: &#39;b&#39;.</span>
<span class="sd">      modelfmt (str): Format specifier for the model points. Default: &#39;.&#39;.</span>
<span class="sd">      modelcolor (str,list): Color of the model points in acceptable color type as specified in :mod:`matplotlib.colors`. Default: &#39;r&#39;.</span>
<span class="sd">      grid (bool): Flag that determines whether or not to plot a background grid. Default: True.    </span>
<span class="sd">      xscale (str): The x-axis scaling. May be specified via any value accepted by :func:`matplotlib.axes.Axes.set_xscale`.  Default: &#39;linear&#39;.</span>
<span class="sd">      yscale (str): The y-axis scaling. May be specified via any value accepted by :func:`matplotlib.axes.Axes.set_xscale`.  Default: &#39;linear&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (matplotlib.figure.Figure, list): Figure and list of axes handles.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create local copy so that we can modify it</span>
    <span class="n">resdata_local</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">resdata</span><span class="p">)</span>
    
    
    <span class="c1"># Apply station list flagging</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">station_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s1">&#39;quadrangle&#39;</span> <span class="ow">in</span> <span class="n">resdata_local</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Residual data does not include quadrangles&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">station_list</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">station_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">station_list</span><span class="p">]</span>

        <span class="n">station_include_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">station_exclude_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">station_list</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">station_exclude_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">station_include_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="p">)</span>


        <span class="n">keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;quadrangle&#39;</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;quadrangle&#39;</span><span class="p">]))</span> <span class="p">:</span>
            <span class="n">station1</span><span class="p">,</span><span class="n">station2</span><span class="p">,</span><span class="n">station3</span><span class="p">,</span><span class="n">station4</span> <span class="o">=</span> <span class="n">_station_codes_from_quadangle</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;quadangle&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">station_include_list</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">station1</span> <span class="ow">in</span> <span class="n">station_include_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station2</span> <span class="ow">in</span> <span class="n">station_include_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station3</span> <span class="ow">in</span> <span class="n">station_include_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station4</span> <span class="ow">in</span> <span class="n">station_include_list</span><span class="p">))</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">station_exclude_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">((</span><span class="n">station1</span> <span class="ow">in</span> <span class="n">station_exclude_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station2</span> <span class="ow">in</span> <span class="n">station_exclude_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station3</span> <span class="ow">in</span> <span class="n">station_exclude_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station4</span> <span class="ow">in</span> <span class="n">station_exclude_list</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;u1&#39;</span><span class="p">,</span><span class="s1">&#39;v1&#39;</span><span class="p">,</span><span class="s1">&#39;u2&#39;</span><span class="p">,</span><span class="s1">&#39;v2&#39;</span><span class="p">,</span><span class="s1">&#39;u3&#39;</span><span class="p">,</span><span class="s1">&#39;v3&#39;</span><span class="p">,</span><span class="s1">&#39;u4&#39;</span><span class="p">,</span><span class="s1">&#39;v4&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;model&#39;</span><span class="p">,</span><span class="s1">&#39;residual&#39;</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="p">:</span>
            <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span>

    <span class="c1"># Select coordinate</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;perimeter&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u4&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v4&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Perimeter (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;area&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">]</span>
                       <span class="o">+</span>
                       <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v4&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u4&#39;</span><span class="p">])</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Area (G$\lambda^2$)&#39;</span>
        <span class="c1"># raise RuntimeError(&quot;area is not yet implmented for log closure amplitude quadrangles.&quot;)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;uvmax&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">u1amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u2amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u3amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u4amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u4&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v4&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">u1amp</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">u2amp</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">u3amp</span><span class="p">,</span><span class="n">u4amp</span><span class="p">)))</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$|u|_</span><span class="si">{max}</span><span class="s1">$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;uvmin&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">u1amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u2amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u3amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">u4amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u4&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v4&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">u1amp</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">u2amp</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">u3amp</span><span class="p">,</span><span class="n">u4amp</span><span class="p">)))</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$|u|_</span><span class="si">{min}</span><span class="s1">$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;umax&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">],</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u4&#39;</span><span class="p">])))</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$u_</span><span class="si">{max}</span><span class="s1">$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;umin&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u1&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u2&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u3&#39;</span><span class="p">],</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u4&#39;</span><span class="p">])))</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$u_</span><span class="si">{min}</span><span class="s1">$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;vmax&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">],</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v4&#39;</span><span class="p">])))</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$v_</span><span class="si">{max}</span><span class="s1">$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;vmin&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v1&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v2&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v3&#39;</span><span class="p">],</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v4&#39;</span><span class="p">])))</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$v_</span><span class="si">{min}</span><span class="s1">$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">resdata_local</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Residual data does not include time&quot;</span><span class="p">)</span>
        <span class="n">x</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$t$ (UTC)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type</span><span class="o">==</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$S/N$&#39;</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized plot type </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">plot_type</span><span class="p">))</span>

    <span class="c1"># Check if a residual distribution is desired and set defaults</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">resdist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">resdist_numbins</span><span class="o">=</span><span class="mi">2</span>
        <span class="n">resdist</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">resdist_numbins</span><span class="o">=</span><span class="n">resdist</span>
        <span class="n">resdist</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1"># Create figure and axes objects</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">resdist</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">6.</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
            <span class="n">axs_res</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.83</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
            <span class="n">axs_comp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.38</span><span class="p">,</span><span class="mf">0.83</span><span class="p">,</span><span class="mf">0.57</span><span class="p">])</span>
            <span class="n">axs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs_comp</span><span class="p">,</span><span class="n">axs_res</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
            <span class="n">axs_res</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1385</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.7662</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
            <span class="n">axs_comp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1385</span><span class="p">,</span><span class="mf">0.38</span><span class="p">,</span><span class="mf">0.7662</span><span class="p">,</span><span class="mf">0.57</span><span class="p">])</span>
            <span class="n">axs_resdist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.915</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
            <span class="n">axs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs_comp</span><span class="p">,</span><span class="n">axs_res</span><span class="p">,</span><span class="n">axs_resdist</span><span class="p">]</span>
            
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">6.</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
        <span class="n">axs_comp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">])</span>
        <span class="n">axs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs_comp</span><span class="p">]</span>

    <span class="c1"># Plot the data comparision</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_comp</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">],</span><span class="n">yerr</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">],</span><span class="n">fmt</span><span class="o">=</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">],</span><span class="n">modelfmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">modelcolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Log Closure Amplitude&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
    <span class="n">axs_comp</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>
    <span class="n">axs_comp</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">yscale</span><span class="p">)</span>

    <span class="c1"># Plot the residuals if desired</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">axs_comp</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_res</span><span class="p">)</span>
        <span class="c1"># Sigma guides</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="c1"># plot the markers</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">],</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Res.&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">axs_res</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">resdist</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="n">axs_res</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_resdist</span><span class="p">)</span>
            <span class="n">xtmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">256</span><span class="p">)</span>
            <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xtmp</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ytmp</span><span class="p">,</span><span class="n">xtmp</span><span class="p">,</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
            <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">xtmp</span><span class="o">-</span><span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">var</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">var</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ytmp</span><span class="p">,</span><span class="n">xtmp</span><span class="p">,</span><span class="s1">&#39;:g&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">resdist_numbins</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">resdist_numbins</span><span class="p">)))</span><span class="o">/</span><span class="n">resdist_numbins</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>            
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_res</span><span class="p">)</span>
            
    <span class="c1"># Add the xlabels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlbl</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">axs_list</span></div>


<div class="viewcode-block" id="plot_visibility_residuals"><a class="viewcode-back" href="../../docs/src/diag.html#diag.residual_plots.plot_visibility_residuals">[docs]</a><span class="k">def</span> <span class="nf">plot_visibility_residuals</span><span class="p">(</span><span class="n">resdata</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;uvamp|complex&#39;</span><span class="p">,</span> <span class="n">gain_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">station_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resdist</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">datafmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">datacolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">modelfmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">modelcolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots comparison between the visibility amplitudes from the data and model in a variety of possible formats.</span>

<span class="sd">    Args:</span>
<span class="sd">      resdata (dict): Dictionary object containing the residual data as generated, e.g., by :func:`read_residuals`.</span>
<span class="sd">      plot_type (str): Type of residual plot to generate specified via &#39;xtype|ytype&#39;. Options are xtype are &#39;uvamp&#39;, &#39;u&#39;, &#39;v&#39;, &#39;time&#39;, &#39;amplitude&#39;, &#39;snr&#39;. Options for ytype are &#39;complex&#39;, &#39;amplitude&#39;, &#39;phase&#39;. If only one type specifier is given, will attempt to intelligently interpret it, breaking ties by assigning it to the ytype. Default: &#39;uvamp|complex&#39;.</span>
<span class="sd">      gain_data (dict): Gain data object as generated, e.g., by :func:`read_gain_file`. If provided, data will be calibrated prior to residuals being plotted. Default: None.</span>
<span class="sd">      station_list (list,str): Station or list of stations to either exclude or restrict the residual plot to. Requires resdata to contain a key &#39;baselines&#39;.  Station names prepended with &#39;!&#39; will be excluded.  If any station names without &#39;!&#39; are given, will show *only* those stations. Default: None.</span>
<span class="sd">      residuals (bool): If True produces a sub-panel with the error-weighted residuals plotted underneath the comparison plot. Default: True.</span>
<span class="sd">      resdist (int): If not None, produces a sub-panel with the distribution of residuals compared to a unit-variance Gaussian. If an int value is passed, it will set the number of bins per unit standard deviation. Default: 2.</span>
<span class="sd">      datafmt (str): Format specifier for the data points. Default: &#39;o&#39;.</span>
<span class="sd">      datacolor (str,list): Color of the data points in acceptable color type as specified in :mod:`matplotlib.colors`. Default: &#39;b&#39;.</span>
<span class="sd">      modelfmt (str): Format specifier for the model points. Default: &#39;.&#39;.</span>
<span class="sd">      modelcolor (str,list): Color of the model points in acceptable color type as specified in :mod:`matplotlib.colors`. Default: &#39;r&#39;.</span>
<span class="sd">      grid (bool): Flag that determines whether or not to plot a background grid. Default: True.    </span>
<span class="sd">      xscale (str): The x-axis scaling. May be specified via any value accepted by :func:`matplotlib.axes.Axes.set_xscale`.  Default: &#39;linear&#39;.</span>
<span class="sd">      yscale (str): The y-axis scaling. May be specified via any value accepted by :func:`matplotlib.axes.Axes.set_xscale`.  Default: &#39;linear&#39;.</span>
<span class="sd">      alpha (float): Alpha value for points. Default: 0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (matplotlib.figure.Figure, list): Figure and list of axes handles.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create local copy so that we can modify it</span>
    <span class="n">resdata_local</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">resdata</span><span class="p">)</span>
    
    
    <span class="c1"># Apply gains</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">gain_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">resdata_local</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Residual data does not include time&quot;</span><span class="p">)</span>

        <span class="n">tstart</span> <span class="o">=</span> <span class="n">gain_data</span><span class="p">[</span><span class="s1">&#39;tstart&#39;</span><span class="p">]</span>
        <span class="n">tend</span> <span class="o">=</span> <span class="n">gain_data</span><span class="p">[</span><span class="s1">&#39;tend&#39;</span><span class="p">]</span>
        <span class="n">toffset</span> <span class="o">=</span> <span class="p">((</span><span class="n">gain_data</span><span class="p">[</span><span class="s1">&#39;toffset&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mjd</span><span class="p">)</span><span class="o">%</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">24</span>
        <span class="n">dayoffset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">]))</span> <span class="p">:</span>
            <span class="n">station1</span><span class="p">,</span><span class="n">station2</span> <span class="o">=</span> <span class="n">_station_codes_from_baseline</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

            <span class="n">dt</span> <span class="o">=</span> <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mi">24</span><span class="o">*</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="n">dayoffset</span><span class="p">)</span> <span class="o">-</span> <span class="n">toffset</span>
            <span class="n">current_epoch</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain_data</span><span class="p">[</span><span class="s1">&#39;tstart&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">dt</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">dt</span><span class="o">&lt;=</span><span class="n">gain_data</span><span class="p">[</span><span class="s1">&#39;tend&#39;</span><span class="p">])</span>
            <span class="n">GA</span> <span class="o">=</span> <span class="n">gain_data</span><span class="p">[</span><span class="n">station1</span><span class="p">][</span><span class="n">current_epoch</span><span class="p">]</span>
            <span class="n">GB</span> <span class="o">=</span> <span class="n">gain_data</span><span class="p">[</span><span class="n">station2</span><span class="p">][</span><span class="n">current_epoch</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;model&#39;</span><span class="p">,</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span> <span class="p">:</span>
                <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">GA</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">GB</span><span class="p">))</span> <span class="o">*</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="mf">1.0</span><span class="o">/</span><span class="n">GA</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">GB</span><span class="p">)))</span> <span class="o">*</span> <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>            

    <span class="c1"># Apply station list flagging</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">station_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s1">&#39;baseline&#39;</span> <span class="ow">in</span> <span class="n">resdata_local</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Residual data does not include baselines&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">station_list</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
            <span class="n">station_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">station_list</span><span class="p">]</span>

        <span class="n">station_include_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">station_exclude_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">station_list</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">station</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;!&#39;</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">station_exclude_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">station_include_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">station</span><span class="p">)</span>

        <span class="n">keep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">]))</span> <span class="p">:</span>
            <span class="n">station1</span><span class="p">,</span><span class="n">station2</span> <span class="o">=</span> <span class="n">_station_codes_from_baseline</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">station_include_list</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">station1</span> <span class="ow">in</span> <span class="n">station_include_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station2</span> <span class="ow">in</span> <span class="n">station_include_list</span><span class="p">))</span>

            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">station_exclude_list</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">keep</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">((</span><span class="n">station1</span> <span class="ow">in</span> <span class="n">station_exclude_list</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">station2</span> <span class="ow">in</span> <span class="n">station_exclude_list</span><span class="p">))</span>

                
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;model&#39;</span><span class="p">,</span><span class="s1">&#39;residual&#39;</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">]</span> <span class="p">:</span>
            <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">keep</span><span class="p">]</span>
            
    
    <span class="c1"># Determine the plot type to generate</span>
    <span class="n">toks</span> <span class="o">=</span> <span class="n">plot_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;|&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">toks</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">plot_type_x</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">plot_type_y</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">elif</span> <span class="p">(</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;complex&#39;</span><span class="p">,</span><span class="s1">&#39;amplitude&#39;</span><span class="p">,</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span> <span class="p">)</span> <span class="p">:</span>
        <span class="n">plot_type_x</span> <span class="o">=</span> <span class="s1">&#39;uvamp&#39;</span>
        <span class="n">plot_type_y</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">plot_type_x</span> <span class="o">=</span> <span class="n">toks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">plot_type_y</span> <span class="o">=</span> <span class="s1">&#39;complex&#39;</span>
            
            
    <span class="c1"># Select coordinate</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plot_type_x</span><span class="o">==</span><span class="s1">&#39;uvamp&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$|u|$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type_x</span><span class="o">==</span><span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$u$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type_x</span><span class="o">==</span><span class="s1">&#39;v&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$v$ (G$\lambda$)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type_x</span><span class="o">==</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">resdata_local</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Residual data does not include time&quot;</span><span class="p">)</span>
        <span class="n">x</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$t$ (UTC)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type_x</span><span class="o">==</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">])</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$|V|$ (Jy)&#39;</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type_x</span><span class="o">==</span><span class="s1">&#39;snr&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span>
        <span class="n">xlbl</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$S/N$&#39;</span>        
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized plot type </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">plot_type_x</span><span class="p">))</span>

    <span class="c1"># Check if a residual distribution is desired and set defaults</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">resdist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">resdist_numbins</span><span class="o">=</span><span class="mi">2</span>
        <span class="n">resdist</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">resdist_numbins</span><span class="o">=</span><span class="n">resdist</span>
        <span class="n">resdist</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1"># Create figure and axes objects</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">resdist</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">6.</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
            <span class="n">axs_res</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.83</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
            <span class="n">axs_comp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span><span class="mf">0.38</span><span class="p">,</span><span class="mf">0.83</span><span class="p">,</span><span class="mf">0.57</span><span class="p">])</span>
            <span class="n">axs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs_comp</span><span class="p">,</span><span class="n">axs_res</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">6.5</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
            <span class="n">axs_res</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1385</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.7662</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
            <span class="n">axs_comp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1385</span><span class="p">,</span><span class="mf">0.38</span><span class="p">,</span><span class="mf">0.7662</span><span class="p">,</span><span class="mf">0.57</span><span class="p">])</span>
            <span class="n">axs_resdist</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.915</span><span class="p">,</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.07</span><span class="p">,</span><span class="mf">0.25</span><span class="p">])</span>
            <span class="n">axs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs_comp</span><span class="p">,</span><span class="n">axs_res</span><span class="p">,</span><span class="n">axs_resdist</span><span class="p">]</span>
            
    <span class="k">else</span> <span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">6.</span><span class="p">,</span><span class="mf">5.</span><span class="p">])</span>
        <span class="n">axs_comp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">,</span> <span class="mf">0.83</span><span class="p">])</span>
        <span class="n">axs_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">axs_comp</span><span class="p">]</span>

    <span class="c1"># Plot the data comparision</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_comp</span><span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">plot_type_y</span><span class="o">==</span><span class="s1">&#39;complex&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Re($V$)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">yerr</span><span class="o">=</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Im($V$)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">modelfmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">modelcolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">modelfmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">modelcolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$V$ (Jy)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type_y</span><span class="o">==</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]),</span><span class="n">yerr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]),</span><span class="n">fmt</span><span class="o">=</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]),</span><span class="n">modelfmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">modelcolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$|V|$ (Jy)&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type_y</span><span class="o">==</span><span class="s1">&#39;phase&#39;</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]),</span><span class="n">yerr</span><span class="o">=</span><span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]),</span><span class="n">fmt</span><span class="o">=</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]),</span><span class="n">modelfmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">modelcolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">zorder</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;arg($V$) (deg)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span>
    <span class="k">else</span> <span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Unrecognized plot type </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">plot_type_y</span><span class="p">))</span>
        
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
    <span class="n">axs_comp</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>
    <span class="n">axs_comp</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">yscale</span><span class="p">)</span>


    <span class="c1"># Plot the residuals if desired</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">residuals</span><span class="p">)</span> <span class="p">:</span>
        <span class="n">axs_comp</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_res</span><span class="p">)</span>
        <span class="c1"># Sigma guides</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="c1"># plot the markers</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">plot_type_y</span><span class="o">==</span><span class="s1">&#39;complex&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">,</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span><span class="n">fillstyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type_y</span><span class="o">==</span><span class="s1">&#39;amplitude&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">])</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span> <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">plot_type_y</span><span class="o">==</span><span class="s1">&#39;phase&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">((</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">])</span> <span class="p">)</span><span class="o">/</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">])</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span> <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">res</span><span class="p">,</span><span class="n">datafmt</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Res.&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">axs_res</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="n">xscale</span><span class="p">)</span>


        <span class="k">if</span> <span class="p">(</span><span class="n">resdist</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">res</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="n">axs_res</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_resdist</span><span class="p">)</span>
            <span class="n">xtmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">256</span><span class="p">)</span>
            <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">xtmp</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ytmp</span><span class="p">,</span><span class="n">xtmp</span><span class="p">,</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
            <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
            <span class="n">ytmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">xtmp</span><span class="o">-</span><span class="n">mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">var</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">var</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ytmp</span><span class="p">,</span><span class="n">xtmp</span><span class="p">,</span><span class="s1">&#39;:g&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">resdist_numbins</span><span class="p">)),</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">resdist_numbins</span><span class="p">)))</span><span class="o">/</span><span class="n">resdist_numbins</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span><span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>            
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs_res</span><span class="p">)</span>

        
    <span class="c1"># Add the xlabels</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">xlbl</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">(),</span><span class="n">axs_list</span></div>



<div class="viewcode-block" id="plot_crosshand_residuals"><a class="viewcode-back" href="../../docs/src/diag.html#diag.residual_plots.plot_crosshand_residuals">[docs]</a><span class="k">def</span> <span class="nf">plot_crosshand_residuals</span><span class="p">(</span><span class="n">resdata</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;uvamp|complex&#39;</span><span class="p">,</span> <span class="n">crosshand</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">gain_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dterms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">station_list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residuals</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">resdist</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">datafmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">datacolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">modelfmt</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">modelcolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots comparison between the visibility amplitudes from the data and model in a variety of possible formats.</span>

<span class="sd">    Args:</span>
<span class="sd">      resdata (dict): Dictionary object containing the residual data as generated, e.g., by :func:`read_residuals`.</span>
<span class="sd">      crosshand (str,list): Quantity or list of quantities to plot.  Recognized options are &#39;RR&#39;, &#39;LL&#39;, &#39;RL&#39;, &#39;LR&#39;, or a list of combinations thereof; &#39;I&#39;, &#39;Q&#39;, &#39;U&#39;, &#39;V&#39;, or a list of combinations thereof; &#39;all&#39; which is a synonym for [&#39;RR&#39;, &#39;LL&#39;, &#39;RL&#39;, &#39;LR&#39;]; or &#39;Stokes&#39; which is a synonym for [&#39;I&#39;, &#39;Q&#39;, &#39;U&#39;, &#39;V&#39;]. Default: &#39;all&#39;.</span>
<span class="sd">      plot_type (str): Type of residual plot to generate specified via &#39;xtype|ytype&#39;. Options are xtype are &#39;uvamp&#39;, &#39;u&#39;, &#39;v&#39;, &#39;time&#39;, &#39;amplitude&#39;. Options for ytype are &#39;complex&#39;, &#39;amplitude&#39;, &#39;phase&#39;. If only one type specifier is given, will attempt to intelligently interpret it, breaking ties by assigning it to the ytype. Default: &#39;uvamp|complex&#39;.</span>
<span class="sd">      gain_data (dict): Gain data object as generated, e.g., by :func:`read_gain_file`. If provided, data will be calibrated prior to residuals being plotted. Default: None.</span>
<span class="sd">      dterms (dict): List of D terms as returned from :func:`dterms` in :class:`model_polarized_image`.</span>
<span class="sd">      station_list (list,str): Station or list of stations to either exclude or restrict the residual plot to. Requires resdata to contain a key &#39;baselines&#39;.  Station names prepended with &#39;!&#39; will be excluded.  If any station names without &#39;!&#39; are given, will show *only* those stations. Default: None.</span>
<span class="sd">      residuals (bool): If True produces a sub-panel with the error-weighted residuals plotted underneath the comparison plot. Default: True.</span>
<span class="sd">      resdist (int): If not None, produces a sub-panel with the distribution of residuals compared to a unit-variance Gaussian. If an int value is passed, it will set the number of bins per unit standard deviation. Default: 2.</span>
<span class="sd">      datafmt (str): Format specifier for the data points. Default: &#39;o&#39;.</span>
<span class="sd">      datacolor (str,list): Color of the data points in acceptable color type as specified in :mod:`matplotlib.colors`. Default: &#39;b&#39;.</span>
<span class="sd">      modelfmt (str): Format specifier for the model points. Default: &#39;.&#39;.</span>
<span class="sd">      modelcolor (str,list): Color of the model points in acceptable color type as specified in :mod:`matplotlib.colors`. Default: &#39;r&#39;.</span>
<span class="sd">      grid (bool): Flag that determines whether or not to plot a background grid. Default: True.    </span>
<span class="sd">      xscale (str): The x-axis scaling. May be specified via any value accepted by :func:`matplotlib.axes.Axes.set_xscale`.  Default: &#39;linear&#39;.</span>
<span class="sd">      yscale (str): The y-axis scaling. May be specified via any value accepted by :func:`matplotlib.axes.Axes.set_xscale`.  Default: &#39;linear&#39;.</span>
<span class="sd">      alpha (float): Alpha value for points. Default: 0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">      (matplotlib.figure.Figure, list): Figure and list of axes handles.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Create local copy so that we can modify it</span>
    <span class="n">resdata_local</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">resdata</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crosshand</span><span class="p">,</span><span class="nb">list</span><span class="p">))</span> <span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">crosshand</span><span class="o">==</span><span class="s1">&#39;all&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">crosshand</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RR&#39;</span><span class="p">,</span><span class="s1">&#39;LL&#39;</span><span class="p">,</span><span class="s1">&#39;RL&#39;</span><span class="p">,</span><span class="s1">&#39;LR&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">crosshand</span><span class="o">==</span><span class="s1">&#39;Stokes&#39;</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">crosshand</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;Q&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">crosshand</span> <span class="o">=</span> <span class="p">[</span><span class="n">crosshand</span><span class="p">]</span>

    <span class="c1"># Apply D terms if provided</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">dterms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="p">:</span>
            <span class="n">stationA</span><span class="p">,</span><span class="n">stationB</span> <span class="o">=</span> <span class="n">_station_codes_from_baseline</span><span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;baseline&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>

            <span class="c1"># Construct inverse D-term matrix for station A</span>
            <span class="n">DAR</span> <span class="o">=</span> <span class="n">dterms</span><span class="p">[</span><span class="n">stationA</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;field rotation 1&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="n">DAL</span> <span class="o">=</span> <span class="n">dterms</span><span class="p">[</span><span class="n">stationA</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;field rotation 1&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="n">iDA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.0</span><span class="o">+</span><span class="mf">0.0</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="n">DAR</span> <span class="p">],</span> <span class="p">[</span> <span class="o">-</span><span class="n">DAL</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">+</span><span class="mf">0.0</span><span class="n">j</span> <span class="p">]])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">DAR</span><span class="o">*</span><span class="n">DAL</span><span class="p">)</span>
            
            <span class="c1"># Construct inverse D-term matrix for station B</span>
            <span class="n">DBR</span> <span class="o">=</span> <span class="n">dterms</span><span class="p">[</span><span class="n">stationB</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;field rotation 2&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="n">DBL</span> <span class="o">=</span> <span class="n">dterms</span><span class="p">[</span><span class="n">stationB</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.0</span><span class="n">j</span><span class="o">*</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;field rotation 2&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
            <span class="n">iDB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mf">1.0</span><span class="o">+</span><span class="mf">0.0</span><span class="n">j</span><span class="p">,</span> <span class="o">-</span><span class="n">DBR</span> <span class="p">],</span> <span class="p">[</span> <span class="o">-</span><span class="n">DBL</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">+</span><span class="mf">0.0</span><span class="n">j</span> <span class="p">]])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">DBR</span><span class="o">*</span><span class="n">DBL</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;model&#39;</span><span class="p">,</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span> <span class="p">:</span>

                <span class="c1"># Package as Jones matrix</span>
                <span class="n">XAB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RR&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RL&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="p">],</span> \
                                 <span class="p">[</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;LR&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;LL&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="p">]])</span>

                <span class="c1"># Apply inverse D-terms</span>
                <span class="n">XAB</span> <span class="o">=</span> <span class="n">iDA</span><span class="o">*</span><span class="n">XAB</span><span class="o">*</span><span class="p">(</span><span class="n">iDB</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>

                <span class="c1"># Unpack back to crosshand elements</span>
                <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RR&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">XAB</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RL&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">XAB</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;LR&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">XAB</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;LL&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">XAB</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Generate new error estimates</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;RR&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;RL&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="p">],</span> \
                             <span class="p">[</span> <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;LR&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;LL&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="p">]])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span>
                    <span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="p">(</span><span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">varnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mf">0.0</span><span class="n">j</span><span class="p">,</span><span class="mf">0.0</span><span class="n">j</span><span class="p">],[</span><span class="mf">0.0</span><span class="n">j</span><span class="p">,</span><span class="mf">0.0</span><span class="n">j</span><span class="p">]])</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="mf">0.0</span><span class="n">j</span><span class="p">,</span><span class="mf">0.0</span><span class="n">j</span><span class="p">],[</span><span class="mf">0.0</span><span class="n">j</span><span class="p">,</span><span class="mf">0.0</span><span class="n">j</span><span class="p">]])</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span>
                    <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
                    <span class="n">Xnew</span> <span class="o">=</span><span class="n">iDA</span><span class="o">*</span><span class="n">X</span><span class="o">*</span><span class="p">(</span><span class="n">iDB</span><span class="o">.</span><span class="n">H</span><span class="p">)</span>
                    <span class="n">varnew</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">varnew</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> \
                                  <span class="o">+</span> <span class="p">(</span><span class="n">Xnew</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span> <span class="o">+</span> <span class="p">(</span><span class="n">Xnew</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> \
                                  <span class="o">+</span> <span class="p">((</span><span class="n">Xnew</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span> <span class="o">+</span> <span class="p">(</span><span class="n">Xnew</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">var</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="n">j</span>
                    <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                    
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span>
                    <span class="n">varnew</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varnew</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">varnew</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span>
                    
            <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;RR&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">varnew</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;RL&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">varnew</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;LR&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">varnew</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;LL&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">varnew</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Generate Stokes I,Q,U,V if requested</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">set</span><span class="p">([</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">crosshand</span><span class="p">)))</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;model&#39;</span><span class="p">,</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span> <span class="p">:</span>
            <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RR&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;LL&#39;</span><span class="p">]</span>
            <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RL&#39;</span><span class="p">]</span><span class="o">+</span><span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;LR&#39;</span><span class="p">]</span>
            <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;U&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RL&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;LR&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">1.0</span><span class="n">j</span>
            <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;RR&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;LL&#39;</span><span class="p">]</span>

        <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;I&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;RR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;LL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> \
                               <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;RR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;LL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
        <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;RL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;LR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> \
                               <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;RL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;LR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
        <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;U&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;RL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;LR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> \
                               <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;RL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;LR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
        <span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;V&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;RR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;LL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> \
                               <span class="o">+</span> <span class="mf">1.0</span><span class="n">j</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;RR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">resdata_local</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">][</span><span class="s1">&#39;LL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imag</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>

        
    <span class="c1"># Create copy for plotting visibilities</span>
    <span class="n">resdata_vis</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">resdata_vis</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;visibilities&#39;</span>
    <span class="n">keylist1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="s1">&#39;year&#39;</span><span class="p">,</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="s1">&#39;baseline&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
    <span class="n">keylist2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="s1">&#39;model&#39;</span><span class="p">,</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keylist1</span><span class="o">+</span><span class="n">keylist2</span> <span class="p">:</span>
        <span class="n">resdata_vis</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">crosshand</span> <span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keylist1</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="ow">in</span> <span class="n">resdata_local</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">:</span>
                <span class="n">resdata_vis</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resdata_vis</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keylist2</span> <span class="p">:</span>
            <span class="n">resdata_vis</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resdata_vis</span><span class="p">[</span><span class="n">key</span><span class="p">],</span><span class="n">resdata_local</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">q</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">plot_visibility_residuals</span><span class="p">(</span><span class="n">resdata_vis</span><span class="p">,</span><span class="n">plot_type</span><span class="o">=</span><span class="n">plot_type</span><span class="p">,</span> <span class="n">gain_data</span><span class="o">=</span><span class="n">gain_data</span><span class="p">,</span> <span class="n">station_list</span><span class="o">=</span><span class="n">station_list</span><span class="p">,</span> <span class="n">residuals</span><span class="o">=</span><span class="n">residuals</span><span class="p">,</span> <span class="n">resdist</span><span class="o">=</span><span class="n">resdist</span><span class="p">,</span> <span class="n">datafmt</span><span class="o">=</span><span class="n">datafmt</span><span class="p">,</span> <span class="n">datacolor</span><span class="o">=</span><span class="n">datacolor</span><span class="p">,</span> <span class="n">modelfmt</span><span class="o">=</span><span class="n">modelfmt</span><span class="p">,</span> <span class="n">modelcolor</span><span class="o">=</span><span class="n">modelcolor</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="n">grid</span><span class="p">,</span> <span class="n">xscale</span><span class="o">=</span><span class="n">xscale</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="n">yscale</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span></div>
    

</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Themis Development Team.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'0.3.0+122.gd356c33.dirty',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            LINK_SUFFIX:'.html', 
            HAS_SOURCE: 'true'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>